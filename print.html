<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hands On Data Structures</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="preface.html">Preface</a></li><li class="chapter-item expanded "><a href="fundamentals/fundamentals.html"><strong aria-hidden="true">1.</strong> Fundamentals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="fundamentals/intro.html"><strong aria-hidden="true">1.1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="fundamentals/java.html"><strong aria-hidden="true">1.2.</strong> Java Built-in Data Structures</a></li><li class="chapter-item expanded "><a href="fundamentals/python.html"><strong aria-hidden="true">1.3.</strong> Python Built-in Data Structures</a></li><li class="chapter-item expanded "><a href="fundamentals/alg.html"><strong aria-hidden="true">1.4.</strong> Algorithm Analysis</a></li><li class="chapter-item expanded "><a href="fundamentals/tdd.html"><strong aria-hidden="true">1.5.</strong> Test Driven Development</a></li><li class="chapter-item expanded "><a href="fundamentals/exercise.html"><strong aria-hidden="true">1.6.</strong> Exercise</a></li></ol></li><li class="chapter-item expanded "><a href="stack_queue/intro.html"><strong aria-hidden="true">2.</strong> Stacks and Queues</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="stack_queue/stack.html"><strong aria-hidden="true">2.1.</strong> Stacks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="stack_queue/stack_python.html"><strong aria-hidden="true">2.1.1.</strong> Stacks in Python</a></li><li class="chapter-item expanded "><a href="stack_queue/stack_java.html"><strong aria-hidden="true">2.1.2.</strong> Stacks in Java</a></li></ol></li><li class="chapter-item expanded "><a href="stack_queue/queue.html"><strong aria-hidden="true">2.2.</strong> Queues</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="stack_queue/queue_python.html"><strong aria-hidden="true">2.2.1.</strong> Queues in Python</a></li><li class="chapter-item expanded "><a href="stack_queue/queue_java.html"><strong aria-hidden="true">2.2.2.</strong> Queues in Java</a></li></ol></li><li class="chapter-item expanded "><a href="stack_queue/deque.html"><strong aria-hidden="true">2.3.</strong> Deques</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="stack_queue/deque_python.html"><strong aria-hidden="true">2.3.1.</strong> Deques in Python</a></li><li class="chapter-item expanded "><a href="stack_queue/deque_java.html"><strong aria-hidden="true">2.3.2.</strong> Deques in Java</a></li></ol></li><li class="chapter-item expanded "><a href="stack_queue/exercise.html"><strong aria-hidden="true">2.4.</strong> Exercise</a></li></ol></li><li class="chapter-item expanded "><a href="list/intro.html"><strong aria-hidden="true">3.</strong> Lists</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="list/adt.html"><strong aria-hidden="true">3.1.</strong> The List ADT</a></li><li class="chapter-item expanded "><a href="list/arraylist.html"><strong aria-hidden="true">3.2.</strong> Array List</a></li><li class="chapter-item expanded "><a href="list/linkedlist.html"><strong aria-hidden="true">3.3.</strong> Linked List</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="list/linkedlist_python.html"><strong aria-hidden="true">3.3.1.</strong> Linked List in Python</a></li><li class="chapter-item expanded "><a href="list/linkedlist_java.html"><strong aria-hidden="true">3.3.2.</strong> Linked List in Java</a></li></ol></li><li class="chapter-item expanded "><a href="list/double_link.html"><strong aria-hidden="true">3.4.</strong> Doubly Linked List</a></li><li class="chapter-item expanded "><a href="list/case.html"><strong aria-hidden="true">3.5.</strong> Case Study</a></li><li class="chapter-item expanded "><a href="list/exercise.html"><strong aria-hidden="true">3.6.</strong> Exercise</a></li></ol></li><li class="chapter-item expanded "><a href="tree/intro.html"><strong aria-hidden="true">4.</strong> Trees</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tree/general.html"><strong aria-hidden="true">4.1.</strong> General Trees</a></li><li class="chapter-item expanded "><a href="tree/bst.html"><strong aria-hidden="true">4.2.</strong> Binary Search Trees (1)</a></li><li class="chapter-item expanded "><a href="tree/bst2.html"><strong aria-hidden="true">4.3.</strong> Binary Search Trees (2)</a></li><li class="chapter-item expanded "><a href="tree/balanced.html"><strong aria-hidden="true">4.4.</strong> Balanced Search Trees</a></li><li class="chapter-item expanded "><a href="tree/rbt.html"><strong aria-hidden="true">4.5.</strong> Red Black Trees (1)</a></li><li class="chapter-item expanded "><a href="tree/rbt2.html"><strong aria-hidden="true">4.6.</strong> Red Black Trees (2)</a></li><li class="chapter-item expanded "><a href="tree/case.html"><strong aria-hidden="true">4.7.</strong> Case Study</a></li><li class="chapter-item expanded "><a href="tree/exercise.html"><strong aria-hidden="true">4.8.</strong> Exercise</a></li></ol></li><li class="chapter-item expanded "><a href="pq/intro.html"><strong aria-hidden="true">5.</strong> Priority Queues</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pq/imp.html"><strong aria-hidden="true">5.1.</strong> PQ Implementation (1)</a></li><li class="chapter-item expanded "><a href="pq/imp2.html"><strong aria-hidden="true">5.2.</strong> PQ Implementation (2)</a></li><li class="chapter-item expanded "><a href="pq/case.html"><strong aria-hidden="true">5.3.</strong> Case Study</a></li><li class="chapter-item expanded "><a href="pq/indexed.html"><strong aria-hidden="true">5.4.</strong> Indexed Priority Queue</a></li><li class="chapter-item expanded "><a href="pq/exercise.html"><strong aria-hidden="true">5.5.</strong> Exercise</a></li></ol></li><li class="chapter-item expanded "><a href="hash/intro.html"><strong aria-hidden="true">6.</strong> Hash Tables</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hash/direct.html"><strong aria-hidden="true">6.1.</strong> Direct-address Tables</a></li><li class="chapter-item expanded "><a href="hash/table.html"><strong aria-hidden="true">6.2.</strong> Hash Tables</a></li><li class="chapter-item expanded "><a href="hash/function.html"><strong aria-hidden="true">6.3.</strong> Hash Functions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hash/java.html"><strong aria-hidden="true">6.3.1.</strong> Hash in Java</a></li><li class="chapter-item expanded "><a href="hash/python.html"><strong aria-hidden="true">6.3.2.</strong> Hash in Python</a></li></ol></li><li class="chapter-item expanded "><a href="hash/open.html"><strong aria-hidden="true">6.4.</strong> Open-addressing Hashing</a></li><li class="chapter-item expanded "><a href="hash/case.html"><strong aria-hidden="true">6.5.</strong> Case Study</a></li></ol></li><li class="chapter-item expanded "><a href="sorting/intro.html"><strong aria-hidden="true">7.</strong> Sorting</a></li><li class="chapter-item expanded "><a href="graph/intro.html"><strong aria-hidden="true">8.</strong> Graphs</a></li><li class="chapter-item expanded "><a href="appendix/intro.html"><strong aria-hidden="true">9.</strong> Appendix</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="appendix/java.html"><strong aria-hidden="true">9.1.</strong> IDEA for Java</a></li><li class="chapter-item expanded "><a href="appendix/pycharm.html"><strong aria-hidden="true">9.2.</strong> PyCharm for Python</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hands On Data Structures</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<p>Welcome to <em>Hands On Data Structures</em>! Basically, data structures are the cornerstone in computer science as all operations in computer are virtually to manipulate <em>data</em> efficiently.</p>
<p>So, what is a <em>data structure</em> exactly? <a href="https://en.wikipedia.org/wiki/Data_structure">Wikipedia</a> offers a working definition:</p>
<blockquote>
<p>In computer science, a data structure is a data organization, management, and storage format that is usually chosen for efficient access to data.</p>
</blockquote>
<p>Suppose you are a librarian and there are more than 10 thousand books. Then how to <em>organize</em> and <em>manage</em> those books is of importance to you, because readers expects they are able to find the book they love <em>efficiently</em>. Nobody wants a mess!</p>
<p>In this book, you will learn to organize/manage those data (e.g., books) by designing efficient data structures. Let's stick to the analogy of being a librarian. As we can see, how to fetch/add/remove books is also an essential part of your daily work. In computer science, it is called <em>algorithms</em>, which describes how to do something step by step in computers. Furthermore, we can obtain such interesting equation<sup class="footnote-reference"><a href="#eq">1</a></sup>:</p>
<p>\[ Programs = Data\ Structures + Algorithms \]</p>
<p>It is obvious that data structures and algorithms are highly inherently relevant with each other. Without data structures, it is unlikely to design efficient algorithms. To some extent, algorithms can be regarded the application of data structures. However, a thorough introduction to algorithms, mainly including algorithms design and analysis, is out of the scope of this book. As a result, we focus on some basic data structures, and only a handful of parts are dedicated to pure algorithms.</p>
<p>Note that there are many awesome books available about data structures and algorithms, and this book is just a follower of them. Just to name a few:</p>
<ul>
<li><a href="https://book.douban.com/subject/3904676/">Introduction to Algorithms</a> by Thomas H. Cormen, Charles E. Leiserson, Ronald L. Rivest, and Clifford Stein. It is known as <em>CLRS</em>.</li>
<li><a href="https://book.douban.com/subject/4854123/">Algorithms</a> by Robert Sedgewick, Kevin Wayne.</li>
<li><a href="https://book.douban.com/subject/24773502/">Data Structures &amp; Algorithms in Java</a> by Michael T. Goodrich, Roberto Tamassia, Michael H. Goldwasser.</li>
<li><a href="https://book.douban.com/subject/10607365/">Data Structures &amp; Algorithms in Python</a> by Michael T. Goodrich, Roberto Tamassia, Michael H. Goldwasser.</li>
<li><a href="https://book.douban.com/subject/10530466/">Data Structures and Algorithm Analysis in Java</a> by Mark A. Weiss.</li>
</ul>
<p>It is highly recommended reading those masterpieces (especially <em>CLRS</em> and <em>Algorithms</em>) if you want to have an in-depth understanding, for this book is tailored for students in SWUFE by eliminating or simplifying many obscure parts.</p>
<p>The motivation of this book is to help students obtain hands-on skills in terms of data structures by putting emphasis on coding and programming itself. It is also worthwhile to note that data structures are not limited to some specific programming languages. In this book, we will focus on the object-oriented way, and cover the implementations in both Java and Python.</p>
<hr />
<p><sup class="footnote-reference"><a href="#eq">1</a></sup> <em>Algorithms + Data Structures = Programs</em> is a 1976 book written by Niklaus Wirth covering some of fundamental topics of computer programming, particularly that algorithms and data structures are inherently related.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fundamentals"><a class="header" href="#fundamentals">Fundamentals</a></h1>
<p>In this chapter, we will take a quick glance at data structures.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Let's continue to use the analogy of being a librarian, so you have to design an efficient way to manage the large amount of books. Suppose we need only to care about the names of books, we can use an array in Java or a list in Python:</p>
<pre><code class="language-java">String[] books = {&quot;Gone with the Wind&quot;, &quot;Hands on Data Structures&quot;};
</code></pre>
<pre><code class="language-python">books = [&quot;Gone with the Wind&quot;, &quot;Hands on Data Structures&quot;]
</code></pre>
<p>But, <strong>the capabilities of different data structures vary considerably</strong>. For example, an <em>array</em> in most programming languages is in a fixed size. To put it another way, you cannot add or remove any item in it, and this feature is ridiculous for a general library management system. </p>
<p>Given the pitfall of an array, can we always prefer to a list? The answer is NO! Because trade-offs are ubiquitous in computer science, different data structures have their own pros and cons, and we should choose an appropriate data structure by considering the specific context. As for an array, it is the best due to its efficiency if we have already known that the size of items won't be changed.</p>
<p>By the way, if we would like the feature of adding/removing in Java, we can use <code>ArrayList</code> in Java alternatively:</p>
<pre><code class="language-java">List&lt;String&gt; books = new ArrayList&lt;&gt;();
books.add(&quot;Gone with the Wind&quot;);
books.add(&quot;Hands on Data Structures&quot;);
</code></pre>
<p>Now let's have a look at the term &quot;efficiency&quot;, which is the motivation of designing new data structures and algorithms. Generally speaking, we mainly care about the two kinds of <em>efficiency</em>:</p>
<ul>
<li>Time: A program that costs less time is considered as a better one.</li>
<li>Space: A program that costs less memory/disk<sup class="footnote-reference"><a href="#space">1</a></sup> is considered as a better one.</li>
</ul>
<p>Here is an example about time efficiency. If you are asked to find the book titled &quot;Gone with the Wind&quot;, how do you do? You probably would check each item <em>one by one</em> in the list (or array). In the <em>best</em> case when you are lucky enough, the desired book is the first one, so the checking operation is done in only one time. But in the <em>worst</em> case, the desired one is the last, so the checking operation is done in <em>N</em> times, where <em>N</em> is the number of the books. And on <em>average</em> case, this operation is expected to be done in <em>N/2</em> times. As we can see, this basic data structure can be time-consuming sometimes. </p>
<p>A natural question is: can we find a data structure that is capable of finding a desired book in only one time in all cases? The answer is YES, but please keep in mind that there might be some trade-offs. In other words, a new data structure with better time efficiency may be shipped with other pitfalls. Therefore, <strong>it is the programmer's responsibility to choose an appropriate data structure as well as algorithm according to difference contexts</strong>. On the other hand, we are always aiming to find good data structures and algorithms which are efficient in most cases practically and theoretically.</p>
<p>Last but not the least, for most programmers, they don't really have to design innovative data structures or algorithms, because most the languages and third packages/libraries have provided a great many on-shelf data structures and algorithms. Then why do we still need to learn this course? There are mainly two-fold reasons:</p>
<ul>
<li>Understanding how a data structure and algorithm work behind the scenes is necessary when choosing an appropriate one.</li>
<li>You should be a <em>creator</em>, not just a <em>user</em>. Sometimes, there is no handy data structures or algorithms available, so you have to design a new one.</li>
</ul>
<hr />
<p><sup class="footnote-reference"><a href="#space">1</a></sup> In this book, we mainly discuss the memory overhead of a data structure or algorithm.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="java-built-in-data-structures"><a class="header" href="#java-built-in-data-structures">Java Built-in Data Structures</a></h1>
<p>In this section, we will introduce arrays and three essential data structures (often referred as <em>collections</em>) in Java. A complete tutorial can be found <a href="https://docs.oracle.com/javase/tutorial/collections/">here</a>.</p>
<blockquote>
<p>A collection — sometimes called a container — is simply an object that groups multiple elements into a single unit. Collections are used to store, retrieve, manipulate, and communicate aggregate data.</p>
</blockquote>
<p>Collections (e.g., <code>ArrayList</code> mentioned in the last section) are indispensable ingredients in our daily programming work, and they represent data items that form a natural group.</p>
<h2 id="array"><a class="header" href="#array">Array</a></h2>
<p>An array is a low-level data structure in Java, instead of a kind of collection. Generally, <strong>if you don't have adequate reasons to choose an <em>array</em>, then a <em>list</em> is always preferred</strong>. But sometimes a solid understanding about arrays is necessary if you want to design you own data structures. See more at <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/arrays.html">Arrays</a>.</p>
<p>The method that we use to refer to individual values in an array is numbering and then <em>indexing</em> them. If we have N values, we think of them as being numbered from 0 to N-1.</p>
<h3 id="creating-and-initializing-an-array"><a class="header" href="#creating-and-initializing-an-array">Creating and initializing an array</a></h3>
<p>Making an array in a Java program involves three distinct steps:</p>
<ul>
<li>Declare the array name and type.</li>
<li>Create the array</li>
<li>Initialize the array</li>
</ul>
<p>The long form is to specify those three steps explicitly:</p>
<pre><code class="language-java">double[] a; // declare
a = new double[N]; // create
for (int i = 0; i &lt; N; i++) {
    a[i] = 3.14; // initialize
}
</code></pre>
<p>And the declaration and creation can be written in a short form:</p>
<pre><code class="language-java">double[] a = new double[N];
</code></pre>
<p>Furthermore, those three steps can be even shortened into one line:</p>
<pre><code class="language-java">double[] a = { 3.14, 3.15, 3.16 };
</code></pre>
<p>Note that like most programming languages, Java would provide default values even if you do not initialize them, but it is a bad practice to rely on the compiler. So <strong>please make an initialization explicitly before using an array</strong>.</p>
<h3 id="accessing-an-array"><a class="header" href="#accessing-an-array">Accessing an array</a></h3>
<p>We can access an array via <em>indexing</em>:</p>
<pre><code class="language-java">double d = a[0]; // get the first item
a[0] = 42.0; // update the first item
</code></pre>
<p>You should pay attention to the indexing range, because it will raise an <code>OutOfBoundsException</code> if you use the index less than 0 or greater than N - 1.</p>
<h3 id="iterating-an-array"><a class="header" href="#iterating-an-array">Iterating an array</a></h3>
<p>You can use the tradition <code>for</code> loop to iterate an array:</p>
<pre><code class="language-java">for (int i = 0; i &lt; N; i++) {
    System.out.println(a[i]);
}
</code></pre>
<p>But for modern Java, you should prefer to the enhanced <code>for-each</code>, since it is likely to make the <em>OutOfBoundsException</em> using the traditional method:</p>
<pre><code class="language-java">for (double d : a) {
    System.out.println(d);
}
</code></pre>
<h3 id="generics-and-arrays"><a class="header" href="#generics-and-arrays">Generics and arrays</a></h3>
<p>Suppose you have developed a <code>Library</code> class which manages books:</p>
<pre><code class="language-java">public class Library {
    private Book[] books;
    
    public void add(Book book) {
        ...
    }
    ...
}
</code></pre>
<p>Then how can you reuse this class to manage other types, let's say <code>Fruit</code> for a grocery? A naive method is to repeat the code:</p>
<pre><code class="language-java">public class Grocery {
    private Fruit[] fruits;
    
    public void add(Fruit fruit) {
        ...
    }
    ...
}
</code></pre>
<p>There is a golden rule in programming: <strong>don't repeat yourself</strong>, so we would like to manage either <code>Book</code> or <code>Fruit</code> using one piece of code. Since every class in Java is inherited from <code>Object</code>, what about <code>Object[]</code>? Well, it is feasible, but it is also error-prone, because it cannot prevent users adding both books and fruits to our system at the same time. To solve this problem, you should use generics. Generics have been a part of the language since Java 5, and see more at <a href="https://docs.oracle.com/javase/tutorial/java/generics/index.html">Generics</a>.</p>
<p>But keep in mind that arrays and generics do not mix well. For example, the following code will result in <em>generic array creation</em> at compile time:</p>
<pre><code class="language-java">T[] elements = new T[N];
</code></pre>
<p>Here I propose one solution to this problem. To manage different types of items, the <code>Manager</code> class accepts generics types (The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/code/java/start/src/Manager.java">Manager.java</a>):</p>
<pre><code class="language-java">public class Manager&lt;E&gt; {
    private E[] elements;
    private int size = 0;
    private static final int INIT_CAPACITY = 16;

    @SuppressWarnings(&quot;unchecked&quot;)
    public Manager() {
        elements = (E[]) new Object[INIT_CAPACITY];
    }

    public void add(E item) {
        ...
    }
    ...
}
</code></pre>
<p>Since casting an <code>Object[]</code> to <code>E[]</code> is unsafe, we use <code>@SuppressWarnings(&quot;unchecked&quot;)</code><sup class="footnote-reference"><a href="#unchecked">1</a></sup> to tell the compiler that I know what I am doing, and please don't give me any warning. Don't get frustrated if you don't fully understand what the code above means, and we will go back to discuss the code in detail later. What you need to know now is to realize the importance of generics and possible traps when combining generics and arrays.</p>
<p>By the way, it is very straightforward to make use of the generic class:</p>
<pre><code class="language-java">Manager&lt;Book&gt; library = new Manager&lt;&gt;();
library.add(new Book(&quot;Gone with the wind&quot;, &quot;Margaret Mitchell&quot;));
library.display();
</code></pre>
<h3 id="common-operations-of-arrays"><a class="header" href="#common-operations-of-arrays">Common operations of arrays</a></h3>
<p>As a Java programmer, you should get familiar with <code>java.util.Arrays</code> which offering plenty of handy methods. You can refer to <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Arrays.html">JDK API Doc</a>, and I will introduce some most commonly used methods in the following. Note that all methods are <em>static</em>.</p>
<ul>
<li><code>asList​(T... a)</code>: Returns a fixed-size list backed by the specified array<sup class="footnote-reference"><a href="#aslist">2</a></sup>.</li>
</ul>
<pre><code class="language-java">List&lt;String&gt; books = Arrays.asList(&quot;Gone with the Wind&quot;, &quot;Hands on Data Structures&quot;);
</code></pre>
<ul>
<li><code>fill​(int[] a, int val)</code>: Assigns the specified int value to each element of the specified array of <code>int</code>s.</li>
</ul>
<pre><code class="language-java">int[] arr = new int[100];
Arrays.fill(arr, 42);
</code></pre>
<ul>
<li><code>copyOf​(int[] original, int newLength)</code>: Copies the specified array, truncating or padding with zeros (if necessary) so the copy has the specified length.</li>
</ul>
<pre><code class="language-java">int[] arr = {1, 2, 3};
// expand its size to 6
arr = Arrays.copyOf(arr, 6);
arr[3] = 4;
</code></pre>
<ul>
<li><code>sort(int[] a)</code>: Sorts the specified array into ascending numerical order.</li>
</ul>
<pre><code class="language-java">int[] arr = {1, 9, 4, 2};
Arrays.sort(arr);
// now it becomes {1, 2, 4, 9}
</code></pre>
<h2 id="list"><a class="header" href="#list">List</a></h2>
<p>Here I mainly talk about <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ArrayList.html">java.util.ArrayList</a>, which is a resizable-array implementation of <code>java.util.List</code>. Keep in mind that never use raw types for collections, including <code>List</code>, <code>Set</code> and <code>Map</code>, and make friends with generics! </p>
<pre><code class="language-java">List&lt;String&gt; books = new ArrayList&lt;&gt;(); // generics
List fruits = new ArrayList(); //  don't do this!
</code></pre>
<p>Basically, you can regard <code>List</code> as a more powerful array, and you are required to know and practice at least those methods:</p>
<ul>
<li><code>add()</code></li>
<li><code>addAll()</code></li>
<li><code>clear()</code></li>
<li><code>contains()</code></li>
<li><code>get()</code></li>
<li><code>indexOf()</code></li>
<li><code>iterator()</code></li>
<li><code>remove()</code></li>
<li><code>size()</code></li>
<li><code>toArray()</code></li>
</ul>
<p>And of course, prefer to the enhanced <code>for-each</code> if you need to make an iteration over a list. <strong>Some legacy code may use <code>iterator()</code> method manually, but it is no longer preferred today</strong>. This suggestion also holds true other collections like <code>Map</code> and <code>List</code>.</p>
<h3 id="collections"><a class="header" href="#collections">Collections</a></h3>
<p><code>List</code> is a sub-interface of <code>Collection</code>. Like <code>java.util.Arrays</code>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Collections.html">java.util.Collections</a> provides plenty static handy methods. For example,</p>
<ul>
<li><code>sort​(List&lt;T&gt; list)</code>: Sorts the specified list into ascending order, according to the natural ordering of its elements.</li>
</ul>
<pre><code class="language-java">List&lt;Integer&gt; list = Arrays.asList(1, 9, 4, 2);
Collections.sort(list);
// now list is [1, 2, 4, 9]
</code></pre>
<ul>
<li><code>reverse​(List&lt;?&gt; list)</code>: Reverses the order of the elements in the specified list.</li>
</ul>
<pre><code class="language-java">List&lt;Integer&gt; list = Arrays.asList(1, 9, 4, 2);
Collections.reverse(list);
// now list is [2, 4, 9, 1]
</code></pre>
<ul>
<li><code>max​(Collection&lt;? extends T&gt; coll)</code>: Returns the maximum element of the given collection, according to the natural ordering of its elements.</li>
</ul>
<pre><code class="language-java">List&lt;Integer&gt; list = Arrays.asList(1, 9, 4, 2);
int v = Collections.max(list); // v is 9
</code></pre>
<h2 id="map"><a class="header" href="#map">Map</a></h2>
<p>Here I mainly talk about <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/HashMap.html">java.util.HashMap</a>. <code>Map</code> can be used to represent a mapping between a key and a value, and we assume that keys are unique. For example:</p>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody>
<tr><td>Name</td><td>Age</td></tr>
<tr><td>ISBN</td><td>Price</td></tr>
<tr><td>City</td><td>Country</td></tr>
<tr><td>Country</td><td>GDP</td></tr>
</tbody></table>
</div>
<p>Different from <code>List</code>, a map should manage a collection of pairs. Let's consider a shopping cart which maintains pairs of ISBN (key) and amount (value).</p>
<pre><code class="language-java">Map&lt;String, Integer&gt; cart = new HashMap&lt;&gt;();
</code></pre>
<p>Here we should specify the types of key and value as generics, respectively. To some extent, we can imagine a list as a map whose key is implicitly the index.</p>
<p>To add an item (three books whose ISBN is <em>7801</em>) into this cart:</p>
<pre><code class="language-java">cart.put(&quot;7801&quot;, 3);
</code></pre>
<p>To get an item by its key (i.e, <code>ISBN</code>):</p>
<pre><code class="language-java">int amount = cart.get(&quot;7801&quot;);
</code></pre>
<p>Then what if the key does not exist? This is left as an exercise for readers. Now let's make an iteration over a map. </p>
<pre><code class="language-java">for (Map.Entry&lt;String, Integer&gt; entry : cart.entrySet()) {
    System.out.println(entry.getKey() + &quot; : &quot; + entry.getValue());
}
</code></pre>
<p>You are required to know and practice at least those methods:</p>
<ul>
<li><code>clear()</code></li>
<li><code>containsKey()</code></li>
<li><code>entrySet()</code></li>
<li><code>get()</code></li>
<li><code>getOrDefault()</code></li>
<li><code>isEmpty()</code></li>
<li><code>keySet()</code></li>
<li><code>put()</code></li>
<li><code>remove()</code></li>
<li><code>size()</code></li>
<li><code>values()</code></li>
</ul>
<h2 id="set"><a class="header" href="#set">Set</a></h2>
<p>Here I mainly talk about <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/HashSet.html">java.util.HashSet</a>. Unlike a <code>list</code>, items in a <code>set</code> are unique.</p>
<pre><code class="language-java">Set&lt;String&gt; set = new HashSet&lt;&gt;();
set.add(&quot;hello&quot;);
set.add(&quot;world&quot;);
System.out.println(set.size()); // 2
set.add(&quot;hello&quot;);
System.out.println(set.size()); // 2
</code></pre>
<p>Duplicate items are not allowed in a set, so the last statement will still print 2. Again, let's make an iteration:</p>
<pre><code class="language-java">for (String s : set) {
   System.out.println(s);
}
</code></pre>
<p>Another key fact is that there is no order defined in a set, which is essentially <code>set</code> used in mathematics. For example, <code>(0, 1, 2)</code> and <code>(1, 0, 2)</code> are equivalent. </p>
<pre><code class="language-java">Set&lt;Integer&gt; a = new HashSet&lt;&gt;(Arrays.asList(0, 1, 2));
Set&lt;Integer&gt; b = new HashSet&lt;&gt;(Arrays.asList(1, 0, 2));
System.out.println(a.equals(b)); // true
</code></pre>
<p>In addition, we can also conclude that indexing in a set is meaningless.</p>
<p>You are required to know and practice at least those methods:</p>
<ul>
<li><code>add()</code></li>
<li><code>clear()</code></li>
<li><code>contains()</code></li>
<li><code>isEmpty()</code></li>
<li><code>remove()</code></li>
<li><code>size()</code></li>
</ul>
<hr />
<p><sup class="footnote-reference"><a href="#unchecked">1</a></sup> This line is optional, and it is fine to remove it.</p>
<p><sup class="footnote-reference"><a href="#aslist">2</a></sup> Unlike regular lists, the one returned by <code>asList()</code> is a fixed-size one, so we cannot add/remove items on it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python-built-in-data-structures"><a class="header" href="#python-built-in-data-structures">Python Built-in Data Structures</a></h1>
<p>In this section, we will introduce three essential data structures in Python. You can find more in <a href="https://docs.python.org/3/tutorial/datastructures.html">Data Structures</a> from Python's official tutorial and <a href="https://realpython.com/python-data-structures/">Common Python Data Structures </a>.</p>
<p>In addition, a quick overview about the <em>type hinting</em> in Python will also be covered.</p>
<h2 id="list-1"><a class="header" href="#list-1">List</a></h2>
<p>Python's list resembles Java's <code>ArrayList</code>, representing a resizable array of items.</p>
<pre><code class="language-python">num = [1, 9, 4, 2]
</code></pre>
<p>Since Python is a weak-type (and dynamic-type) language, you can even put items with different types in a list:</p>
<pre><code class="language-python">num = ['1', 9, 'four', 2]
</code></pre>
<p>But it is not recommended. If you need to store items with mixing types, you can resort to a <code>tuple</code>. Note that tuples are immutable, while lists are mutable.</p>
<pre><code class="language-python"># t = 'one', 9
t = ('one', 9)
</code></pre>
<p>Python is featured by its indexing and slicing. For example,</p>
<pre><code class="language-python">print(num[0])
print(num[0:2])
print(num[:])
print(num[-1])
print(num[2:-1])
</code></pre>
<p>As for the iteration, Python's <code>for</code> is convenient for iterable objects:</p>
<pre><code class="language-python">for i in a:
    print(i)
</code></pre>
<p>Sometimes, we would like the index as well as its value while iterating a list:</p>
<pre><code class="language-python">for i, v in enumerate(a):
    print(f&quot;Index of {i} is {v}&quot;)
</code></pre>
<p>You are required to know and practice at least those methods:</p>
<ul>
<li><code>append()</code></li>
<li><code>extend()</code></li>
<li><code>insert()</code></li>
<li><code>remove()</code></li>
<li><code>pop()</code></li>
<li><code>clear()</code></li>
<li><code>sort()</code></li>
<li><code>reverse()</code></li>
</ul>
<p>Another nice feature in Python is the list comprehension, providing a concise way to create lists:</p>
<pre><code class="language-python">squares = [x**2 for x in range(10)]
</code></pre>
<p>By taking the leveraging of Java's <code>Stream</code> API, we can achieve a similar but wordy implementation<sup class="footnote-reference"><a href="#list">1</a></sup>:</p>
<pre><code class="language-java">List&lt;Integer&gt; squares = IntStream.range(0, 10).map(x -&gt; x * 2).boxed().collect(Collectors.toList());
</code></pre>
<p>Wow! Python saves a lot of keystrokes.</p>
<p>Note that in Java we use the <code>size()</code> method to get the size of an <code>ArrayList</code>, but the <code>len()</code> method in Python is not defined on a list itself. So you will see the following error if <code>a.len()</code> is used:</p>
<blockquote>
<p>Traceback (most recent call last):
File &quot;<stdin>&quot;, line 1, in <module>
AttributeError: 'list' object has no attribute 'len'</p>
</blockquote>
<p>Instead, you should use <code>len(a)</code> to get the size of list <code>a</code>.</p>
<p>To test whether an item is in a list or not, we can use <code>in</code> (the opposite is <code>not in</code>) operator, while <code>contains()</code> method is used in Java:</p>
<pre><code>num = [1, 9, 4, 2]
print(1 in num) # True
print(3 in num) # False
print(3 not in num) # True
</code></pre>
<h2 id="set-1"><a class="header" href="#set-1">Set</a></h2>
<p>Python's set assembles Java's <code>HashSet</code>, representing an unordered collection of items without duplication. Note that to create an empty set you have to use <code>set()</code>, not <code>{}</code>.</p>
<pre><code class="language-python">words = {'hello', 'world', 'hello'}
print(words) 
print(len(words))
</code></pre>
<p>The results will show that duplicates have been removed. By the way, the weak-type of Python makes it also possible to put mixing types in a set. Again, it is not recommended.</p>
<p>The key fact is that there is no order defined in a set, which is essentially <code>set</code> used in mathematics. For example, <code>{0, 1, 2}</code> and <code>{1, 0, 2}</code> are equivalent. </p>
<pre><code class="language-python">a = {0, 1, 2}
b = {1, 0, 2}
print(a == b) # True
</code></pre>
<p>In addition, we can also conclude that indexing in a set is meaningless.</p>
<p>You are required to know and practice at least those methods:</p>
<ul>
<li><code>add()</code></li>
<li><code>clear()</code></li>
<li><code>discard()</code></li>
<li><code>pop()</code></li>
<li><code>remove()</code></li>
<li><code>union()</code></li>
<li><code>update()</code></li>
</ul>
<p>Like the list, iterations via <code>for</code>, <code>len()</code>, <code>in</code> (<code>not in</code>), and set comprehensions are also supported. </p>
<h2 id="dictionary"><a class="header" href="#dictionary">Dictionary</a></h2>
<p>Python's <code>dict</code> assembles Java's <code>HashMap</code>, representing a collection of key-value pairs. Dictionaries can be used to represent a mapping between a key and a value, and we assume that keys are unique. For example:</p>
<div class="table-wrapper"><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody>
<tr><td>Name</td><td>Age</td></tr>
<tr><td>ISBN</td><td>Price</td></tr>
<tr><td>City</td><td>Country</td></tr>
<tr><td>Country</td><td>GDP</td></tr>
</tbody></table>
</div>
<p>Different from the list, a dict should manage a collection of pairs. Let's consider a shopping cart which maintains pairs of ISBN (key) and amount (value).</p>
<pre><code class="language-python">cart = {'7801': 3, '9902': 1}
</code></pre>
<p>To add another item into this cart:</p>
<pre><code class="language-python">cart['8809'] = 1
</code></pre>
<p>To remove an item by its key:</p>
<pre><code class="language-python">del cart['7801']
</code></pre>
<p>To get the value via a key:</p>
<pre><code class="language-python">v = cart['9902']
v = cart.get('9902')
v = cart.get('9902', 0)
</code></pre>
<p>To some extent, we can imagine a list as a map whose key is implicitly the index. Readers can explore the differences between indexing syntax and <code>get()</code> to obtain a value.</p>
<p>You are required to know and practice at least those methods:</p>
<ul>
<li><code>clear()</code></li>
<li><code>get()</code></li>
<li><code>items()</code></li>
<li><code>keys()</code></li>
<li><code>pop()</code></li>
<li><code>update()</code></li>
<li><code>values()</code></li>
</ul>
<p>We can use <code>in</code> (<code>not in</code>) to test whether a key exists, and <code>len()</code> and dict comprehensions are also supported.</p>
<pre><code class="language-python">print('0011' in cart) # False
print('9902' in cart) # True
</code></pre>
<p>The syntax to iterate a dict is slightly different:</p>
<pre><code class="language-python">for k, v in cart.items():
    print(k, v)
</code></pre>
<h2 id="collections-1"><a class="header" href="#collections-1">Collections</a></h2>
<p>The <a href="https://docs.python.org/3/library/collections.html">collections</a> module implements specialized container data types providing alternatives to Python’s general purpose built-in containers (i.e., <em>list</em>, <em>tuple</em>, <em>set</em>, and <em>dict</em>). In the following, I will introduce <code>defaultdict</code> which can supply missing values based on <code>dict</code>.</p>
<pre><code class="language-python">from collections import defaultdict
cart = defaultdict(int)
print(cart['8899'])
cart['3344'] += 3
print(cart['3344'])
</code></pre>
<p>Readers can compare its usage with the regular <code>dict</code>.</p>
<h2 id="type-hinting"><a class="header" href="#type-hinting">Type hinting</a></h2>
<p>Python is featured for its <em>dynamic typing</em> and <a href="https://realpython.com/lessons/duck-typing/">duck typing</a>.</p>
<blockquote>
<p>If it walks like a duck and it quacks like a duck, then it must be a duck.</p>
</blockquote>
<p>But sometimes for large projects, the code will become more maintainable if the typing is specified, and the <a href="https://docs.python.org/3/library/typing.html">typing</a> module make it possible.</p>
<pre><code class="language-python">def say_hello(name: str) -&gt; str:
    return f'Hello {name}'
</code></pre>
<p>This wordy version is more readable by providing the types of the parameter and returned value, and programmers who use <em>static typing</em> languages (e.g., Java) would feel more conformable. The following code is implemented with Java:</p>
<pre><code class="language-java">public String sayHello(String name) {
    return String.format(&quot;Hello %s&quot;, name);
}
</code></pre>
<p>It is worthy to note that the Python runtime does not enforce function and variable type annotations. So it is still okay to pass a non-str value (e.g., an integer) to <code>say_hello()</code>:</p>
<pre><code class="language-python">hi = say_hello(42)
</code></pre>
<p>In contrast, your code won't be complied if you use <code>sayHello(42)</code> in Java.</p>
<p>Since Python is a <em>duck typing</em> language, it will check for the presence of a given method or attribute. For example,</p>
<pre><code class="language-python">def say_length(name: str) -&gt; str:
    return f'Hello {len(name)}'
</code></pre>
<p>In this case, Python will expect that <code>len()</code> can be applied on the parameter. So <code>say_length(42)</code> will throw a <em>TypeError</em>, while the following code works well:</p>
<pre><code class="language-python">say_length('data')
say_length([1, 9, 4, 9])
say_length({'S', 'W', 'E', 'N'})
</code></pre>
<p><em>Type hinting</em> is very helpful for large projects, but for simplicity, I will not use this feature for most cases throughout this book.</p>
<hr />
<p><sup class="footnote-reference"><a href="#list">1</a></sup> Java 16 brought a shorter <code>toList()</code> method.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="algorithm-analysis"><a class="header" href="#algorithm-analysis">Algorithm Analysis</a></h1>
<p>How fast is a program?<sup class="footnote-reference"><a href="#fast">1</a></sup> If the (time) efficiency is our major concern, then we have to ask this question regularly.</p>
<h2 id="a-hands-on-method"><a class="header" href="#a-hands-on-method">A hands-on method</a></h2>
<p>A straightforward way is to measure the elapsing time. In the following, we will use a tiny program (<a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/start/src/Fibonacci.java">Fibonacci.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/fibonacci.py">fibonacci.py</a>) to compute the nth fibonacci number.</p>
<h3 id="java"><a class="header" href="#java">Java</a></h3>
<p>In Java, there are many APIs available in terms of time/date, including <code>System.currentTimeMillis()</code>, <code>Instant.now</code>. You can use either of the following method<sup class="footnote-reference"><a href="#java-time">2</a></sup> to compute the elapsing time in milliseconds:</p>
<pre><code class="language-java">long start = System.currentTimeMillis();
// your program runs
long end = System.currentTimeMillis();
long elapse = end - start;
</code></pre>
<pre><code class="language-java">long start = Instant.now().toEpochMilli();
// your program runs
long end = Instant.now().toEpochMilli();
long elapse = end - start;
</code></pre>
<pre><code class="language-java">Instant start = Instant.now();
// your programs runs
Instant end = Instant.now();
long elapse = Duration.between(start, end).toMillis();
</code></pre>
<blockquote>
<p>A more robust and comprehensive approach in Java is to use <a href="https://github.com/openjdk/jmh">JMH</a>, and the usage of it is out of the scope of this book.</p>
</blockquote>
<h3 id="python"><a class="header" href="#python">Python</a></h3>
<p>In Python, several modules can be used to deal with time/date, including <code>time</code>, <code>datetime</code>. But note that <code>time.time()</code> returns a float number representing the current time in seconds since the Epoch. You can use either of the following code to compute the elapsing time in milliseconds:</p>
<pre><code class="language-python">start = int(round(time.time() * 1000))
# your program runs
end = int(round(time.time() * 1000))
elapse = end - start
</code></pre>
<pre><code class="language-python">start = datetime.datetime.now()
# your program runs
end = datetime.datetime.now()
elapse = int(round((end - start).total_seconds() * 1000))
</code></pre>
<p>Generally, to avoid the variability of the running time, we usually run the program for several times and then take the average. Luckily, the built-in <a href="https://docs.python.org/3/library/timeit.html">timeit</a> makes it simple. </p>
<h2 id="visualize-the-efficiency"><a class="header" href="#visualize-the-efficiency">Visualize the efficiency</a></h2>
<p>Sometimes, we would like to visualize the quantitative measurements of the running time of our programs. A common qualitative observation about most programs is that there is a <em>problem size</em>
that characterizes the difficulty of the computational task. For example, <code>fibonacci(30)</code> will definitely coast more time than <code>fibonacci(3)</code>. Here the parameter (i.e., <code>3</code> and <code>30</code>) can be seen as the problem size.</p>
<p>A simple way is to save <em>(size, time)</em> per line in a file (<a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/start/src/FibTime.java">FibTime.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/fib_time.py">fib_time.py</a>), and then to visualize results using tools like <a href="http://www.gnuplot.info/">gnuplot</a>, <a href="https://ggplot2.tidyverse.org/">ggplot2 in R</a>, <a href="https://matplotlib.org/">Matplotlib in Python</a>, and <a href="https://plotly.com/python/plotly-express/">Plotly Express in Python</a>.</p>
<blockquote>
<p>Many people tend to plot the data from the memory directly, but plotting the data from a file is more common in practice. Therefore, we deliberately separate the data computing and plotting in this book.</p>
</blockquote>
<p>Here I use the Python version as the example:</p>
<pre><code class="language-python">if __name__ == '__main__':
    ns = [20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
    with open('fib_python.txt', 'w') as f:
        for n in ns:
            start = int(round(time.time() * 1000))
            fibonacci(n)
            end = int(round(time.time() * 1000))
            f.write(f'{n}   {end - start}\n')
</code></pre>
<p>Note that here the problem size starts from <code>20</code>, because the time is near to 0 when the problem size is less than 20.</p>
<img src="fundamentals/img/fib_python.png" width="80%">
<p>According to the observation<sup class="footnote-reference"><a href="#fig">3</a></sup>, some students may quickly make an insightful hypothesize that the running time is at an exponential growth, and I will analyze it through a mathematical model soon. By the way, the Java version of Fibonacci is much faster than the Python version.</p>
<h2 id="mathematical-models"><a class="header" href="#mathematical-models">Mathematical models</a></h2>
<p>D.E. Knuth postulated that, despite all the complicating factors in understanding the running times of our programs, it is possible, in principle, to build a mathematical model to describe the running time of any program. Knuth’s basic insight is simple: the total running time of a program is determined by two primary factors:</p>
<ul>
<li>The cost of executing each statement</li>
<li>The frequency of execution of each statement</li>
</ul>
<p>The former is a property of the computer and the language itself, and the second one is a property of the program and the input. The primary challenge is to determine the frequency of execution of the statements. Here are some examples:</p>
<pre><code class="language-python">def foo(n):
    for i in range(n):
        print(i)
</code></pre>
<p>The frequency of the inner statement of this function is <em>n</em>.</p>
<p>Sometimes, frequency analysis can lead to complicated and lengthy mathematical expressions. Consider the <a href="https://leetcode.com/problems/two-sum/">two-sum</a> problem, and the following is a naive solution:</p>
<pre><code class="language-python">class Solution:
    def two_sum(self, nums, target):
        for i, v in enumerate(nums):
            for j in range(i + 1, len(nums)):
                if v + nums[j] == target:
                    return [i, j]
        return []
</code></pre>
<p>The frequency of the inner comparison test statement of this function is <em>(n-1) + (n-2) + ... + 1</em> in the worst case:</p>
<p>\[ \frac{n \times (n-1)}{2} = \frac{n^2 - n}{2} \]</p>
<p>Curious readers can try to implement a faster algorithm for this problem<sup class="footnote-reference"><a href="#two-sum">4</a></sup>. Note that here I put emphasis on <em>the worst case</em>, because if you are lucky enough, the sum of the first and second item equals target, then the frequency in the <em>best</em> case is only 1.</p>
<p>As for the notation \(\frac{n^2 - n}{2}\), we can know that it is the \(\frac{n^2}{2}\) that plays a major rule in terms of the growth, so we can say \(\frac{n^2}{2}\) approximates to \(\frac{n^2 - n}{2}\). In addition, when it comes to the order of growth, the constant here (i.e., 1/2) is also insignificant. The following shows some typical approximations:</p>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>Approximation</th><th>Order of growth</th></tr></thead><tbody>
<tr><td>\(N^3/6 - N^2/2 + N/3\)</td><td>\(N^3/6\)</td><td>\(N^3\)</td></tr>
<tr><td>\(N^2/2 - N/2\)</td><td>\(N^2/2\)</td><td>\(N^2\)</td></tr>
<tr><td>\(lg{N} + 1\)</td><td>\(lg{N}\)</td><td>\(lg{N}\)</td></tr>
<tr><td>3</td><td>3</td><td>1</td></tr>
</tbody></table>
</div>
<p>The order of growth in the worst case can be also described by the <a href="https://en.wikipedia.org/wiki/Big_O_notation">big <em>O</em> notation</a>, e.g., \(O(n^3)\). The following shows some commonly encountered time complexity using the big <em>O</em> notation:</p>
<div class="table-wrapper"><table><thead><tr><th>Description</th><th>Time complexity</th></tr></thead><tbody>
<tr><td>constant</td><td>\(O(1)\)</td></tr>
<tr><td>logarithmic</td><td>\(O(log{N})\)</td></tr>
<tr><td>linear</td><td>\(O(N)\)</td></tr>
<tr><td>linearithmic</td><td>\(O(N\log{N})\)</td></tr>
<tr><td>quadratic</td><td>\(O(N^2)\)</td></tr>
<tr><td>cubic</td><td>\(O(N^3)\)</td></tr>
<tr><td>exponential</td><td>\(O(2^N\))</td></tr>
</tbody></table>
</div>
<p>For example, we can say</p>
<ul>
<li>the complexity of <code>foo()</code> is \(O(N)\)</li>
<li>the complexity of <code>two_sum()</code> is \(O(N^2)\)</li>
</ul>
<h3 id="case-study-fibonacci"><a class="header" href="#case-study-fibonacci">Case study: Fibonacci</a></h3>
<p>Based on the observation, we make an insightful hypothesize that the running time of recursive implementation <code>fibonacci</code> is at an exponential growth. </p>
<p>According to the code, we know that in order to computer <code>fibonacci(n)</code>, it is required to compute <code>fibonacci(n - 1)</code> and <code>fibonacci(n - 2)</code>. If we use \( T(n) \) to denote the time used to compute <code>fibonacci(n)</code>, then we have:</p>
<p>\[T(n) = T(n-1) + T(n-2) + O(1)\]</p>
<p>The \(O(1)\) here means the addition operation. You can prove that \(T(n) = O(2^n)\)<sup class="footnote-reference"><a href="#fib">5</a></sup>, and the visualization plotting also validates this theoretical result.</p>
<hr />
<p><sup class="footnote-reference"><a href="#fast">1</a></sup> Another important question is &quot;Why does my program run out of memory?&quot;, which cares about the space efficiency.</p>
<p><sup class="footnote-reference"><a href="#java-time">2</a></sup> See more at https://stackoverflow.com/questions/58705657/.</p>
<p><sup class="footnote-reference"><a href="#fig">3</a></sup> This figure is drawn by <a href="http://www.gnuplot.info/">gnuplot</a> and the code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/plot/lines.gp">lines.gp</a>.</p>
<p><sup class="footnote-reference"><a href="#two-sum">4</a></sup> It is possible to design <a href="https://www3.cs.uic.edu/pub/CS211/LabsS18/Two-Sum.pdf">faster algorithms</a> with \( O(N\log{N}) \) and even with \( O(N) \).</p>
<p><sup class="footnote-reference"><a href="#fib">5</a></sup> See more at https://www.geeksforgeeks.org/time-complexity-recursive-fibonacci-program/.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-driven-development"><a class="header" href="#test-driven-development">Test Driven Development</a></h1>
<p>Correctness in our programs is the extent to which our code does what we intend it to do. So, how can we guarantee that our code is correct?</p>
<p>Let's consider that Fibonacci sequence program again. Most beginners would adopt the traditional <em>print-check</em> method manually.</p>
<pre><code class="language-python">print(fibonacci(0)) # expect: 0
print(fibonacci(1)) # expect: 1
print(fibonacci(2)) # expect: 1
print(fibonacci(3)) # expect: 2
print(fibonacci(4)) # expect: 3
print(fibonacci(5)) # expect: 5
...
</code></pre>
<p>But this method is somewhat inefficient, let alone being automatic. In this section, I will introduce a better approach.</p>
<h2 id="assert"><a class="header" href="#assert">Assert</a></h2>
<p>An assertion allows testing the correctness of any assumptions that have been made in the program, and once an <code>assert</code> fails, the program will crash. So, assertions can be used for testing. See more at <a href="https://www.geeksforgeeks.org/assertions-in-java/">Assertions in Java</a> and <a href="https://realpython.com/python-assert-statement/">Python's assert</a>.</p>
<h3 id="java-1"><a class="header" href="#java-1">Java</a></h3>
<pre><code class="language-java">Fibonacci f = new Fibonacci();
assert f.fibonacci(5) == 5;
</code></pre>
<p>And you can even provide additional message for an assertion: </p>
<pre><code class="language-java">assert f.fibonacci(5) == 5 : &quot;Error when n is 5&quot;;
</code></pre>
<p>Note that you need to add <code>-ea</code> option to enable assertions. In Intellij IDEA, it can be set in <code>Run &gt; Edit Configurations... &gt; Configuration &gt; VM options</code>.</p>
<h3 id="python-1"><a class="header" href="#python-1">Python</a></h3>
<pre><code class="language-python">assert fibonacci(5) == 5
</code></pre>
<p>And you can even provide additional message for an assertion: </p>
<pre><code class="language-python">assert fibonacci(5) == 5, 'Error when n is 5'
</code></pre>
<h2 id="unit-tests"><a class="header" href="#unit-tests">Unit tests</a></h2>
<blockquote>
<p>Testing is a complex skill: we can’t cover every detail about how to write good tests.</p>
</blockquote>
<p>For modern software engineering, the test driven development (TDD) is widely adopted, and unit tests serve as an essential component in TDD. To put it simply, the key points of TDD include:</p>
<ul>
<li><strong>Write tests before real implementations</strong>. It may sound ridiculous, but it is feasible as long as you can determine the <em>input</em> and expected <em>output</em> of a program. As for the Fibonacci sequence, we can expect that <code>fibonacci(5)</code> equals 5 before implementing the code.</li>
<li><strong>Write tests for every public API</strong>. Here the <em>every</em> implies <em>unit</em>; in other words, we shall make sure <em>every</em> API works as we expect. </li>
<li><strong>Isolate tests from core code</strong>. The naive assertions<sup class="footnote-reference"><a href="#debug">1</a></sup> are often messed with the core code, but unit tests are placed separately. This feature is very productive for teamwork, as developers and testers are able to cooperate with each other smoothly.</li>
</ul>
<p>Due to the importance of unit tests, I will use unit tests when designing data structures throughout this book from now on. </p>
<h3 id="java-2"><a class="header" href="#java-2">Java</a></h3>
<p>There are several awesome unit testing frameworks for Java, and the most popular one is <a href="https://junit.org/junit5/">JUnit 5</a>. In order to integrate this third library in our project, we are going to use <code>gradle</code> as the build system to facilitate our work. Please refer to <a href="fundamentals/../appendix/java.html">Appendix</a> for more information.</p>
<p>In <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/unit-work/src/main/java/org/swufe/datastructure/Add.java">Add.java</a>, we have provided a simple method for two numbers' addition:</p>
<pre><code class="language-java">public class Add {
    public int add(int a, int b) {
        return a + b;
    }
}
</code></pre>
<p>Now let's create a unit test for <code>add()</code>. Please move the cursor onto <code>add()</code>, and then right-click <em>Go to | Test ｜ Create New Test</em>.</p>
<img src="fundamentals/img/test_java.png">
<p>Check the <code>add()</code> method:</p>
<img src="fundamentals/img/test_java2.png" width="80%">
<p>It will create an <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/unit-work/src/test/java/org/swufe/datastructure/AddTest.java">AddTest.java</a> under the <code>test</code> folder for yor:</p>
<pre><code class="language-java">@Test
void add() {
    Add a = new Add();
    assertEquals(a.add(1, 2), 3);
}
</code></pre>
<p>We can add as many test cases as we like:</p>
<pre><code class="language-java">@Test
void addTwoNegatives() {
    Add a = new Add();
    assertEquals(a.add(-2, -2), -4);
}
</code></pre>
<p>A test case can be either <em>passed</em> or <em>failed</em>. If all test cases are passed, we can somewhat ensure that this program works as we expected<sup class="footnote-reference"><a href="#bug">2</a></sup>. Otherwise, it indicates that there are some bugs in our code, and we should fix them before moving on. The comprehensive usage of <code>JUnit 5</code> is out of the scope of this book, readers can refer to <a href="https://www.baeldung.com/junit-5">A Guide to JUnit 5</a> for a quick start.</p>
<p>By the way, all assertions are enabled when executing the unit tests.</p>
<h3 id="python-2"><a class="header" href="#python-2">Python</a></h3>
<p>Luckily, the <a href="https://docs.python.org/3/library/unittest.html">unittest</a> module is built with Python, so we do not have to rely on any third-party library<sup class="footnote-reference"><a href="#pytest">3</a></sup>.</p>
<p>As for <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/add.py">add.py</a>, we can also follow the steps: move the cursor onto <code>add()</code>, and then right-click <em>Go to | Test ｜ Create New Test</em>. Finally, it will create <code>test_add.py</code> for us, and we can add as many test cases as we like: </p>
<pre><code class="language-python">from unittest import TestCase
import unittest
from add import add


class Test(TestCase):
    def test_add(self):
        self.assertEqual(add(2, 1), 3)

    def test_add_negatives(self):
        self.assertEqual(add(-2, -2), -4)


if __name__ == '__main__':
    unittest.main()
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#debug">1</a></sup> Part of the reason stems from the fact that assertions have multiple applications. In addition to tests, assertions also can be used to debug code. </p>
<p><sup class="footnote-reference"><a href="#bug">2</a></sup> Edsger W. Dijkstra said that “Program testing can be a very effective way to show the presence of bugs, but it is hopelessly inadequate for showing their absence.” That doesn’t mean we shouldn’t try to test as much as we can!</p>
<p><sup class="footnote-reference"><a href="#pytest">3</a></sup> A third-party test library, called <a href="https://docs.pytest.org/en/7.1.x/">pytest</a>, is more powerful than the <code>unittest</code> module in the standard library.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise"><a class="header" href="#exercise">Exercise</a></h1>
<ol>
<li>In <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/start/src/CoffeeDB.java">CoffeeDB.java</a>, we maintain a collection of coffees in an <code>ArrayList</code>, and this class offers a simple search method:</li>
</ol>
<pre><code class="language-java">public List&lt;Coffee&gt; findByName(String name) {
    ...
}
</code></pre>
<p>Your task is to complete its Python version below in <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/coffee_db.py">coffee_db.py</a>:</p>
<pre><code class="language-python">def find_by_name(self, name):
    pass
</code></pre>
<hr />
<ol start="2">
<li><code>HashMap</code> and <code>dict</code>.</li>
</ol>
<ul>
<li>What would you get if the key does not exist for <code>HashMap</code> in Java?</li>
<li>What is the difference between indexing syntax and <code>get()</code> to obtain a value for <code>dict</code> in Python?</li>
</ul>
<hr />
<ol start="3">
<li>Please add a method to delete books by the names from a shop cart in <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/start/src/ShopCart.java">ShopCart.java</a> or <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/shop_cart.py">shop_cart.py</a>. (<em>Hint: it does not make sense to store an item when its amount is less or equal 0.</em>)</li>
</ol>
<hr />
<ol start="4">
<li>Please write unit tests for <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/naive_two_sum.py">naive_two_sum.py</a>. (<em>Hint: you can refer to the Java implementation <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/unit-work/src/test/java/org/swufe/datastructure/NaiveTwoSumTest.java">NaiveTwoSumTest.java</a>.</em>)</li>
</ol>
<hr />
<ol start="5">
<li>Please give a big O characterization in terms of <code>n</code> for each function shown in <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/example.py">example.py</a>.</li>
</ol>
<hr />
<ol start="6">
<li>Perform experimental analysis to test the hypothesis that Java's <code>sort()</code> or Python's <code>sorted()</code> method runs in \(O(n\log{n})\) on average.</li>
</ol>
<pre><code class="language-java">// a is a random list
List&lt;Integer&gt; a = Arrays.asList(1, 9, 4, 6);
Collections.sort(a);
</code></pre>
<pre><code class="language-python"># a is a random list
a = [1, 9, 6, 4]
a = sorted(a)
</code></pre>
<hr />
<ol start="7">
<li>Please give a big O characterization in terms of <code>n</code> for <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/unit-work/src/main/java/org/swufe/datastructure/BinarySearch.java">BinarySearch.java</a> or <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/binary_search.py">binary_search.py</a>.</li>
</ol>
<hr />
<ol start="8">
<li>Please design experiments to compare the efficiency between <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/">fast_two_sum.py</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/naive_two_sum.py">naive_two_sum.py</a>. </li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stacks-and-queues"><a class="header" href="#stacks-and-queues">Stacks and Queues</a></h1>
<p>Stacks and queues are fundamental data structures, and they are used in many applications.</p>
<p>By the way, as for the specific implementation, I use Python first, and then Java from now on.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stacks"><a class="header" href="#stacks">Stacks</a></h1>
<p>A <strong>stack</strong> is a collection of objects that are inserted and removed according to the <em>last-in, first-out (LIFO)</em> policy. It supports two basic operations:</p>
<ul>
<li><code>push()</code>: add a new item</li>
<li><code>pop()</code>: remove an item</li>
</ul>
<p>It also supports two more operations sometimes: <code>size()</code> and <code>isEmpty()</code>, returning <em>number of items in the stack</em>, and answering <em>is the stack empty?</em>, respectively.</p>
<blockquote>
<p>Stack: a pile of things arranged one on top of another (from Cambridge dictionary).</p>
</blockquote>
<p>When you hear of <em>stacks</em>, you shall image a stack of documents (or plates) as illustrated in the following figure<sup class="footnote-reference"><a href="#stack">1</a></sup>:</p>
<img src="stack_queue/image/stack.png" width="40%">
<p>The following table shows a series of stack operations and their effects on an initially empty stack <code>S</code> of integers:</p>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>Stack contents</th></tr></thead><tbody>
<tr><td>S.push(5)</td><td>[5]</td></tr>
<tr><td>S.push(3)</td><td>[5, 3]</td></tr>
<tr><td>S.pop()</td><td>[5]</td></tr>
<tr><td>S.pop()</td><td>[]</td></tr>
<tr><td>S.push(7)</td><td>[7]</td></tr>
<tr><td>S.push[9]</td><td>[7, 9]</td></tr>
<tr><td>S.push(6)</td><td>[7, 9, 6]</td></tr>
<tr><td>S.pop()</td><td>[7, 9]</td></tr>
</tbody></table>
</div>
<p>The importance of stacks in computing is profound. For example, the operating system would maintain a stack for variables and states when executing programs, but the detailed discussion of this topic is out of the scope of this book. Here let's consider a common example of a stack when surfing the web. </p>
<pre><code class="language-html">&lt;!-- a.html --&gt;
&lt;a href=&quot;b.html&quot;&gt;Next&lt;/a&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- b.html --&gt;
&lt;a href=&quot;c.html&quot;&gt;Next&lt;/a&gt;
</code></pre>
<pre><code class="language-html">&lt;!-- c.html --&gt;
&lt;a href=&quot;d.html&quot;&gt;Next&lt;/a&gt;
</code></pre>
<p>When you click a hyperlink, your browser displays the new page (and pushes on a stack). You can keep clicking on hyperlinks to visit new pages, but you can always revisit the previous page by clicking the back button (popping it from the stack). The LIFO policy offered by a stack provides just the behavior that you expect.</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Contents in the stack</th><th>Where you are</th></tr></thead><tbody>
<tr><td>(Start from a.html)</td><td>[]</td><td>a.html</td></tr>
<tr><td>Click <code>Next</code></td><td>[a.html]</td><td>b.html</td></tr>
<tr><td>Click <code>Next</code></td><td>[a.html, b.html]</td><td>c.html</td></tr>
<tr><td>Click <code>Next</code></td><td>[a.html, b.html, c.html]</td><td>d.html</td></tr>
<tr><td>Click <code>Back</code></td><td>[a.html, b.html]</td><td>c.html</td></tr>
<tr><td>Click <code>Back</code></td><td>[a.html]</td><td>b.html</td></tr>
</tbody></table>
</div>
<hr />
<p><sup class="footnote-reference"><a href="#stack">1</a></sup> This figure is from <em>Algorithms, 4th</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stack-in-python"><a class="header" href="#stack-in-python">Stack In Python</a></h1>
<p>Fortunately, the <code>list</code> in Python supports the operations required by stacks. To be specific,</p>
<ul>
<li><code>append()</code> is to add a new item at the <em>end</em> of the list, so it behaves exactly the same as <code>push()</code>.</li>
<li><code>pop</code>(). Aha! The same method name as we expect.</li>
</ul>
<pre><code class="language-python">a = []
a.append(5)
a.append(3)
v = a.pop() # 3
v = a.pop() # 5
a.append(7)
a.append(9)
a.append(6)
v = a.pop() # 6
</code></pre>
<p>But, we cannot get its size and check the emptiness of a <code>list</code> in an object-oriented way. To this end, a better way is to encapsulate the data and related operations in a class. The following is the skeleton of <code>Stack</code>, and the complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/stack.py">stack.py</a>. Because the list is an array, we call the following implementation <strong>array-based stack</strong>.</p>
<pre><code class="language-python">class Stack:
    &quot;&quot;&quot;A last-in, first-out (LIFO) data structure.&quot;&quot;&quot;

    def __init__(self):
        self._data = []

    def push(self, item):
        pass

    def pop(self):
        pass

    def size(self):
        pass

    def is_empty(self):
        pass
</code></pre>
<blockquote>
<p>Python does not support the <em>private</em> variables. However, there is a convention that is followed by most Python code: a name prefixed with an underscore (e.g. _spam) should be treated as a non-public part of the API. </p>
</blockquote>
<p>As we can see, <code>Stack</code> wraps a list inside, and the implementations of these APIs are generally straightforward as long as you know the basic usage of a list.</p>
<ul>
<li><code>push()</code> is based on <code>append()</code>:</li>
</ul>
<pre><code class="language-python">def push(self, item):
    self._data.append(item)
</code></pre>
<ul>
<li><code>size()</code> is based on built-in <code>len()</code>:</li>
</ul>
<pre><code class="language-python">def size(self):
    return len(self._data)
</code></pre>
<ul>
<li><code>is_empty()</code> is to check whether its size equals 0:</li>
</ul>
<pre><code class="language-python">def is_empty(self):
    return self.size() == 0
</code></pre>
<ul>
<li><code>pop()</code> can use list's <code>pop()</code> directly:</li>
</ul>
<pre><code class="language-python">def pop(self):
    return self._data.pop()
</code></pre>
<p>However, if the underlying data is empty, then <code>pop()</code> will throw an exception: <em>IndexError: pop from empty list</em>. We can further customize the error massage to display something like <em>Error: pop from empty stack</em>:</p>
<pre><code class="language-python">def pop(self):
    if self.is_empty():
        raise IndexError('Pop from empty stack')
    return self._data.pop()
</code></pre>
<p>Another common approach is to return a <code>None</code> when it is empty, but it would be troublesome if the item itself is a <code>None</code>:</p>
<pre><code class="language-python">def pop(self):
    if self.is_empty():
        return None
    return self._data.pop()
</code></pre>
<p>A third approach is to use a self-defined exception class, and we will adopt this implementation in this book.</p>
<pre><code class="language-python">class NoElement(Exception):
    &quot;&quot;&quot;Error attempting to access an element from an empty collection.&quot;&quot;&quot;
    pass
</code></pre>
<pre><code class="language-python">def pop(self):
    if self.is_empty():
        raise NoElement('Pop from empty stack!')
    return self._data.pop()
</code></pre>
<h2 id="iterator"><a class="header" href="#iterator">Iterator</a></h2>
<p>By now you have probably noticed that most container objects can be looped over using a <code>for</code> statement:</p>
<pre><code class="language-python">a = [1, 9, 4, 9]
for i in a:
    print(i)
</code></pre>
<p>Why can we use <code>for</code> to iterate the list? The iterator behind the scenes plays the magic<sup class="footnote-reference"><a href="#for">1</a></sup>! See more at <a href="https://docs.python.org/3/tutorial/classes.html#iterators">Iterators</a>.</p>
<p>It is often a good practice to prepare a single class as the iterator which offers the <code>__next__()</code> method:</p>
<pre><code class="language-python">class ReverseListIterator:
    def __init__(self, data):
        self._data = data
        self._i = len(data)

    def __next__(self):
        if self._i == 0:
            raise StopIteration
        self._i -= 1
        return self._data[self._i]
</code></pre>
<p>And <code>Stack</code>'s <code>__iter__()</code> method returns an instance of the iterator:</p>
<pre><code class="language-python">def __iter__(self):
    return ReverseListIterator(self._data)
</code></pre>
<p>We can also use the built-in <code>reversed()</code> iterator:</p>
<pre><code class="language-python">def __iter__(self):
    return reversed(self._data)
</code></pre>
<p>In this way, we can iterate the stack as we do for other collections:</p>
<pre><code class="language-python">s = Stack()
s.push(1)
s.push(2)
s.push(3)
for i in s:
    print(i)
</code></pre>
<h2 id="time-complexity"><a class="header" href="#time-complexity">Time complexity</a></h2>
<p>The following table summarizes the array-based stack's time complexity:</p>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>Running time</th></tr></thead><tbody>
<tr><td>push()</td><td>\(O(1)\)</td></tr>
<tr><td>pop()</td><td>\(O(1)\)</td></tr>
<tr><td>is_empty()</td><td>\(O(1)\)</td></tr>
<tr><td>size()</td><td>\(O(1)\)</td></tr>
</tbody></table>
</div>
<p>As we can see, all APIs are with a constant time complexity. </p>
<p>Note that the time complexity of <code>push()</code> and <code>pop()</code> is <em>amortized</em>. Roughly speaking, it means \(O(1)\) happens most of time, but it may have a larger time complexity only once a while<sup class="footnote-reference"><a href="#resize">2</a></sup>; and on average, the worst complexity is still \(O(1)\). </p>
<h2 id="application-1-matching-parentheses"><a class="header" href="#application-1-matching-parentheses">Application (1): matching parentheses</a></h2>
<p>In this subsection, we explore an application of stacks by considering matching parentheses in arithmetic expressions. Here we assume that only parentheses <code>()</code>, braces <code>{}</code>, and brackets <code>[]</code> are allowed. This application is also found at <a href="https://leetcode.com/problems/valid-parentheses/">LeetCode</a>.</p>
<p>Clearly, each opening symbol must match its corresponding closing symbol. For example:</p>
<ul>
<li>Correct: <code>()(()){([()])}</code></li>
<li>Incorrect: <code>({[])}</code></li>
</ul>
<p>To what follows, we are going to design an algorithm to check whether an expression is matched in terms of parentheses:</p>
<pre><code class="language-python">def is_matched(expr):
    &quot;&quot;&quot;
    Check whether an expression is matched in terms of parentheses

    :param expr: an expression with parentheses
    :return: True if matched; False otherwise
    &quot;&quot;&quot;
    pass
</code></pre>
<p>The idea of this algorithm can be described in plain English: </p>
<ul>
<li>Scan the expression for left to right.</li>
<li>If the character belongs to openings (i.e., <code>([{</code>), it is pushed on a stack.</li>
<li>If the character belongs to the closings (i.e., <code>)]}</code>), an item popped from the stack will be checked whether it is matched with the character or not. If so, continue to scan; otherwise, return <code>False</code>.</li>
<li>After scanning, if the stack is empty, return <code>True</code>; otherwise, return <code>False</code>.</li>
</ul>
<p>The steps above can be translated into the code:</p>
<pre><code class="language-python">def is_matched(expr):
    openings = '([{'
    closings = ')]}'
    s = Stack()
    for c in expr:
        if c in openings:
            s.push(c)
        elif c in closings:
            if s.is_empty():
                return False
            if closings.index(c) != openings.index(s.pop()):
                return False
    return s.is_empty()
</code></pre>
<h2 id="application-2-arithmetic-expression-evaluation"><a class="header" href="#application-2-arithmetic-expression-evaluation">Application (2): arithmetic expression evaluation</a></h2>
<p>As another example<sup class="footnote-reference"><a href="#arithmetic">3</a></sup> of a stack, let's consider the basic arithmetic expression evaluation. For example,</p>
<pre><code>(1 + ((2 + 3) * (4 * 5)))
</code></pre>
<p>If you multiply 4 by 5, add 3 to 2, multiply the result, and then add 1, you get the value 101. How to this calculation using Python?</p>
<p>For simplicity, we begin with the following explicit recursive definition: an <em>arithmetic expression</em> is either a number, or a left parenthesis (i.e., <code>(</code>) followed by an arithmetic expression followed by an operator followed by another arithmetic expression followed by a right parenthesis (i.e., <code>)</code>). In other words, we rely on parentheses instead of precedence rules.</p>
<p>For specificity, we support the familiar binary operators <code>*</code>, <code>+</code>, <code>-</code>, and <code>/</code>. A remarkably simple algorithm that was developed by E. W. Dijkstra in the 1960s uses two stacks (<strong>one for operands and one for operators</strong>) to do this job. Again, the idea of this algorithm can be described in plain English when scanning the expression according to four possible cases: </p>
<ul>
<li>Push <em>operands</em> onto the operand stack.</li>
<li>Push <em>operators</em> onto the operator stack.</li>
<li>Ignore <em>left</em> parentheses.</li>
<li>On encountering a <em>right</em> parenthesis, pop an operator, pop the operands, and push onto the operand stack the result of applying the operator to those operands.</li>
</ul>
<p>After the final right parenthesis has been processed, there is one value on the stack, which is the value of the expression. For example, the algorithm computes the same value for all of these expressions:</p>
<pre><code>( 1 + ( ( 2 + 3 ) * ( 4 * 5 ) ) ) 
( 1 + ( 5 * ( 4 * 5 ) ) )
( 1 + ( 5 * 20 ) )
( 1 + 100 )
101
</code></pre>
<p>For simplicity, the code assume that the expression is fully parenthesized, with numbers and characters separated by whitespace:</p>
<pre><code class="language-python">def compute(expr: str) -&gt; float:
    &quot;&quot;&quot;
    Dijkstra's two-stack algorithm for expression evaluation.

    :param expr: an arithmetic expression
    :return: computed value
    &quot;&quot;&quot;
    ops = Stack()
    vals = Stack()
    expr = expr.split(' ')
    for c in expr:
        if c == '(':
            continue
        elif c in '+-*/':
            ops.push(c)
        elif c == ')':
            v = vals.pop()
            op = ops.pop()
            if op == '+':
                v = vals.pop() + v
            elif op == '-':
                v = vals.pop() - v
            elif op == '*':
                v = vals.pop() * v
            elif op == '/':
                v = vals.pop() / v
            vals.push(v)
        else:
            vals.push(float(c))
    return vals.pop()
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#for">1</a></sup> It will call <code>__getitem__()</code> instead if <code>__iter__()</code> is not available.</p>
<p><sup class="footnote-reference"><a href="#resize">2</a></sup> It is because of the resizing of an array.</p>
<p><sup class="footnote-reference"><a href="#arithmetic">3</a></sup> This example comes from <em>Algorithms, 4th</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stack-in-java"><a class="header" href="#stack-in-java">Stack In Java</a></h1>
<blockquote>
<p>Java has a built-in library called <code>java.util.Stack</code>, but you should avoid using it when you want a stack. It has several additional operations that are not normally associated with a stack, e.g., getting the ith element. </p>
</blockquote>
<h2 id="stack-based-on-arraylist"><a class="header" href="#stack-based-on-arraylist">Stack based on ArrayList</a></h2>
<p>Our first stacks are based on <code>ArrayList</code>, and the overall implementation is very similar to the one based on the <code>list</code> in Python. An upfront note is that generics are preferred for collections in Java, so the class is declared like:</p>
<pre><code class="language-java">public class ArrayListStack&lt;Item&gt; {
    private List&lt;Item&gt; elments;

    public ArrayListStack() {
        elments = new ArrayList&lt;&gt;();
    }
    ...
}
</code></pre>
<p>Some students may still get confused about the motivation of adopting the <code>generics</code>. It is very good feature in static languages (e.g., Java), because it will enforce types checking in the compiling stage. To put it in another way, it can forbid us mixing <em>apples</em> with <em>oranges</em>. In contrast, Python lacks such a useful feature, so the error-prone code is valid in Python:</p>
<pre><code class="language-python">s = Stack()
s.push(1)
s.push('apple')
</code></pre>
<p>Now let's go back to the Java's implementation. As we can see, <code>ArrayListStack</code> wraps an array list inside, and the implementations of these APIs are generally straightforward as long as you know the basic usage of an <code>ArrayList</code>.</p>
<ul>
<li><code>push()</code> is based on <code>add()</code>:</li>
</ul>
<pre><code class="language-java">public void push(Item item) {
    elements.add(item);
}
</code></pre>
<ul>
<li><code>size()</code> and <code>isEmpty()</code> have the methods with the same name:</li>
</ul>
<pre><code class="language-java">public int size() {
    return elements.size();
}

public boolean isEmpty() {
    return elements.isEmpty();
}
</code></pre>
<ul>
<li><code>pop()</code> is based on <code>remove()</code>, and it will return <code>null</code> if the stack is empty:</li>
</ul>
<pre><code class="language-java">public Item pop() {
    if (isEmpty()) {
        return null;
    }
    Item v = elements.get(size() - 1);
    elements.remove(size() - 1);
    return v;
}
</code></pre>
<p>Another common approach is to throw an exception if the stack is empty, and we adopt this implementation in this book:</p>
<pre><code class="language-java">if (isEmpty()) {
    throw new NoSuchElementException(&quot;Pop from empty stack!&quot;);
}
</code></pre>
<h2 id="iterator-1"><a class="header" href="#iterator-1">Iterator</a></h2>
<p>Iterators play the magic behind the scenes when we use the enhanced <em>for</em> loop. </p>
<p>In this subsection, we are going to make the following code valid:</p>
<pre><code class="language-java">ArrayListStack&lt;String&gt; stack = new ArrayListStack&lt;&gt;();
...
for (String s : stack) {
    System.out.println(s);
}
</code></pre>
<p>To make a class <em>iterable</em>, the first step is to add the phrase implements <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Iterable.html">Iterable</a> to its declaration, matching the interface</p>
<pre><code class="language-java">public interface Iterable&lt;Item&gt; {
    Iterator&lt;Item&gt; iterator();
}
</code></pre>
<p>So, the signature of the class becomes</p>
<pre><code class="language-java">public class ArrayListStack&lt;Item&gt; implements Iterable&lt;Item&gt;
</code></pre>
<p>It is often a good practice to prepare a single class to implement <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Iterator.html">Iterator</a>, where at least <code>next()</code> and <code>hasNext()</code> should be implemented<sup class="footnote-reference"><a href="#next">1</a></sup>. Also, this concrete iterator is designed as an <em>inner</em> class, so it can access its parent class directly<sup class="footnote-reference"><a href="#inner">2</a></sup>.</p>
<pre><code class="language-java">private class ReverseArrayListIterator implements Iterator&lt;Item&gt; {
    private int i = elements.size();
    @Override
    public boolean hasNext() {
        return i &gt; 0;
    }

    @Override
    public Item next() {
        return elements.get(--i);
    }
}
</code></pre>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/stack-queue/src/main/java/org/swufe/datastructure/ArrayListStack.java">ArrayListStack.java</a>.</p>
<p>By the way, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Iterable.html">Iterable</a> has offered a default <code>forEach()</code> API since 1.8, so the print code can be shortened to </p>
<pre><code class="language-java">stack.forEach(System.out::println);
</code></pre>
<h2 id="application-matching-parentheses--arithmetic-expression-evaluation"><a class="header" href="#application-matching-parentheses--arithmetic-expression-evaluation">Application: matching parentheses &amp; arithmetic expression evaluation</a></h2>
<p>Readers can try to implement the client code using <code>ArrayListStack</code> for these two applications, and this is left as an exercise.</p>
<h2 id="stack-based-on-array"><a class="header" href="#stack-based-on-array">Stack based on array</a></h2>
<p>In <a href="stack_queue/./stack_python.html">Stack in Python</a>, we summarized the time complexity of the operations of a stack:</p>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>Running time</th></tr></thead><tbody>
<tr><td>push()</td><td>\(O(1)\)</td></tr>
<tr><td>pop()</td><td>\(O(1)\)</td></tr>
<tr><td>is_empty()</td><td>\(O(1)\)</td></tr>
<tr><td>size()</td><td>\(O(1)\)</td></tr>
</tbody></table>
</div>
<p>We also pointed out that as for <code>push()</code> and <code>pop()</code>, the worst time is is <em>amortized</em> because it may have a bad time cost once a while. Now let's explore what happens exactly.</p>
<p>First, both <code>ArrayList</code> in Java and <code>list</code> in Python are based on arrays whose size are fixed. So how can we <code>push()</code> a new item onto it when it is <em>full</em>? The solution is to resize the array and copy the items to a new array<sup class="footnote-reference"><a href="#resize">3</a></sup>. To understand this, we shall introduce two different concepts:</p>
<ul>
<li><strong>size</strong>: how many items are there in the collection?</li>
<li><strong>capacity</strong>: how many items can this collection hold at most without resizing?</li>
</ul>
<pre><code class="language-java">List&lt;String&gt; list = new ArrayList&lt;&gt;();
</code></pre>
<p>The <em>size</em> of <code>list</code> is 0, and the default <em>capacity</em> is 10. So, even if you do not add any item into this list, it has an array with size of 10 inside. And after adding 10 items, the underlying array will be resized to a larger one in order to hold more data. During the resizing, a copying operation is required, so it can result in a bad running time once a while.</p>
<p>Therefore, if we would like to use arrays to hold the data for stacks, we shall deal with the resizing manually. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/stack-queue/src/main/java/org/swufe/datastructure/ArrayStack.java">ArrayStack.java</a>.</p>
<pre><code class="language-java">private void resize(int capacity) {
    assert capacity &gt;= n;
    a = Arrays.copyOf(a, capacity);
}
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#next">1</a></sup> In Python, the <code>__next__()</code> can be regarded as the combination of <code>next()</code> and <code>hasNext()</code> here.</p>
<p><sup class="footnote-reference"><a href="#inner">2</a></sup> Python's inner class does support this feature.</p>
<p><sup class="footnote-reference"><a href="#resize">3</a></sup> The resizing operation also happens when the size is much smaller than the capacity.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queues"><a class="header" href="#queues">Queues</a></h1>
<p>Different from stacks, a <strong>queue</strong> is a collection of objects that are inserted and removed according to the <em>first-in, first-out (FIFO)</em> policy. It supports two basic operations:</p>
<ul>
<li><code>enqueue()</code>: add a new item</li>
<li><code>dequeue()</code>: remove an item</li>
</ul>
<p>It also supports two more operations sometimes: <code>size()</code> and <code>isEmpty()</code>, returning <em>number of items in the queue</em>, and answering <em>is the queue empty?</em>, respectively.</p>
<blockquote>
<p>Queue: a line of people, usually standing or in cars, waiting for something (from Cambridge dictionary).</p>
</blockquote>
<p>When you hear of <em>queues</em>, you shall image a line of people waiting for the service before a counter as illustrated in the following figure<sup class="footnote-reference"><a href="#queue">1</a></sup>:</p>
<img src="stack_queue/image/queue.png" width="50%">
<p>As a running example of <em>queues</em>, let's consider what happens when you are calling 10086. Suppose there is only one telephone operator, and she is free now:</p>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Contents in the queue</th><th>Who is being served</th></tr></thead><tbody>
<tr><td>Bob is calling</td><td>[]</td><td>Bob</td></tr>
<tr><td>Alice is calling</td><td>[Alice]</td><td>Bob</td></tr>
<tr><td>Jack is calling</td><td>[Alice, Jack]</td><td>Bob</td></tr>
<tr><td>Mike is calling</td><td>[Alice, Jack, Mike]</td><td>Bob</td></tr>
<tr><td>Bob ends his calling</td><td>[Jack, Mike]</td><td>Alice</td></tr>
<tr><td>Mary is calling</td><td>[Jack, Mike, Mary]</td><td>Alice</td></tr>
<tr><td>Alice ends her calling</td><td>[Mike, Mary]</td><td>Jack</td></tr>
<tr><td>Jack ends his calling</td><td>[Mary]</td><td>Mike</td></tr>
</tbody></table>
</div>
<hr />
<p><sup class="footnote-reference"><a href="#queue">1</a></sup> This figure is from <em>Algorithms, 4th</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queues-in-python"><a class="header" href="#queues-in-python">Queues in Python</a></h1>
<p>An implementation of our <code>Queue</code> API based on the <code>list</code> data structure is also straightforward.</p>
<pre><code class="language-python">class Queue:
    &quot;&quot;&quot;A first-in, first-out (FIFO) data structure.&quot;&quot;&quot;

    def __init__(self):
        self._data = []

    def size(self):
        return len(self._data)

    def is_empty(self):
        return len(self._data) == 0

    def enqueue(self, item):
        self._data.append(item)

    def dequeue(self):
        if self.is_empty():
            raise NoElement('Dequeue from empty queue!')
        return self._data.pop(0)
</code></pre>
<p>Note that the <code>dequeue()</code> is based on <code>pop()</code> with index 0 as the parameter, meaning popping the first element from the list.</p>
<h2 id="iterator-2"><a class="header" href="#iterator-2">Iterator</a></h2>
<p>The iteration over a queue is like iterating a list, so we can reuse the iterator of the <code>list</code>:</p>
<pre><code class="language-python">def __iter__(self):
    return iter(self._data)
</code></pre>
<p>We do not have to implement the <code>__next__</code> method manually. By taking leveraging of iterators, we can use the following <code>for</code> statement:</p>
<pre><code class="language-python">q = Queue()
q.enqueue(1)
q.enqueue(9)
q.enqueue(4)
q.enqueue(9)
for i in q:
    print(i)
</code></pre>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/queue.py">queue.py</a>.</p>
<h2 id="time-complexity-1"><a class="header" href="#time-complexity-1">Time complexity</a></h2>
<p>The following table summerizes the queue's time complexity:</p>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>Running time</th></tr></thead><tbody>
<tr><td>enqueue()</td><td>\(O(1)\)</td></tr>
<tr><td>dequeue()</td><td>\(O(N)\)</td></tr>
<tr><td>is_empty()</td><td>\(O(1)\)</td></tr>
<tr><td>size()</td><td>\(O(1)\)</td></tr>
</tbody></table>
</div>
<p>As we can see, most operations, except for <code>dequeue()</code> are with constant time complexity<sup class="footnote-reference"><a href="#time">1</a></sup>, so it is very efficient. However, the <code>dequeue()</code> is inefficient as it grows linearly with respect to the size of the queue (i.e., <code>N</code>).</p>
<p>To validate this theoretical analysis, I design a simple benchmark to test the performance (see <code>queue_vary_size()</code> method in <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/benchmark.py">benchmark.py</a>). The main idea is summarized in the following:</p>
<ul>
<li>Initialize queues with different size (1000000, 2000000, 3000000, 4000000, 5000000).</li>
<li>Perform the <code>dequeue()</code> operation, and time it<sup class="footnote-reference"><a href="#random">2</a></sup>.</li>
</ul>
<img src="stack_queue/image/queue_benchmark.png" width="80%">
<p>As we expect, the running time is roughly linear with respect to the size of the queue.</p>
<p>Now let's explore the reason of the inefficiency. Since the underlying data structure is a list, when we call <code>enqueue()</code> on it, the first item will be removed and <strong>the next N-1 items will be shifted to the left</strong>. Clearly, this moving action will result in \(O(N)\). Of course this design still achieves an acceptable performance in applications in which queues have relatively modest size, but when it comes to a large amount of data, it should be improved.</p>
<h2 id="using-an-array-circularly"><a class="header" href="#using-an-array-circularly">Using an array circularly</a></h2>
<p>This subsection is adapted from <a href="https://www.geeksforgeeks.org/circular-queue-set-1-introduction-array-implementation/">Circular Queue</a>. Such structure is also known as <em>ring buffer</em> in many applications.</p>
<img src="https://media.geeksforgeeks.org/wp-content/uploads/Circular-queue.png">
<p>As illustrated in the figure above, we shall maintain a <em>front</em> pointer (i.e., <em>index</em>) to point to the first item and use <em>rear</em> pointer (i.e., <em>index</em>) to point to next available position<sup class="footnote-reference"><a href="#rear">3</a></sup>. Assume this circular array is large enough to hold all items:</p>
<ul>
<li><code>enqueue()</code>: update <em>rear</em> to next one in the clock-wise.</li>
<li><code>dequeue()</code>: update <em>front</em> to next one in the clock-wise.</li>
</ul>
<p>Now let's consider a running example to understand the principle of circular arrays. Suppose the size of the array is 8, and the queue <code>q</code> is empty at start, and the <code>front</code> is 0:</p>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>Front</th><th>Rear</th><th>Size</th></tr></thead><tbody>
<tr><td>(Start)</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>q.enqueue(10)</td><td>0</td><td>1</td><td>1</td></tr>
<tr><td>q.enqueue(20)</td><td>0</td><td>2</td><td>2</td></tr>
<tr><td>q.enqueue(30)</td><td>0</td><td>3</td><td>3</td></tr>
<tr><td>q.dequeue()</td><td>1</td><td>3</td><td>2</td></tr>
<tr><td>q.enqueue(40)</td><td>1</td><td>4</td><td>3</td></tr>
<tr><td>q.enqueue(50)</td><td>1</td><td>5</td><td>4</td></tr>
<tr><td>q.dequeue()</td><td>2</td><td>5</td><td>3</td></tr>
</tbody></table>
</div>
<p>Obviously, the <code>dequeue()</code> operation only results in a pointer shift, so <strong>the time complexity is \(O(1)\)</strong>. What a clever design! In addition, we can find that the specific pointer (i.e., <em>index</em>) does not really matter, so we can maintain <em>front</em> and <em>size</em> instead, and the <em>rear</em> can be computed based on them.</p>
<pre><code class="language-python">class CircularQueue:
    &quot;&quot;&quot;A queue based on a circular array.&quot;&quot;&quot;

    DEFAULT_CAPACITY = 10

    def __init__(self):
        self._data = [None] * CircularQueue.DEFAULT_CAPACITY
        self._size = 0
        self._front = 0
</code></pre>
<p>Then, what if we call <code>enqueue()</code> when <em>front</em> is 6 and <em>size</em> is 1? In this case, the implicit <em>rear</em> will become 0 because <code>(7 + 1) mod 8 = 0</code>. The <code>mod</code> operation makes the pointer in arrays be circular.</p>
<blockquote>
<p>It is only circular conceptually, and it is still a linear array. The implementation shares many ideas with <em>Stack based on array</em> in <a href="stack_queue/./stack_java.html">Stacks in Java</a>.</p>
</blockquote>
<p>A final problem to be addressed is to resize. As we have learned in <a href="stack_queue/./stack_java.html">Stacks in Java</a>, we shall resize the underlying array if the size reaches to its capacity.</p>
<pre><code class="language-python">def enqueue(self, item):
    # expand
    if self.size() == len(self._data):
        self._resize(2 * len(self._data))
    avail = (self._front + self.size()) % len(self._data)
    self._data[avail] = item
    self._size += 1
</code></pre>
<p>We always double the array's size when the size of a queue reaches to its capacity. <code>avail</code>, computed through a mod operation, means, in fact, <code>rear</code>, the available position in the array.</p>
<pre><code class="language-python">def dequeue(self):
    if self.is_empty():
        raise NoElement('Dequeue from empty queue!')
    # shrink (optional)
    if self.size() &lt;= len(self._data) // 4:
        self._resize(len(self._data) // 2)
    answer = self._data[self._front]
    self._data[self._front] = None
    self._front = (self._front + 1) % len(self._data)
    self._size -= 1
    return answer
</code></pre>
<p>The shrink operation is optional to save the memory space. Again, we update <code>front</code> through a mod operation. When the pointer shifts, it is a good practice to let it point to <code>None</code> for the sake of garbage collection.</p>
<p>The <em>resize</em> operation is a private method, and it is worthwhile to investigate how it works:</p>
<pre><code class="language-python">def _resize(self, capacity):
    assert capacity &gt; self.size()
    old = self._data
    self._data = [None] * capacity
    walk = self._front
    for i in range(self._size):
        self._data[i] = old[walk]
        walk = (1 + walk) % len(old)
    self._front = 0
</code></pre>
<img src="stack_queue/image/list_address.png" width="50%">
<p>To understand it, we shall have a basic knowledge about the object model in Python:</p>
<p>When we create a list <code>data</code>, we essentially create a list and assigns the reference to <code>data</code>. So <code>data</code> is not the list itself, and it roughly has two parts: the <em>address</em> pointing to the list, and the <em>size</em> of the list.</p>
<pre><code class="language-python">data = [1, 2, 3]
old = data
</code></pre>
<p>If we add a new item to <code>old</code>, then <code>data</code> will also be updated:</p>
<pre><code class="language-python">old.append(4)
# [1, 2, 3, 4]
print(data)
</code></pre>
<p>Therefore, <code>old</code> and <code>data</code> refer to the same object, but with different names<sup class="footnote-reference"><a href="#memory">4</a></sup>. Now let's revisit the implementation of <code>_resize()</code>. After <code>self._data = [None] * capacity</code> is called, it becomes</p>
<img src="stack_queue/image/list_address2.png" width="70%">
<p>The next step is to copy from <code>old[front..rear]</code> to <code>data[0.._size]</code>. Of course, the range from <code>front</code> to <code>near</code> may be circular, so it should be computed through the mod operation.</p>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/circular_queue.py">circular_queue.py</a>. Please try to implement an iterator for circular queues on your own before checking the code in GitHub.</p>
<h2 id="a-few-notes-on-queues"><a class="header" href="#a-few-notes-on-queues">A few notes on queues</a></h2>
<blockquote>
<p>When you need queues, please consider <a href="https://docs.python.org/3/library/collections.html#collections.deque">collections.deque</a>, instead of implementing a new one from the scratch.</p>
</blockquote>
<hr />
<p><sup class="footnote-reference"><a href="#time">1</a></sup> Like stacks, the time complexity of <code>enqueue()</code> is <em>amortized</em>.</p>
<p><sup class="footnote-reference"><a href="#random">2</a></sup> To avoid the randomness brought by a single operation, we repeat it 20 times. Since 20 is much smaller than the size of queue, the measured time still makes sense.</p>
<p><sup class="footnote-reference"><a href="#rear">3</a></sup> Some designs assume that <code>rear</code> points to the last item in a queue. In this case, <code>rear</code> is -1 when the queue is empty.</p>
<p><sup class="footnote-reference"><a href="#memory">4</a></sup> https://towardsdatascience.com/python-memory-and-objects-e7bec4a2845</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queues-in-java"><a class="header" href="#queues-in-java">Queues in Java</a></h1>
<p>An implementation of our <code>Queue</code> API based on the <code>ArrayList</code> data structure is also straightforward, and this is left as an exercise.</p>
<h2 id="using-an-array-circularly-1"><a class="header" href="#using-an-array-circularly-1">Using an array circularly</a></h2>
<p>The queues based on the <code>ArrayList</code> also suffers from the bad performance caused by <code>enqueue()</code>. Therefore, we will use an array circularly as the underlying data structure.</p>
<pre><code class="language-java">public class CircularArrayQueue&lt;Item&gt; implements Iterable&lt;Item&gt; {
    private static final int DEFAULT_CAPACITY = 10;
    private Item[] a;
    private int n; // number of elements in queue
    private int front;
    ...
}
</code></pre>
<p>Once you have understood how the circular array works, you can translate the Python implementation to its Java counterpart with ease. For example,</p>
<pre><code class="language-java">public void enqueue(Item item) {
    if (n == a.length) {
        resize(2 * a.length);
    }
    int avail = (front + n) % a.length;
    a[avail] = item;
    n += 1;
}
</code></pre>
<pre><code class="language-java">public Item dequeue() {
    if (isEmpty()) {
        throw new NoSuchElementException(&quot;Dequeue from empty queue!&quot;);
    }
    if (n &lt;= a.length / 4) {
        resize(a.length / 2);
    }
    Item answer = a[front];
    a[front] = null;
    n -= 1;
    front = (front + 1) % a.length;
    return answer;
}
</code></pre>
<p>Except for the syntax itself, they are the same exactly! The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/stack-queue/src/main/java/org/swufe/datastructure/CircularQueue.java">CircularQueue.java</a>.</p>
<h2 id="an-experimental-evaluation"><a class="header" href="#an-experimental-evaluation">An experimental evaluation</a></h2>
<p>According to the theoretical analysis, the time complexity of <code>dequeue()</code> of circular queues is \(O(1)\). To what follows, I design a small benchmark to evaluate its performance (<a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/stack-queue/src/main/java/org/swufe/datastructure/Benchmark.java">Benchmark.java</a>).</p>
<p>We initialize the size in the range of [10000000, 20000000, 30000000, 40000000, 50000000], and we find that no matter how the size changes, the measured is always 0! It is very fast with a constant time complexity.</p>
<h2 id="a-few-notes-on-queue-interface"><a class="header" href="#a-few-notes-on-queue-interface">A few notes on <code>Queue</code> interface</a></h2>
<blockquote>
<p>When you need queues, please have a look at the implementing classes of <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Queue.html">Queue</a> interface, instead of implementing a new one from the scratch.</p>
</blockquote>
<p>Java offers the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Queue.html">Queue</a> interface, which has the following methods:</p>
<ul>
<li><code>add()</code>: Inserts the specified element into this queue if it is possible to do so immediately without violating capacity restrictions, returning true upon success and throwing an IllegalStateException if no space is currently available.</li>
<li><code>remove()</code>: Retrieves and removes the head of this queue.</li>
</ul>
<p>These two methods would throw exceptions. In contrast, it also provides a pair of APIs to return special value:</p>
<ul>
<li><code>offer()</code>: Inserts the specified element into this queue if it is possible to do so immediately without violating capacity restrictions.</li>
<li><code>poll()</code>: Retrieves and removes the head of this queue, or returns null if this queue is empty.</li>
</ul>
<p>To use a queue, we often need to choose one of its implementing classes, such as <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ArrayDeque.html">ArrayDeque</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/LinkedList.html">LinkedList</a>. For example,</p>
<pre><code class="language-java">Queue&lt;String&gt; q = new LinkedList&lt;&gt;();
q.offer(&quot;data&quot;);
q.offer(&quot;structure&quot;);
q.offer(&quot;is&quot;);
q.offer(&quot;fun&quot;);
assert Objects.equals(q.poll(), &quot;data&quot;);
assert Objects.equals(q.poll(), &quot;structure&quot;);
</code></pre>
<p>Although we have not learned <code>LinkedList</code> in detail yet, we are still able to use its public APIs<sup class="footnote-reference"><a href="#linkedlist">1</a></sup> because the interface makes such promise.</p>
<hr />
<p><sup class="footnote-reference"><a href="#linkedlist">1</a></sup> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/LinkedList.html">LinkedList</a> is very complex by offering plenty of APIs.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deques"><a class="header" href="#deques">Deques</a></h1>
<p>In this section, we consider a queue-like data structure that supports insertion and deletion at both the front and the back of the queue. Such a structure is called a <strong>double-ended queue</strong>, or <strong>deque</strong>, which is usually pronounced <em>deck</em> to avoid confusion.</p>
<p>The deque collection is more general than both the stack and queue. The extra generality makes it appealing in many applications. Let's consider the analogy that people are calling 10086, and it is often described as a queue. But in reality, people who are at the end of the queue may become impatient and leave the queue (<code>delete_last()</code>). Besides, someone who is a VIP can jump the queue (<code>add_first()</code>) without long time waiting.</p>
<p>A deque supports the following methods:</p>
<ul>
<li><code>add_first()</code>: Add a new element to the front of a deque</li>
<li><code>add_last()</code>: Add a new element to the end of a deque</li>
<li><code>delete_first()</code>: Remove and return the first element from a deque</li>
<li><code>delete_last()</code>: Remove and return the last element from a deque</li>
</ul>
<p>Additionally, it will include the following accessors:</p>
<ul>
<li><code>first()</code>: Return (but not to remove) the first element of a deque</li>
<li><code>last()</code>: Return (but not to remove) the last element of a deque </li>
<li><code>is_empty()</code>: Return <code>True</code> if a deque does not contain any element</li>
<li><code>size()</code>: Return the number of elements in a deque</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deques-in-python"><a class="header" href="#deques-in-python">Deques in Python</a></h1>
<p>Luckily, <a href="https://docs.python.org/3/library/collections.html#collections.deque">collections.deque</a> has been designed in Python, which have fast <em>appends</em> and <em>pops</em> from both ends.</p>
<pre><code class="language-python">from collections import deque
q = deque(['structures', 'is'])
q.append('fun') # add_last
q.append('!') # add_last
q.appendleft('data') # add_first
q.pop() # delete_last
print(q)
q.popleft() # delete_first
print(q)
</code></pre>
<p>As we can see, <code>append()</code> is to add to the end, while <code>appendleft()</code> is to add to the front; <code>pop()</code> is to remove the last, while <code>popleft()</code> is to remove the first.</p>
<h2 id="deques-based-on-circular-arrays"><a class="header" href="#deques-based-on-circular-arrays">Deques based on circular arrays</a></h2>
<p>In practice, <a href="https://docs.python.org/3/library/collections.html#collections.deque">collections.deque</a> is always your top choice. But as for learning, it is meaningful and interesting to implement a deque on our own. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/array_deque.py">array_deque.py</a>.</p>
<pre><code class="language-python">class ArrayDeque:
    &quot;&quot;&quot;A double-ended queue (deque) based on circular queues.&quot;&quot;&quot;

    DEFAULT_CAPACITY = 10

    def __init__(self):
        self._data = [None] * ArrayDeque.DEFAULT_CAPACITY
        self._size = 0
        self._front = 0
</code></pre>
<p>Clearly, <code>add_last()</code> is exactly the same with <code>enqueue()</code>, and <code>remove_first()</code> is exactly the same with <code>dequeue()</code>.</p>
<p>As for <code>as_first()</code> and <code>delete_last()</code>, we rely on mod to circularly decrement the index<sup class="footnote-reference"><a href="#mod">1</a></sup>:</p>
<pre><code class="language-python">def add_first(self, item):
    if self.size() == len(self._data):
        self._resize(2 * len(self._data))
    self._front = (self._front - 1) % len(self._data)
    self._data[self._front] = item
    self._size += 1
</code></pre>
<pre><code class="language-python">def delete_last(self):
    if self.is_empty():
        raise NoElement('Remove from empty queue!')
    if self.size() == len(self._data) // 4:
        self._resize(len(self._data) // 2)
    back = (self._front + self._size - 1) % len(self._data)
    answer = self._data[back]
    self._data[back] = None
    self._size -= 1
    return answer
</code></pre>
<h2 id="application-number-of-recent-calls"><a class="header" href="#application-number-of-recent-calls">Application: number of recent calls</a></h2>
<p>This application is from <a href="https://leetcode.com/problems/number-of-recent-calls/">leetcode</a>, and readers shall check the question description by themselves.</p>
<p>As for this problem, one feasible algorithm is to use <code>deque</code>:</p>
<pre><code class="language-python">from collections import deque


class RecentCounter:
    def __init__(self):
        self.data = deque()

    def ping(self, t: int) -&gt; int:
        while len(self.data) &gt; 0 and (t - 3000) &gt; self.data[0]:
            self.data.popleft()
        self.data.append(t)
        return len(self.data)
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#mod">1</a></sup> <code>-1 mod n = n - 1</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deques-in-java"><a class="header" href="#deques-in-java">Deques in Java</a></h1>
<p>JDK is shipped with the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Deque.html">Deque</a> interface as well as many useful implementing classes, including <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ArrayDeque.html">ArrayDeque</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/LinkedList.html">LinkedList</a>. In this section, we use <code>ArrayDeque</code> as the running example, which is a resizable-array implementation of the <code>Deque</code> interface. <code>Deque</code> defines methods to access the elements at both ends of the deque.</p>
<pre><code class="language-java">Deque&lt;String&gt; deque = new ArrayDeque&lt;&gt;();
deque.offerLast(&quot;structures&quot;);
deque.offerLast(&quot;is&quot;);
deque.offerFirst(&quot;data&quot;);
deque.offerLast(&quot;fun&quot;);
assert Objects.equals(deque.pollFirst(), &quot;data&quot;);
assert Objects.equals(deque.peekLast(), &quot;fun&quot;);
</code></pre>
<p>The implementation based on circular arrays by yourself is left as an exercise.</p>
<blockquote>
<p>If you need deques in your project, please choose one of the implementing classes from JDK, instead of designing a new one from the scratch.</p>
</blockquote>
<h2 id="application-number-of-recent-calls-1"><a class="header" href="#application-number-of-recent-calls-1">Application: number of recent calls</a></h2>
<p>This application is from <a href="https://leetcode.com/problems/number-of-recent-calls/">leetcode</a>, and readers shall check the question description by themselves.</p>
<p>As for this problem, one feasible algorithm is to use <code>ArrayDeque</code>:</p>
<pre><code class="language-java">import java.util.ArrayDeque;
import java.util.Deque;

public class RecentCounter {
    private final Deque&lt;Integer&gt; data;

    public RecentCounter() {
        data = new ArrayDeque&lt;&gt;();
    }

    public int ping(int t) {
        while (!data.isEmpty() &amp;&amp; (t - 3000) &gt; data.peekFirst()) {
            data.pollFirst();
        }
        data.offerLast(t);
        return data.size();
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-1"><a class="header" href="#exercise-1">Exercise</a></h1>
<ol>
<li>As for stacks, another operation <code>top()</code> (also known as <code>peek()</code>) is often used. It works like <code>pop()</code>, but it will keep the item in the stack. Please implement <code>peek()</code> method in Java or Python.</li>
</ol>
<hr />
<ol start="2">
<li>In <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/stack.py">stack.py</a>, we would often expect that <code>len()</code> can be used directly like other collections in Python:</li>
</ol>
<pre><code class="language-python">s = Stack()
print(len(s))
</code></pre>
<p>Please make it possible for <code>Stack</code>.</p>
<p><em>Hint: you can refer to <a href="https://blog.finxter.com/python-__len__-magic-method/">Python <code>__len__()</code> Magic Method</a>.</em></p>
<hr />
<ol start="3">
<li>In <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/evaluate.py">evaluate.py</a>,  <code>if</code> statement is used to determine the evaluation logic:</li>
</ol>
<pre><code class="language-python">if op == '+':
    v = vals.pop() + v
elif op == '-':
    v = vals.pop() - v
elif op == '*':
    v = vals.pop() * v
elif op == '/':
    v = vals.pop() / v
</code></pre>
<p>Please try to refactor via <a href="https://docs.python.org/3/library/operator.html">operator</a> module to simplify the code. </p>
<p><em>Hint: you can refer to <a href="https://stackoverflow.com/questions/1740726/">Turn string into operator</a>.</em></p>
<hr />
<ol start="4">
<li>The current implementation for Dijkstra's two-stack algorithm for expression evaluation (<a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/evaluate.py">evaluate.py</a>, <a href="stack_queue/">Evaluate.java</a>) only support <code>+</code>, <code>-</code>, <code>*</code>, and <code>/</code>. Please add the <code>sqrt</code> operator that takes just one argument.</li>
</ol>
<pre><code class="language-python">v = evaluate.compute('( ( 1 + sqrt ( 5.0 ) ) / 2.0 )')
print(v)
</code></pre>
<hr />
<ol start="5">
<li>Please implement matching parentheses and arithmetic expression evaluation based on <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/stack-queue/src/main/java/org/swufe/datastructure/ArrayListStack.java">ArrayListStack.java</a> using Java respectively.</li>
</ol>
<hr />
<ol start="6">
<li>The theoretical analysis shows that the time complexity of <code>dequeue()</code> of circular queues is \(O(1)\). Please design experiments and visualize your results to validate this theoretical cost based on <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/stack-queue/circular_queue.py">circular_queue.py</a>.</li>
</ol>
<hr />
<ol start="7">
<li>The built-in <code>id()</code> function returns the memory address, and  You can also check if two variables are pointing to the same object using <code>is</code> operator. Try to use those two methods to validate <code>a</code> and <code>b</code> point to the same object:</li>
</ol>
<pre><code class="language-python">a = [1, 2, 3]
b = a
</code></pre>
<hr />
<ol start="8">
<li>Please implement a queue based on <code>ArrayList</code> in Java.</li>
</ol>
<hr />
<ol start="9">
<li>As for queues, another operation <code>first()</code> (also known as <code>peek()</code>) is often used. It works like <code>dequeue()</code>, but it will keep the item in the queue. Please implement <code>peek()</code> method in Java or Python based on circular queues.</li>
</ol>
<hr />
<ol start="10">
<li>Please implement a deque based on circular arrays in Java.</li>
</ol>
<hr />
<ol start="11">
<li>Try to solve problems tagged with <a href="stack_queue/(https://leetcode.com/tag/stack/)">stack</a> or <a href="https://leetcode.com/tag/queue/">queue</a> in LeetCode.</li>
</ol>
<hr />
<ol start="12">
<li>Postfix notation is an unambiguous way of writing an arithmetic expression without parentheses. It is defined so that if &quot;(exp1)op(exp2)&quot; is a normal fully parenthesized expression whose operation is <code>op</code>, the postfix version of this is &quot;exp1 exp2 op&quot;. </li>
</ol>
<p>So, for example, the postfix version of &quot;((5 + 2) * (8 − 3))/4&quot; is &quot;5 2 + 8 3 − * 4 /&quot;. Describe an algorithm to evaluate an expression in postfix notation. For simplicity, the numbers and operators are separated with a space.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lists"><a class="header" href="#lists">Lists</a></h1>
<p>Lists are fundamental data structures, and we have used its <em>array</em> based version (e.g., <code>ArrayList</code> in Java and <code>list</code> in Python) in the daily programming tasks. What's more, the previous <code>stacks</code>, <code>queues</code> and <code>deques</code> are also in fact based on a list. </p>
<p>In this chapter, we will investigate lists in a comprehensive way. Particularly, a challenging structure called <em>linked list</em> will be introduced. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-list-adt"><a class="header" href="#the-list-adt">The List ADT</a></h1>
<p>In this section, we will formally introduce an important concept: </p>
<blockquote>
<p>Abstract Data type (ADT) is a type (or class) for objects whose behavior is defined by a set of values and a set of operations.</p>
</blockquote>
<p>So, the previous introduced stacks, queues, and deques all are ADTs. You do not need to know how a data type is implemented in order to be able to use it. Note that the definition of ADT only mentions what operations are to be performed but not how these operations will be implemented. For example, a queue based on <code>ArrayList</code> and a queue based on circular arrays are two different implementations of the queue ADT.</p>
<p>The list ADT represent an ordered collection containing <strong>linear sequence of elements</strong>, but with more general support for adding or removing elements at arbitrary positions. Since it is linear, locations within a list ADT are easily described with an integer <strong>index</strong>.</p>
<p>With that said, Java defines a general interface, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html">java.util.List</a>, that includes the following useful methods<sup class="footnote-reference"><a href="#index">1</a></sup> (and more):</p>
<ul>
<li><code>add(e)</code>: Appends the specified element to the end of this list.</li>
<li><code>add(i, e)</code>: Inserts the specified element at the specified position in this list.</li>
<li><code>contains(o)</code>: Returns true if this list contains the specified element.</li>
<li><code>get(i)</code>: Returns the element at the specified position in this list.</li>
<li><code>indexOf(o)</code>: Returns the index of the first occurrence of the specified element in this list, or -1 if this list does not contain the element.</li>
<li><code>isEmpty()</code>: Returns true if this list contains no elements.</li>
<li><code>lastIndexOf​(o)</code>: Returns the index of the last occurrence of the specified element in this list, or -1 if this list does not contain the element.</li>
<li><code>remove(i)</code>: Removes the element at the specified position in this list.</li>
<li><code>remove(o)</code>: Removes the first occurrence of the specified element from this list, if it is present.</li>
<li><code>set(i, o)</code>: Replaces the element at the specified position in this list with the specified element.</li>
<li><code>size()</code>: Returns the number of elements in this list.</li>
</ul>
<p><code>ArrayList</code> is a well known implementing class of <code>List</code> interface, and you can play with those methods on it.</p>
<h2 id="revisit-pythons-list"><a class="header" href="#revisit-pythons-list">Revisit Python's <code>list</code></a></h2>
<p>Now let's revisit the methods provided by Python's <code>list</code>, and then compare them with their Java's counterparts.</p>
<blockquote>
<p>Python's <code>list</code> is very closely related to the <code>ArrayList</code> class in Java.</p>
</blockquote>
<div class="table-wrapper"><table><thead><tr><th>Java's List</th><th>Python's <code>list</code></th></tr></thead><tbody>
<tr><td>add(e)</td><td>append(e)</td></tr>
<tr><td>add(i, e)</td><td>insert(i, e)</td></tr>
<tr><td>contains(o)</td><td><code>in</code></td></tr>
<tr><td>get(i)</td><td><code>[i]</code></td></tr>
<tr><td>indexOf(o)</td><td>index(o)</td></tr>
<tr><td>isEmpty()</td><td>built-in <code>len()</code></td></tr>
<tr><td>lastIndexOf​(o)</td><td>*</td></tr>
<tr><td>remove(i)</td><td>pop(i)</td></tr>
<tr><td>remove(o)</td><td>remove(o)</td></tr>
<tr><td>set(i, o)</td><td><code>[i]</code></td></tr>
<tr><td>size()</td><td>built-in <code>len()</code></td></tr>
</tbody></table>
</div>
<p>The implementation marked with * is left as an exercise.</p>
<hr />
<p><sup class="footnote-reference"><a href="#index">1</a></sup> Most of them are index-based.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="arraylist"><a class="header" href="#arraylist">ArrayList</a></h1>
<p>One popular implementation of the list ADT is <em>array</em> based, which we have used it before. So, what is an array exactly?</p>
<blockquote>
<p>An array is a linear data structure that collects elements of the same data type and stores them in contiguous and adjacent memory locations. </p>
</blockquote>
<p>There are two key points about elements in an array:</p>
<ul>
<li>The same type.</li>
<li>Contiguous in memory.</li>
</ul>
<p>By this definition, Python's <code>list</code> is not an array<sup class="footnote-reference"><a href="#array">1</a></sup> because it can hold elements with mixing types. Those two features result in pros and cons at the same time.</p>
<ul>
<li>It is very efficient for index-based accessor methods.</li>
<li>It can be time-consuming when shifting or copying is required (e.g., <code>dequeue()</code> in array-based queue, and <code>resize()</code>). </li>
</ul>
<img src="list/image/array-shift.png" width="70%">
<p>The figure<sup class="footnote-reference"><a href="#shift">2</a></sup> above illustrates (a) shifting up for an insertion at index <em>i</em>; (b) shifting down for a removal at index <em>i</em>.</p>
<p>Once you have grasped the usages of an array, you are able to implement your own <em>ArrayList</em> in Java, and this is left as an exercise.</p>
<h2 id="pseudo-code"><a class="header" href="#pseudo-code">Pseudo code</a></h2>
<p>Previously, we use either plain English or a specific programming language to describe an algorithm, but it lacks of generality to some extent. This is because data structures and algorithms can be virtually written in all programming languages<sup class="footnote-reference"><a href="#lan">3</a></sup>. Therefore, we are seeking for a more general approach. The plain English is a candidate method, but it is overly verbose. More importantly, it is not accurate. </p>
<p>In this subsection, we are going to study the pseudo-code programming. The term <em>pseudo-code</em> refers to an informal, English-like notation for describing how an algorithm, a method, a class, or a program will work.</p>
<p>Pseudo-code is written using English-like statements, so target language coding details should be avoided if possible. On the other hand, common language elements such <code>if</code>, <code>for</code> and <code>return</code> can be used to used. Even, some common operations of well known ADT can also be adopted to simplify the statements (e.g., <code>push()</code>, <code>size()</code>).</p>
<blockquote>
<p>There is no standard about how to write pseudo-code. In this book, we will mainly follow the styles in <a href="https://www.ctan.org/pkg/algorithm2e">algorithm2e</a>.</p>
</blockquote>
<h3 id="example-indexofa-o"><a class="header" href="#example-indexofa-o">Example: <code>indexOf(a, o)</code></a></h3>
<p>How to implement the <code>indexOf(a, o)</code> method of an <code>ArrayList</code>? For the ease of description, we assume the <em>array</em> itself is the first parameter <code>a</code>. Let's describe this simple algorithm in pseudo code:</p>
<img src="list/image/indexof.png" width="80%">
<p>As we can see, a well-written pseudo code is easy to read and understand. In this way, programmers with different background can write this algorithm in their favorite languages.</p>
<h3 id="example-selection-sort"><a class="header" href="#example-selection-sort">Example: selection sort</a></h3>
<p>Let's have a look at one of the simplest sorting methods for arrays<sup class="footnote-reference"><a href="#sort">4</a></sup>. The objective of the sorting algorithm is to rearrange the items such that their keys are ordered according to some well-defined ordering rule (usually numerical or alphabetical order).</p>
<blockquote>
<p>Both Java and Python provide built-in sorting algorithms for collections.</p>
</blockquote>
<p>It works as follows: First, find the smallest item in the array and exchange it with the first entry (itself if the first entry is already the smallest). Then, find the next smallest item and exchange it with the second entry. Continue in this way until the entire array is sorted. This method is called <strong>selection sort</strong> because it works by repeatedly selecting the smallest remaining item.</p>
<p>The following is the pseudo code for selection sort. Readers can try to implement this algorithm using Java or Python, and this is left as an exercise.</p>
<img src="list/image/alg-selection-sort.png" width="80%">
<p>Note that here we used an English statement to describe the swapping operation in line 9.</p>
<hr />
<p><sup class="footnote-reference"><a href="#array">1</a></sup> Python's <a href="https://docs.python.org/3/library/array.html">array</a> module can compactly represent an array of basic numeric values.</p>
<p><sup class="footnote-reference"><a href="#shift">2</a></sup> This figure is from <em>Data Structures and Algorithms in Java</em>.</p>
<p><sup class="footnote-reference"><a href="#lan">3</a></sup> Of course, different programming languages have their unique features, and thus the detailed implementation may differ from each other greatly.</p>
<p><sup class="footnote-reference"><a href="#sort">4</a></sup> We will explore sorting comprehensively in <a href="list/../sorting/intro.html">Sortings</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linkedlist"><a class="header" href="#linkedlist">LinkedList</a></h1>
<p>Different from an array based list, a linked list can be stored in non-contiguous memory, so this ADT performs well when we insert or remove an element at some position in a list because no any shifting is required. Of course, it has trade-offs. Since it is not contiguous, index-based retrieving is less efficient for a linked list ADT, because we have to scan the whole list at the worst case.</p>
<p>A typical illustration of a (singly) linked list is like:</p>
<img src="list/image/single-list.png" width="60%">
<blockquote>
<p>Our implementation serves as a model for the code that we use for building more complex data structures throughout the book, so you should read this section carefully, even if you have experience working with linked lists.</p>
</blockquote>
<p>As we can see, a linked list consists of a sequence of <em>nodes</em>, and the previous node has a link pointing to the next one. The following is working definition for linked lists:</p>
<blockquote>
<p>A linked list is a <strong>recursive</strong> data structure that is either empty (<code>null</code>) or a
reference to a node having an item and a reference to a linked list.</p>
</blockquote>
<p>By default, a linked list is a <strong>singly linked list</strong>, whose node has only one link to the next node. If every node also has a link to its previous node, it is called <strong>doubly linked list</strong>.</p>
<p>With object-oriented programming, implementing linked lists is not difficult. We start with a class that defines the node abstraction:</p>
<pre><code class="language-java">class Node {
    Item item;
    Node next;
}
</code></pre>
<pre><code class="language-python">class Node:
    def __init__(self, item, next=None):
        self.item = item
        self.next = next
</code></pre>
<p>As for the linked list shown in the figure, we can use the following code:</p>
<pre><code class="language-python">first = Node(1)
second = Node(9)
third = Node(8)
first.next = second
second.next = third
</code></pre>
<p>From the definition, we can know that one is able to use the first node (<code>first</code> in our case) to represent a whole linked list, and the first node often is known as <code>head</code>. As for the procedure-oriented programming language (e.g., C), this is the only way to design a linked list.</p>
<p>In what follows, I will describe the common methods for a linked list ADT in a procedure-first way, and we are going to translate those pseudo code into Python or Java code in the following sections.</p>
<h2 id="size-the-number-of-elements"><a class="header" href="#size-the-number-of-elements"><code>size()</code>: the number of elements</a></h2>
<p>The idea is straightforward: scanning the linked list from <code>head</code>, and stop util we reach a <code>null</code>.</p>
<img src="list/image/alg-sll-size.png" width="80%">
<p>In practice, this method is not necessary due to its inefficiency (\(O(N)\)), and we can store its size an attribute directly. Since adding a <code>size</code> is trivial, and for the ease of description, we will not show how to use and update <code>size</code> attribute in the pseudo code.</p>
<h2 id="isempty-return-true-if-there-is-no-any-element"><a class="header" href="#isempty-return-true-if-there-is-no-any-element"><code>isEmpty()</code>: return true if there is no any element</a></h2>
<p>One solution is to check whether its size is 0. The following shows an equivalent approach with the constant time complexity:</p>
<img src="list/image/alg-sll-empty.png" width="80%">
<h2 id="addfirst-add-an-element-at-the-beginning"><a class="header" href="#addfirst-add-an-element-at-the-beginning"><code>addFirst()</code>: add an element at the beginning</a></h2>
<p>The main idea is that we create a new node with the new element, set its <code>next</code> link to refer to the current <code>head</code>, and set the list’s <code>head</code> to point to the new node.</p>
<img src="list/image/sll-addfirst.png" width="80%">
<p>This figure illustrates (a) before the insertion; (b) after a new node is created and linked to the existing head; (c) after reassignment of the head reference to the newest node.</p>
<img src="list/image/alg-sll-addfirst.png" width="80%">
<p>Recall that adding an element to an array cost \(O(n)\) when resizing is required, but this algorithm always costs only \(O(1)\).</p>
<h2 id="addlast-add-an-element-at-the-end"><a class="header" href="#addlast-add-an-element-at-the-end"><code>addLast()</code>: add an element at the end</a></h2>
<p>The last position is also known as <code>tail</code>. If the linked list also maintains the <code>tail</code> node, then the implementation is trivial: just update the <code>tail</code> reference itself to the newly created node. It runs in \(O(1)\).</p>
<img src="list/image/sll-addlast.png" width="80%">
<p>But we have to consider another corner case: <strong>when the linked list is empty, both <code>head</code> and <code>tail</code> is null, so it is illegal to use <code>tail.next = newest</code></strong>.</p>
<img src="list/image/alg-sll-addlast.png" width="80%">
<blockquote>
<p>We need to care about whether a node is null when designing algorithms for the linked list ADT<sup class="footnote-reference"><a href="#null">1</a></sup>.</p>
</blockquote>
<p>Additionally, if we introduce a <code>tail</code> for a linked list, the algorithm for adding an element should be updated accordingly. Some people may think the following algorithm is more easy-to-understand:</p>
<pre><code class="language-python">def add_last(self, item):
    newest = Node(item)
    if self.is_empty():
        self.head = newest
    else:
        self.tail.next = newest
    self.tail = newest
</code></pre>
<p>Now let's consider the situation where the <code>tail</code> does not exist. In this case, we need to compute the <code>tail</code> manually first, and therefore it runs in \(O(N)\).</p>
<img src="list/image/alg-sll-addlast2.png" width="80%">
<p>We can also observe another trade-off here: maintaining an extra pointer (i.e., <code>tail</code>) costs some overhead in space, but it gains much performance in time.</p>
<h2 id="removefirst-remove-an-element-at-the-beginning"><a class="header" href="#removefirst-remove-an-element-at-the-beginning"><code>removeFirst()</code>: remove an element at the beginning</a></h2>
<p>If the linked list is empty, then an exception should be thrown. Otherwise, we update the <code>head</code> to the second node.</p>
<img src="list/image/sll-removefirst.png" width="80%">
<p>This can be done in \(O(1)\):</p>
<img src="list/image/alg-sll-removefirst.png" width="80%">
<h2 id="removelast-remove-an-element-at-the-end"><a class="header" href="#removelast-remove-an-element-at-the-end"><code>removeLast()</code>: remove an element at the end</a></h2>
<p>The basic idea seems simple: if the linked list is empty, then an exception should be thrown. Otherwise, we update the <code>tail</code> to the second node to last. The key point is how to find <em>the second node to last</em>.</p>
<img src="list/image/alg-sll-removelast.png" width="80%">
<p>As we can see, it is a little tricky to delete the last node of a singly linked list. Since we have to walk through the linked list, the time complexity is \(O(N)\). We will introduce a simpler and more efficient way based on doubly linked lists.</p>
<hr />
<p><sup class="footnote-reference"><a href="#null">1</a></sup> You may consider some corner cases: the list is null, the size is one.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linked-list-in-python"><a class="header" href="#linked-list-in-python">Linked List in Python</a></h1>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/lists/linked_list.py">linked_list.py</a>.</p>
<h2 id="a-few-notes-on-implementation"><a class="header" href="#a-few-notes-on-implementation">A few notes on implementation</a></h2>
<p>When translating the pseudo code into its Python's implementation, we shall pay attention to comparison between objects.</p>
<pre><code class="language-python">def remove_first(self):
    if self.is_empty():
        raise IndexError('Remove from empty linked list')
    else:
        self._head = self._head.next
        if self._head is None:
            self._tail = None
        self._size -= 1
</code></pre>
<p>The code above shows the procedure of removing the first element in a linked list. If there was only one element, then both <code>head</code> and <code>tail</code> should be set to <code>None</code>. To check whether current head is <code>None</code>, we use the built-in <code>is</code>, instead of <code>==</code>.</p>
<blockquote>
<p><code>is</code> will return True if two variables point to the same object (in memory). <code>==</code> will return True if the objects referred to by the variables are equal. See more at <a href="https://stackoverflow.com/questions/132988/">Is there a difference between &quot;==&quot; and &quot;is&quot;?</a>.</p>
</blockquote>
<h3 id="shorter-yet-obscure"><a class="header" href="#shorter-yet-obscure">Shorter yet obscure</a></h3>
<p>As for nodes in linked lists, we shall focus on how to assign values and relink the <code>next</code> pointer. Sometimes, <em>relinking</em> twice can be shortened by leveraging of <code>__init__</code>. For example, the following code is to add an element onto a stack (we will check it later):</p>
<pre><code class="language-python"># push() = add_first()
def push(self, item):
    node = Node(item)
    node.next = self._head
    self._head = node
    self._size += 1
</code></pre>
<p>It can be shortened to:</p>
<pre><code class="language-python"># push() = add_first()
def push(self, item):
    self._head = Node(item, self._head)
    self._size += 1
</code></pre>
<p>It is shorter, but a bit more difficult to understand. Some people may strive for elegance and prefer to shorter code, while others may give a priority to ease-of-understanding. Again, it is a <em>trade-off</em>.</p>
<h2 id="stack-based-on-linked-lists"><a class="header" href="#stack-based-on-linked-lists">Stack based on linked lists</a></h2>
<p>In this subsection, we are going to implement a stack based on singly linked lists. </p>
<blockquote>
<p>A stack is a collection of objects that are inserted and removed according to the last-in, first-out (LIFO) policy.</p>
</blockquote>
<p>The two main operations of a stack can be described in the following, and both of them run in \(O(1)\):</p>
<ul>
<li><code>push()</code>: <code>add_first()</code> in a linked list</li>
<li><code>pop()</code>: <code>remove_first()</code> in a linked list</li>
</ul>
<p>As we can see, only the <code>head</code> pointer is necessary here. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/lists/linked_stack.py">linked_stack.py</a>, which is a simplified implementation of a linked list.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Array-based stack</th><th>LinkedList-based stack</th><th>Note</th></tr></thead><tbody>
<tr><td><code>push()</code></td><td>\(O(1)\)</td><td>\(O(1)\)</td><td>Array-based is amortized</td></tr>
<tr><td><code>pop()</code></td><td>\(O(1)\)</td><td>\(O(1)\)</td><td>Array-based is amortized</td></tr>
</tbody></table>
</div>
<h2 id="queue-based-on-linked-lists"><a class="header" href="#queue-based-on-linked-lists">Queue based on linked lists</a></h2>
<p>In this subsection, we are going to implement a stack based on singly linked lists. </p>
<blockquote>
<p>A queue is a collection of objects that are inserted and removed according to the first-in, first-out (FIFO) policy.</p>
</blockquote>
<p>The two main operations of a queue can be described in the following, and both of them run in \(O(1)\):</p>
<ul>
<li><code>enqueue()</code>: <code>add_last()</code> in a linked list</li>
<li><code>dequeue()</code>: <code>remove_first()</code> in a linked list</li>
</ul>
<p>We shall maintain both <code>head</code> and <code>tail</code> for a queue. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/lists/linked_queue.py">linked_queue.py</a>, which is also a simplified implementation of a linked list.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Array-based queue</th><th>LinkedList-based queue</th><th>Note</th></tr></thead><tbody>
<tr><td><code>enqueue()</code></td><td>\(O(1)\)</td><td>\(O(1)\)</td><td>Array-based is amortized</td></tr>
<tr><td><code>dequeue()</code></td><td>\(O(N)\)</td><td>\(O(1)\)</td><td>Not the circular array</td></tr>
</tbody></table>
</div>
<h2 id="circularly-linked-list"><a class="header" href="#circularly-linked-list">Circularly linked list</a></h2>
<p>A <strong>circularly linked list</strong> is essentially a singly linked list in which the <code>next</code> reference to the tail node is set to refer back to the head of the list (rather than <code>null</code>).</p>
<img src="list/image/circular_linkedlist.png" width="80%">
<p>This ADT can be used in applications in which data can be more naturally viewed as having a <em>cyclic order</em>, with well-defined neighboring relationships, but no fixed beginning or end. Note that there is a link from <code>tail</code> to <code>head</code>, so only <code>tail</code> is required for a circularly linked list.</p>
<p>In what follows, We elaborate some key implementations of this ADT in Python, and the full code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/lists/circular_linked_list.py">circular_linked_list.py</a>:</p>
<h3 id="addfirst"><a class="header" href="#addfirst"><code>addFirst()</code></a></h3>
<pre><code class="language-python">def add_first(self, item):
    if self.is_empty():
        self._tail = self.Node(item)
        self._tail.next = self._tail
    else:
        self._tail.next = self.Node(item, self._tail.next)
    self._size += 1
</code></pre>
<h3 id="addlast"><a class="header" href="#addlast"><code>addLast()</code></a></h3>
<pre><code class="language-python">def add_last(self, item):
    self.add_first(item)
    self._tail = self._tail.next
</code></pre>
<h3 id="removefirst"><a class="header" href="#removefirst"><code>removeFirst()</code></a></h3>
<pre><code class="language-python">def remove_first(self):
    if self.is_empty():
        raise NoElement
    head = self._tail.next
    if head is self._tail:
        # only one element
        self._tail = None
    else:
        self._tail.next = head.next
    self._size -= 1
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linked-list-in-java"><a class="header" href="#linked-list-in-java">Linked List in Java</a></h1>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/lists/src/main/java/org/swufe/datastructure/LinkedList.java">LinkedList.java</a>.</p>
<h2 id="a-few-notes-on-implementation-1"><a class="header" href="#a-few-notes-on-implementation-1">A few notes on implementation</a></h2>
<p>It is good practice to make the inner <code>Node</code> class being <em>private static</em>:</p>
<pre><code class="language-java">private static class Node&lt;Item&gt; {
    Item item;
    Node&lt;Item&gt; next;
    Node(Item item) {
        this.item = item;
        next = null;
    }
}
</code></pre>
<p>See more at <strong>Item 24: Favor static member classes over nonstatic</strong> in <a href="https://book.douban.com/subject/27047716/">Effective Java</a>.</p>
<h2 id="stack-based-on-linked-lists-1"><a class="header" href="#stack-based-on-linked-lists-1">Stack based on linked lists</a></h2>
<p>In this subsection, we are going to implement a stack based on singly linked lists. </p>
<blockquote>
<p>A stack is a collection of objects that are inserted and removed according to the last-in, first-out (LIFO) policy.</p>
</blockquote>
<p>The two main operations of a stack can be described in the following, and both of them run in \(O(1)\):</p>
<ul>
<li><code>push()</code>: <code>add_first()</code> in a linked list</li>
<li><code>pop()</code>: <code>remove_first()</code> in a linked list</li>
</ul>
<p>As we can see, only the <code>head</code> pointer is necessary here. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/lists/src/main/java/org/swufe/datastructure/LinkedStack.java">LinkedStack.java</a>, which is a simplified implementation of a linked list.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Array-based stack</th><th>LinkedList-based stack</th><th>Note</th></tr></thead><tbody>
<tr><td><code>push()</code></td><td>\(O(1)\)</td><td>\(O(1)\)</td><td>Array-based is amortized</td></tr>
<tr><td><code>pop()</code></td><td>\(O(1)\)</td><td>\(O(1)\)</td><td>Array-based is amortized</td></tr>
</tbody></table>
</div>
<p>Note that the implementation of <code>push()</code> can also be shortened, as we did in <a href="list/./linkedlist_python.html#shorter-yet-obscure">Linked List in Python: Shorter yet obscure</a>.</p>
<h2 id="queue-based-on-linked-lists-1"><a class="header" href="#queue-based-on-linked-lists-1">Queue based on linked lists</a></h2>
<p>In this subsection, we are going to implement a stack based on singly linked lists. </p>
<blockquote>
<p>A queue is a collection of objects that are inserted and removed according to the first-in, first-out (FIFO) policy.</p>
</blockquote>
<p>The two main operations of a queue can be described in the following, and both of them run in \(O(1)\):</p>
<ul>
<li><code>enqueue()</code>: <code>add_last()</code> in a linked list</li>
<li><code>dequeue()</code>: <code>remove_first()</code> in a linked list</li>
</ul>
<p>We shall maintain both <code>head</code> and <code>tail</code> for a queue. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/lists/src/main/java/org/swufe/datastructure/LinkedQueue.java">LinkedQueue.java</a>, which is a simplified implementation of a linked list.</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Array-based queue</th><th>LinkedList-based queue</th><th>Note</th></tr></thead><tbody>
<tr><td><code>enqueue()</code></td><td>\(O(1)\)</td><td>\(O(1)\)</td><td>Array-based is amortized</td></tr>
<tr><td><code>dequeue()</code></td><td>\(O(N)\)</td><td>\(O(1)\)</td><td>Not the circular array</td></tr>
</tbody></table>
</div>
<h2 id="circularly-linked-list-1"><a class="header" href="#circularly-linked-list-1">Circularly linked list</a></h2>
<p>A <strong>circularly linked list</strong> is essentially a singly linked list in which the <code>next</code> reference to the tail node is set to refer back to the head of the list (rather than <code>null</code>).</p>
<img src="list/image/circular_linkedlist.png" width="80%">
<p>This ADT can be used in applications in which data can be more naturally viewed as having a <em>cyclic order</em>, with well-defined neighboring relationships, but no fixed beginning or end. Note that there is a link from <code>tail</code> to <code>head</code>, so only <code>tail</code> is required for a circularly linked list.</p>
<p>In what follows, We elaborate some key implementations of this ADT in Java, and the full code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/lists/src/main/java/org/swufe/datastructure/CircularLinkedList.java">CircularLinkedList.java</a>:</p>
<h3 id="addfirst-1"><a class="header" href="#addfirst-1"><code>addFirst()</code></a></h3>
<pre><code class="language-java">public void addFirst(Item item) {
    if (size == 0) {
        tail = new Node&lt;&gt;(item);
        tail.next = tail; // link to itself circularly
    } else {
        tail.next = new Node&lt;&gt;(item, tail.next);
    }
    size += 1;
}
</code></pre>
<h3 id="addlast-1"><a class="header" href="#addlast-1"><code>addLast()</code></a></h3>
<pre><code class="language-java">public void addLast(Item item) {
    addFirst(item);
    tail = tail.next;
}
</code></pre>
<h3 id="removefirst-1"><a class="header" href="#removefirst-1"><code>removeFirst()</code></a></h3>
<pre><code class="language-java">public void removeFirst() {
    if (size == 0) {
        throw new NoSuchElementException();
    }
    Node&lt;Item&gt; head = tail.next;
    if (head == tail) {
        // only one element
        tail = null;
    } else {
        tail.next = head.next;
    }
    size -= 1;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="doubly-linked-list"><a class="header" href="#doubly-linked-list">Doubly Linked List</a></h1>
<p>In a singly linked list, each node maintains a reference to the node that is immediately after it. But recall that we are unable to delete a node at the tail of a list efficiently.</p>
<img src="list/image/alg-sll-removelast.png" width="80%">
<p>To boost the efficiency, we define a linked list in which each node keeps an explicit reference to the node before it and a reference to the node after it. Such ADT is known as a <strong>doubly link list</strong>, and it allows a greater variety of \(O(1)\) update operations. We continue to use the term <code>next</code> for the reference to the node that follows another, and we introduce the term <code>prev</code> for the preference to the node that precedes it.</p>
<h2 id="head-and-trailer-sentinels"><a class="header" href="#head-and-trailer-sentinels">Head and Trailer sentinels</a></h2>
<p>As we can see, we need to address some special cases (e.g., the size is 0/1) when implementing an API for linked lists. In order to avoid such boundaries checking, it helps to add special nodes at both ends of the list: </p>
<ul>
<li>A <code>header</code> node at the beginning of the list</li>
<li>A <code>trailer</code> node at the end of the list.</li>
</ul>
<p>These <em>dummy</em> nodes are referred to <strong>sentinels</strong> (or guards), and they do not store elements of the primary sequence.</p>
<img src="list/image/dummy.png">
<blockquote>
<p>Although we could implement a doubly linked list without sentinel nodes (just as we did with the singly linked list), the slight extra memory devoted to the sentinels greatly simplifies the logic of our operations for the simple reason that <strong>both <em>header</em> and <em>trailer</em> always exist, and they will never be changed</strong>.</p>
</blockquote>
<p>Let's see an example to show the convenience brought by <code>header</code> sentinel in a singly linked list for <code>addLast()</code> method. </p>
<img src="list/image/alg-sll-addlast3.png" width="80%">
<p>Because there would always be an existing <code>header</code>, the code becomes succinct because we do not have to handle the case when its <code>head</code> is <code>null</code>.</p>
<h3 id="a-few-notes-for-an-empty-list"><a class="header" href="#a-few-notes-for-an-empty-list">A few notes for an empty list</a></h3>
<p>Suppose <code>Node</code> has a constructor <code>Node(Item item, Node&lt;Item&gt; prev, Node&lt;Item&gt; next)</code>. Initially, the empty list is constructed using the following code:</p>
<pre><code class="language-java">header = new Node&lt;&gt;(null, null, null);
trailer = new Node&lt;&gt;(null, header, null); // trailer is preceded by header
header.next = trailer; // header is followed by trailer
</code></pre>
<h2 id="common-operations"><a class="header" href="#common-operations">Common Operations</a></h2>
<p>In what follows, we will present how to implement a doubly linked list by showing its common operations. To save the space, only update operations (add/remove) are discussed. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/lists/src/main/java/org/swufe/datastructure/DoublyLinkedList.java">DoublyLinkedList.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/lists/doubly_linked_list.py">doubly_linked_list.py</a>.</p>
<h3 id="add"><a class="header" href="#add">add</a></h3>
<p>First, we present a helper method to add an element between <code>predecessor</code> and <code>successor</code>.</p>
<img src="list/image/alg-dll-add.png" width="80%">
<p>Therefore, <code>addFirst(e)</code> and <code>addLast(e)</code> can be respectively described as:</p>
<ul>
<li><code>addBetween(header, header.next, e)</code></li>
<li><code>addBetween(trailer.prev, trailer, e)</code></li>
</ul>
<h3 id="remove"><a class="header" href="#remove">remove</a></h3>
<p>We also prepare a helper method to remove a specific node from the list.</p>
<img src="list/image/alg-dll-remove.png" width="80%">
<p>Therefore, <code>removeFirst()</code> and <code>removeLast()</code> can be respectively described as<sup class="footnote-reference"><a href="#remove">1</a></sup>:</p>
<ul>
<li><code>remove(header.next)</code></li>
<li><code>remove(trailer.prev)</code></li>
</ul>
<h3 id="a-few-notes-on-pythons-exceptions"><a class="header" href="#a-few-notes-on-pythons-exceptions">A few notes on Python's exceptions</a></h3>
<p>For simplicity, we did not pass messages to exceptions when implementing the removing operations. For example,</p>
<pre><code class="language-python">def remove_first(self):
    if self.is_empty():
        raise NoElement
    self._remove(self._header.next)
</code></pre>
<p>Note that <code>raise NoElement</code> and <code>raise NoElement()</code> do the same thing. See more at <a href="https://stackoverflow.com/questions/16706956/">Is there a difference between &quot;raise exception()&quot; and &quot;raise exception&quot; without parenthesis?</a>.</p>
<hr />
<p><sup class="footnote-reference"><a href="#remove">1</a></sup> As for removing, it is still required to check whether it is empty.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="case-study"><a class="header" href="#case-study">Case Study</a></h1>
<h2 id="array-vs-linked-list"><a class="header" href="#array-vs-linked-list">Array vs. Linked List</a></h2>
<blockquote>
<p>Different from an array based list, a linked list can be stored in non-contiguous memory, so this ADT performs well when we insert or remove an element at some position in a list because no any shifting is required. Of course, it has trade-offs. Since it is not contiguous, index-based retrieving is less efficient for a linked list ADT, because we have to scan the whole list at the worst case.</p>
</blockquote>
<p>We can use either an <em>array</em> or <em>linked list</em> to implement common data structures such as <em>stacks</em> and <em>queues</em>. More importantly, there is not a one-size-fits-all solution, as each offers distinct advantages and disadvantages. When choosing between these two representations, you shall ask <strong>which operations (<em>add/remove/index</em>) are concerned in your applications</strong>. In addition, memory overhead can also be an important factor sometimes.</p>
<h2 id="reverse-a-linked-list"><a class="header" href="#reverse-a-linked-list">Reverse a linked list</a></h2>
<p>As the last subsection of this chapter, we will investigate how to reverse a linked list which is a frequently-asked question in job interviews.</p>
<blockquote>
<p>Different from the ADT described in an object-oriented way, a linked list is usually presented as its <em>head</em>.</p>
</blockquote>
<h3 id="leetcode-206-reverse-linked-list"><a class="header" href="#leetcode-206-reverse-linked-list">LeetCode 206. Reverse Linked List</a></h3>
<p>Given the <code>head</code> of a singly linked list, reverse the list, and return the <em>reversed list</em>.</p>
<img src="list/image/alg-sll-reverse.png" width="80%">
<p>We use a typical <em>two-pointers</em> strategy to maintain the previous (<code>pre</code>) and current (<code>cur</code>) node while scanning the list. Readers shall pay attention to how we update the links between nodes.</p>
<p>In fact, this problem can also be solved using <strong>recursion</strong><sup class="footnote-reference"><a href="#recursive">1</a></sup>, which is a profound programming skill, and we will use it frequently for algorithms in <em>trees</em>. To put it simply, <em>recursion means &quot;defining a problem in terms of itself&quot;.</em></p>
<p>For example, how to compute the sum of a list? Let's use Python to describe the solution due to its slicing capability<sup class="footnote-reference"><a href="#sum">2</a></sup>.</p>
<pre><code class="language-python">def sum_of_list(a):
    s = 0
    for i in a:
        s += i
    return s
</code></pre>
<p>Note that a list can also be defined in a recursive way. For instance, <code>[1, 2, 3, 4]</code> is made up with one item (<code>1</code>) and a shorter list (<code>[2, 3, 4]</code>); and <code>[2, 3, 4]</code> can be further decomposed. Therefore, a recursion implementation is:</p>
<pre><code class="language-python">def sum_of_list(a):
    if len(a) == 0:
        return 0
    return a[0] + sum_of_list(a[1:])
</code></pre>
<p>As we can see, <code>sum_of_list()</code> is called within <code>sum_of_list()</code>. When designing a recursive algorithm, you shall keep in mind a fact that there are <strong>base cases</strong> (i.e., when to stop). By the way, the tiny program (<a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/start/src/Fibonacci.java">Fibonacci.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/fibonacci.py">fibonacci.py</a>) we used in <a href="list/../fundamentals/alg.html">Algorithm Analysis</a> is also a classical recursion.</p>
<p>Now let's design a recursive alternative to reverse a linked list.</p>
<img src="list/image/alg-sll-reverse2.png" width="80%">
<p>Last but not the least, although recursions make code much clearer, recursive algorithms often have more cost in terms of space and time compared with their iterative counterparts. This is because recursions result in larger calling stacks<sup class="footnote-reference"><a href="#stack">3</a></sup>. Again, this is a <em>trade-off</em> again; sometimes we would prefer a shorter piece of code by giving up some performance.</p>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/lists/src/main/java/org/swufe/datastructure/LeetCode206.java">LeetCode206.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/lists/leet_code_206.py">leet_code_206.py</a>.</p>
<hr />
<p><sup class="footnote-reference"><a href="#recursive">1</a></sup> Recall that a linked list itself can be defined recursively.</p>
<p><sup class="footnote-reference"><a href="#sum">2</a></sup> You don't really have to design a method to compute a sum, because we can use the built-in <code>sum()</code> method directly in Python.</p>
<p><sup class="footnote-reference"><a href="#stack">3</a></sup> Some algorithms are called <strong>tail recursive</strong> because the last statement in the algorithm is to &quot;restart&quot; the algorithm. Tail recursive algorithms are usually translated into loops by most compilers, so there is not any efficiency deficit in runtime. See more at <a href="https://stackoverflow.com/questions/33923/">What is tail recursion?</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-2"><a class="header" href="#exercise-2">Exercise</a></h1>
<ol>
<li>Please implement Python's counterpart of List's <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html#lastIndexOf(java.lang.Object)">int lastIndexOf​(Object o)</a>.</li>
</ol>
<pre><code class="language-python">def last_index_of(a: list, e) -&gt; int:
    pass
</code></pre>
<hr />
<ol start="2">
<li>Please implement your own <em>ArrayList</em> based on an array in Java. To make sure that your APIs are consistent, please let your class implement <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html">java.util.List</a> interface.</li>
</ol>
<pre><code class="language-java">public class MyArrayList&lt;E&gt; implements List&lt;E&gt; {
    ...
}
</code></pre>
<hr />
<ol start="3">
<li>Try to implement the selection sort algorithm based on the pseudo code using Java or Python.</li>
</ol>
<hr />
<ol start="4">
<li>Please analyze the time complexity of the selection sort algorithm.</li>
</ol>
<hr />
<ol start="5">
<li>Try to write the pseudo code of inserting an item at index <code>i</code> on a linked list as <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/List.html#set(int,E)">set​(int index, E element)</a>.</li>
</ol>
<hr />
<ol start="6">
<li>Try to write the pseudo code of clearing a linked list.</li>
</ol>
<hr />
<ol start="7">
<li>Please design an algorithm to convert a linked list to an array in Python.</li>
</ol>
<hr />
<ol start="8">
<li>Please try to implement a stack based on singly linked lists using an inner <code>Node</code> class in Python.</li>
</ol>
<hr />
<ol start="9">
<li>Try to implement the <code>==</code> operation by overriding <code>__eq__()</code> method for a singly linked list in Python. We would say two lists are identical when they have the same data and the arrangement of data is also the same.</li>
</ol>
<pre><code class="language-python">a = LinkedList()
a.add_last(1)
a.add_last(3)

b = LinkedList()
b.add_last(1)
b.add_last(3)

assert a == b
</code></pre>
<hr />
<ol start="10">
<li>Try to override <code>equals()</code> method for a singly linked list in Java. We would say two lists are identical when they have the same data and the arrangement of data is also the same.</li>
</ol>
<pre><code class="language-java">LinkedList&lt;Integer&gt; a = new LinkedList&lt;&gt;();
a.addLast(1);
a.addLast(3);

LinkedList&lt;Integer&gt; b = new LinkedList&lt;&gt;();
b.addLast(1);
b.addLast(3);

assert a.equals(b);
</code></pre>
<hr />
<ol start="11">
<li>Try to implement all operations shown in <a href="http://cslibrary.stanford.edu/105/LinkedListProblems.pdf">LinkedListProblems</a>.</li>
</ol>
<hr />
<ol start="12">
<li>Try to solve <a href="https://leetcode.com/problems/reverse-linked-list-ii/">LeetCode: 92. Reverse Linked List II</a>.</li>
</ol>
<hr />
<ol start="13">
<li>Try to convert the binary search implementation (<a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/unit-work/src/main/java/org/swufe/datastructure/BinarySearch.java">BinarySearch.java</a> or <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/binary_search.py">binary_search.py</a>) to a recursive version.</li>
</ol>
<p>Note that different from the current implementations, it should return the largest index  <code>i</code> so that <code>a[i]</code> is smaller than or equal to key.</p>
<pre><code class="language-py">assert binary_search([1, 3, 8, 10], 3) == 1

assert binary_sarch([1, 3, 8, 10], 8) == 2

assert binary_search([1, 3, 8, 10], 9) == 2
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trees"><a class="header" href="#trees">Trees</a></h1>
<p>Linked lists and array-based lists work well for representing <em>linear</em> relationships, but not all relationships are linear. In this chapter, we are going to investigate one of the most <em>nonlinear</em> data structures: <strong>trees</strong>.</p>
<p>As the name implies, it looks like a tree, containing <em>roots</em>, <em>branches</em>, and <em>leaves</em>. In trees, items are organized in <strong>hierarchical</strong> way, with some nodes being &quot;above&quot; and some &quot;below&quot; others. </p>
<p>A tree is a general and natural model to describe the world. Just to name a few:</p>
<ul>
<li>Animals can be classified into 2 main groups: <em>vertebrates</em> and <em>invertebrates</em>. Vertebrates can even classified into <em>warm-blooded</em> and <em>cool-blooded</em>, while invertebrates can classified into: <em>with jointed legs</em> and <em>without legs</em>.</li>
</ul>
<img src="tree/image/animal.jpeg" width="80%">
<ul>
<li>HTML can be nested. For example, <code>&lt;html&gt;</code> is the root tag, and it has two major nested elements: <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code>. Inside the head, typical elements include <code>&lt;title&gt;</code> and <code>&lt;style&gt;</code>; while inside the body, typical elements include <code>&lt;h1&gt;</code>, <code>&lt;p&gt;</code>.</li>
</ul>
<img src="tree/image/html.png" width="60%"><div style="break-before: page; page-break-before: always;"></div><h1 id="general-trees"><a class="header" href="#general-trees">General Trees</a></h1>
<blockquote>
<p>In computer science, a tree is a widely used ADT that represents a hierarchical tree structure with a set of connected nodes.</p>
</blockquote>
<p>Like a linked list, a tree can be defined in a recursive way such that a tree <em>T</em> is either empty or consists of a node <em>r</em>, called the <strong>root</strong> of <em>T</em>, and a (possibly empty) set of subtrees whose roots are the children of <em>r</em>.</p>
<p>This definition reveals that <strong>parent-children</strong> relationships are very important in trees.</p>
<h2 id="terminology"><a class="header" href="#terminology">Terminology</a></h2>
<p>When studying trees, you will be immersed with a ton of terminologies. Please calm down and take it easy, because most of them are instinct and easy-to-memorize.</p>
<img src="https://miro.medium.com/max/975/0*reevDbBrtxor3Nyw.png" width="80%">
<ul>
<li>The connections between nodes are sometimes called <strong>edges</strong> or <strong>links</strong>.</li>
<li>The value stored in a node is often called a <strong>key</strong>.</li>
<li>Each node in a tree has zero or more <strong>child nodes</strong>, which are below it in the tree.</li>
<li>All nodes have exactly one <strong>parent</strong>, except the topmost <strong>root node</strong>.</li>
<li>A node might have many <strong>ancestor nodes</strong><sup class="footnote-reference"><a href="#descendant">1</a></sup>, such as the parent's parent.</li>
<li>Child nodes with the same parent are <strong>sibling nodes</strong>.</li>
<li>An <strong>internal node</strong> (also known as an <strong>inner node</strong>, <strong>inode</strong> for short, or <strong>branch node</strong>) is any node of a tree that has child nodes.</li>
<li>An <strong>external node</strong> (also known as an <strong>outer node</strong>, <strong>leaf node</strong>, or <strong>terminal node</strong>) is any node that does not have child nodes.</li>
<li>The <strong>height</strong> of a node is the length of the longest downward path to a leaf from that node. The height of the root is the height of the tree. Conventionally, an empty tree has height −1.</li>
<li>The <strong>depth</strong> of a node is the length of the path to its root.</li>
<li>The <strong>level</strong> of a node is the same as depth when using zero-based counting.</li>
<li>Each non-root node can be treated as the root node of its own <strong>subtree</strong>, which includes that node and all its descendants.</li>
<li>Number of nodes in the tree is called <strong>size of a tree</strong>.</li>
<li>A <strong>path</strong> is a sequence of nodes with the property that each node in the sequence is adjacent to the node linked to it. A path that does not repeat nodes is called a <strong>simple path</strong>.</li>
<li><strong>Complete tree</strong>: a tree in which every level, except possibly the deepest, is entirely filled (all nodes are as far left as possible).</li>
</ul>
<hr />
<p><sup class="footnote-reference"><a href="#descendant">1</a></sup> The counterpart of an ancestor is called <strong>descendant</strong>, meaning a node reachable by repeated proceeding from parent to child. Also known as <em>subchild</em>. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-search-trees-1"><a class="header" href="#binary-search-trees-1">Binary Search Trees (1)</a></h1>
<p>A tree without any restriction is unpractical in general, and in this section, we introduce a simple restriction that each node has exactly two links, which are called its <strong>left</strong> and <strong>right</strong> links, that point to nodes called its <em>left child</em> and <em>right child</em>, respectively.</p>
<img src="tree/image/binary.png" width="60%">
<p>Such data structure is known as <strong>binary tree</strong>, and we can define it as either a null link or a node with a left link and a right link, each references to (disjoint) subtrees that are themselves binary trees. </p>
<p>In a <strong>binary search tree</strong>, each node also has a key (and a value)<sup class="footnote-reference"><a href="#value">1</a></sup>, with an ordering restriction to support efficient search.</p>
<blockquote>
<p>A binary search tree (<strong>BST</strong>) is a binary tree where each node has a (<em>comparable</em>) key and satisfies the restriction that the key in any node is larger than the keys in all nodes in that node’s left subtree and smaller than the keys in all nodes in that node’s right subtree.</p>
</blockquote>
<img src="tree/image/bst2.png" width="60%">
<p>For example, given a binary search tree with integer keys, how to search 6? Let's start from its root (8):</p>
<ul>
<li>Since 6 &lt; 8, go to its left child.</li>
<li>Since 6 &lt; 3, go to its right child.</li>
<li>Since 6 == 6, bingo!</li>
</ul>
<p>Only three comparisons are required while searching, and this idea is also found at the binary search of a sorted list (recall <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/java/unit-work/src/main/java/org/swufe/datastructure/BinarySearch.java">BinarySearch.java</a> or <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/start/binary_search.py">binary_search.py</a>).</p>
<p>Let's recap the <em>binary-search-tree property</em> again: Let <em>x</em> be a node in a binary search tree.</p>
<ul>
<li>If <em>y</em> is a node in the left subtree of <em>x</em>, then \(y.key &lt; x.key \).</li>
<li>If <em>y</em> is a node in the right subtree of <em>x</em>, then \(y.key &gt; x.key \).</li>
</ul>
<blockquote>
<p>As we can see, we can use a BST to represent a <strong>dynamic set</strong> if only <em>keys</em> are considered. If <em>values</em> are also involved, it is in fact a <em>map</em>. Throughout this book, we mainly focus on dynamic sets.</p>
</blockquote>
<h2 id="bst-structure"><a class="header" href="#bst-structure">BST structure</a></h2>
<p>Now let's talk about how to design a BST. Like a linked list, a BST can be represented by its <em>root</em> node due to the fact that it is recursive, where a node<sup class="footnote-reference"><a href="#parent">2</a></sup> consists of</p>
<ul>
<li>a link to its left subtree</li>
<li>a link to its right subtree</li>
<li>the key</li>
<li>(the value)</li>
</ul>
<p>And it can be roughly described using the following Python code:</p>
<pre><code class="language-python">class Node:
    def __init__(self, key, left=None, right=None):
        self.key = key
        self.left = left
        self.right = right

class BST:
    def __init__(self):
        self.root = None
</code></pre>
<h3 id="a-few-notes-on-comparable"><a class="header" href="#a-few-notes-on-comparable">A few notes on <em>comparable</em></a></h3>
<p>In a BST, the keys should be <em>comparable</em>. The basic data types, such as <code>int</code>, <code>double</code>, and <code>String</code> are comparable. Then what about a <code>Dog</code> class? Can we say a dog is larger or smaller than another dog? Such comparison makes sense if and only if a <code>Dog</code> is comparable.</p>
<p>In Java, it is enforced by the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Comparable.html">Comparable</a> interface, and it can also be combined with generics. In addition, we can use its <code>compareTo()</code> method, instead of the comparison operators (e.g., &gt;, &lt;, ==) in the code.</p>
<pre><code class="language-java">class Node&lt;Key extends Comparable&lt;Key&gt;&gt; {
    ...
}
</code></pre>
<p>As for Python, in order to use the comparison operator (e.g., &gt;, &lt;, ==) directly, one shall provide the rich comparison methods for ordering in the user-defined class<sup class="footnote-reference"><a href="#comparison">3</a></sup>. Luckily, it is the responsibility for people who use a BST, not for us who create a BST.</p>
<h2 id="bst-implementation"><a class="header" href="#bst-implementation">BST implementation</a></h2>
<p>The complete code (using <em>recursions</em>) can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/tree/src/main/java/org/swufe/BST.java">BST.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/python/tree/bst.py">bst.py</a>. In addition, an iterative implementation can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/tree/src/main/java/org/swufe/BST2.java">BST2.java</a>.</p>
<h3 id="size"><a class="header" href="#size"><code>size()</code></a></h3>
<p>We can also maintain the <code>size</code> member variable in a BST like we did in linked lists. Here we adopt another solution: <code>Node</code> holds an instance variable <code>n</code> which givens the node count in the subtree rooted at the node.</p>
<pre><code class="language-python">class Node:
    def __init__(self, key, n=1, left=None, right=None):
        self.key = key
        self.n = n
        self.left = left
        self.right = right
</code></pre>
<p>And our implementations will benefit a lot from such recursive design. However, as for traditional iterative implementations, we assume that <code>Node</code> does not hold <code>n</code>; Instead, the BST ADT maintains <code>size</code>.</p>
<img src="tree/image/alg-bst-size.png" width="80%">
<p>Then the size of a BST is <code>size(root)</code>; it runs with a constant time complexity. By the way, given the implementation of <code>size()</code>, we can also offer <code>isEmpty()</code> to check whether a BST is empty:</p>
<pre><code class="language-java">public boolean isEmpty() {
    return size() == 0;
}
</code></pre>
<h3 id="put"><a class="header" href="#put"><code>put()</code></a></h3>
<p>This method is often called <code>insert()</code> in some implementations, and it is used to add a new key to a BST.</p>
<h4 id="iterative-put"><a class="header" href="#iterative-put">Iterative <code>put()</code></a></h4>
<p><strong>A new key will always be put as a leaf</strong>. Like the algorithms in linked list, we shall maintain a pointer as the <em>parent</em> while descending the tree.</p>
<img src="tree/image/alg-bst-put2.png" width="80%">
<p>The following figure shows inserting a node with key 7 into a binary search tree. The simple path from the root down to the position where the node is inserted is shown in blue. The new node and the link to its parent are highlighted in orange.</p>
<img src="tree/image/bst-insert.png" width="70%">
<p>As we can see, to insert a new key, we shall descend from the root to a leaf. Suppose <em>h</em> is the height of the tree, the time complexity of <code>put()</code> is \(O(h)\).</p>
<h4 id="recursive-put"><a class="header" href="#recursive-put">Recursive <code>put()</code></a></h4>
<p>To make use of recursions, we first design an algorithm to insert a <code>key</code> to the tree rooted at <code>x</code>. Since updating could modify the tree, we shall return the new <em>root</em> as the result.</p>
<img src="tree/image/alg-bst-put.png" width="80%">
<p>Then to put a key onto a BST can be written as</p>
<pre><code class="language-java">root = put(root, key);
</code></pre>
<p>It is worthwhile to take the time to understand the dynamics of this recursive implementation. Again, the iterative version is more efficient while the recursive one is easier to write.</p>
<h3 id="get"><a class="header" href="#get"><code>get()</code></a></h3>
<p>This method is often called <code>search()</code> in some implementations, and it is used to get the node containing the given <em>key</em>; <code>null</code> will be returned if the <em>key</em> is not found.</p>
<h4 id="iterative-get"><a class="header" href="#iterative-get">Iterative <code>get()</code></a></h4>
<p>It is, in fact, a binary search tree for a BST. It begins its search at the root and traces a simple path downward in the tree.</p>
<img src="tree/image/alg-bst-get.png" width="80%">
<p>Like <code>put()</code>, the running time of <code>get()</code> is also \(O(h)\).</p>
<h4 id="recursive-get"><a class="header" href="#recursive-get">Recursive <code>get()</code></a></h4>
<p>We can also implement it with a plain <em>tail-recursion</em>.</p>
<img src="tree/image/alg-bst-get2.png" width="80%">
<p>Then to get a node from a BST given a <code>key</code>, we can use </p>
<pre><code class="language-java">return get(root, key);
</code></pre>
<h3 id="removemin"><a class="header" href="#removemin"><code>removeMin()</code></a></h3>
<p>This method (also known as <code>deleteMin()</code>) is to remove the node with the smallest key. Note that it is always located at the <strong>leftmost</strong> in a BST.</p>
<h4 id="iterative-removemin"><a class="header" href="#iterative-removemin">Iterative <code>removeMin()</code></a></h4>
<p>We will descend the node from <code>root</code> to the <em>leftmost</em> leaf. Like <code>put()</code>, a parent pointer is also maintained.</p>
<img src="tree/image/alg-bst-removemin2.png" width="80%">
<p>The time complexity is also \(O(h)\).</p>
<h4 id="recursive-removemin"><a class="header" href="#recursive-removemin">Recursive <code>removeMin()</code></a></h4>
<p>It takes a node <code>x</code> as a root and then returns a new node as the root after removing the node with the smallest key.</p>
<ul>
<li><em>Base case</em>: When its left child is <code>null</code>, remove itself, and return its right child.</li>
<li><em>Recursion</em>: Update <code>x.left</code> to <code>removeMin(x.left)</code>.</li>
</ul>
<img src="tree/image/alg-bst-removemin.png" width="80%">
<p>Then removing the node with the smallest key in a BST can be written as</p>
<pre><code class="language-java">public void removeMin() {
    if (isEmpty()) throw new NoSuchElementException();
    root = removeMin(root);
}
</code></pre>
<p>By the way, it is also easy to implement the algorithm <code>min()</code> to get the smallest key from a BST:</p>
<pre><code class="language-java">public Key min() {
    if (isEmpty()) throw new NoSuchElementException();
    return min(root).key;
}
private Node&lt;Key&gt; min(Node&lt;Key&gt; x) {
    if (x.left == null) return x;
    else return min(x.left);
}
</code></pre>
<h3 id="removemax"><a class="header" href="#removemax"><code>removeMax()</code></a></h3>
<p>This method (also known as <code>deleteMax()</code>) is to remove the node with the largest key. Note that it is always located at the <strong>rightmost</strong> in a BST. The main idea is the same with <code>removeMin()</code>, so the implementation is left as an exercise for readers. In addition, readers can also design the algorithm <code>max()</code> to get the largest key in a BST.</p>
<h3 id="remove-1"><a class="header" href="#remove-1"><code>remove()</code></a></h3>
<p>This method is often called <code>delete()</code>, which is used to delete a node given a <code>key</code>. In fact, <em>this is the most complicated algorithm for a BST</em>.</p>
<h4 id="iterative-remove"><a class="header" href="#iterative-remove">Iterative <code>remove()</code></a></h4>
<p>The iterative implementation is a bit tricky, and it is omitted in this book. Curious readers can refer to <em>Introduction to Algorithms</em>.</p>
<h4 id="recursive-remove"><a class="header" href="#recursive-remove">Recursive <code>remove()</code></a></h4>
<p>Like other recursive algorithms in a BST, <code>remove(x, key)</code> takes a node <code>x</code> and removes the node with <code>key</code> in the tree rooted at <code>x</code>, and returns a new root.</p>
<p>Like what we did in <code>get()</code>, we shall descend the current node if <code>x.key</code> does not equal `key. And the real tricky part is how to handle the case when they are identical.</p>
<ul>
<li>
<p>If <code>x</code> does not have any child, then return <code>null</code>.</p>
</li>
<li>
<p>If <code>x</code> has just one child, then return that child.</p>
</li>
<li>
<p>Otherwise, <code>x</code> can be replaced with the leftmost (i.e, <em>min</em>) node <code>y</code> in the tree rooted at <code>x.right</code>. Essentially, <code>y</code> is the successor of <code>x</code>. In addition, <em>the right child of updated <code>x</code> becomes <code>deleteMin(right, key)</code></em>, and the left child remains unchanged.</p>
<pre><code>       10                              11
     /     \         delete(10)      /     \
    7       15       ---------&gt;    7        15 
   /  \    /  \                   /  \        \ 
  5    8  11   18                5    8        18
</code></pre>
</li>
</ul>
<img src="tree/image/alg-bst-delete.png" width="80%">
<p>The time complexity is also \(O(h)\).</p>
<p>Then removing node by a given <code>key</code> in a BST is </p>
<pre><code class="language-java">root = remove(root, key);
</code></pre>
<h2 id="a-few-notes-on-pythons-implementation4"><a class="header" href="#a-few-notes-on-pythons-implementation4">A few notes on Python's implementation<sup class="footnote-reference"><a href="#static">4</a></sup></a></h2>
<p>Since Python supports nested methods, we can define some <em>private</em> methods as <em>nested</em>. For example, the recursive implementation of <code>get(x, key)</code> will only be called by <code>get(key)</code>, and it can be designed as a <em>nested</em> one:</p>
<pre><code class="language-python">def get(self, key):
    def _get(x: BST.Node):
        if x is None or key == x.key:
            return x
        if key &lt; x.key:
            return _get(x.left)
        elif key &gt; x.key:
            return _get(x.right)
    if key is None:
        raise KeyError
    return _get(self._root)
</code></pre>
<p>Note that the inner method can access the parameter of its outer method, so the repeated <code>key</code> can be omitted.</p>
<p>On the other hand, some helper methods will be called by several other methods. In that case, it can be designed as a <em>static</em> one:</p>
<pre><code class="language-python">@staticmethod
def _size(x: Node):
    if x is None:
        return 0
    else:
        return x.n
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#value">1</a></sup> For simplicity, the associated value (also known as satellite data) is not discussed in this chapter.</p>
<p><sup class="footnote-reference"><a href="#parent">2</a></sup> Some implementations would also maintain an extra link to its parent.</p>
<p><sup class="footnote-reference"><a href="#comparison">3</a></sup> See more at https://stackoverflow.com/questions/8276983/.</p>
<p><sup class="footnote-reference"><a href="#static">4</a></sup> The <em>inner</em> and <em>static</em> implementations are not compulsory, and it is fine to always use the regular instance methods.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-search-trees-2"><a class="header" href="#binary-search-trees-2">Binary Search Trees (2)</a></h1>
<p>According to the definition of a BST, it is <em>ordered</em> in terms of a <em>set</em> of keys. </p>
<p>If we project the keys in a BST such that all keys in each node's left subtree appear to the left of the key in the node and all keys in each node's right subtree appear to the right of the key in the node, then we always get the keys in sorted order. Therefore, it is possible to define the <em>predecessor</em> and <em>successor</em> of a node in a BST.</p>
<img src="tree/image/bst2.png" width="60%">
<h2 id="order-based-operations"><a class="header" href="#order-based-operations">Order-based operations</a></h2>
<p>In the last section, we have showed how to implement some order-based operations, such as <code>min()</code> and <code>max()</code>. In fact, the implementation of <code>remove()</code> also relies on the <em>successor</em> of a node.</p>
<p>In what follows, we consider more order-based operations.</p>
<ul>
<li><strong>Floor and ceiling</strong>: As for <code>floor()</code>, it returns the largest key which is not greater than the given key, while <code>ceiling()</code> returns the smallest key which is not less than the given key. For example, <code>floor(5)</code> is 4, <code>ceiling(13)</code> is 14, but <code>floor(0)</code> return <code>null</code> because there is no key equal or less than 0.</li>
</ul>
<img src="tree/image/alg-bst-floor.png" width="80%">
<p>Interchanging right and left (and less and greater) gives <code>ceiling()</code>.</p>
<ul>
<li><strong>Select</strong>. It returns the key of a given rank. The smallest key is with rank 0, while the largest one is with rank (size - 1). For example, <code>select(3)</code> returns 6, and <code>select(9)</code> returns null.</li>
</ul>
<img src="tree/image/alg-bst-select.png" width="80%">
<ul>
<li><strong>Rank</strong>. It is the inverse method of <code>select()</code>, and returns the rank given a key. For example, <code>rank(6)</code> is 3.</li>
</ul>
<img src="tree/image/alg-bst-rank.png" width="80%">
<ul>
<li><strong>Range</strong>. Given a key lower bound <em>k1</em> and upper bound <em>k2</em>, it returns all keys in the range of <code>[k1, k2]</code>. To design a recursive algorithm, we need an extra parameter to store the candidates.</li>
</ul>
<img src="tree/image/alg-bst-range.png" width="80%">
<pre><code class="language-java">public List&lt;Key&gt; range(Key low, Key high) {
    assert low.compareTo(high) &lt;= 0;
    List&lt;Key&gt; result = new ArrayList&lt;&gt;();
    range(root, result, low, high);
    return result;
}
</code></pre>
<h2 id="tree-walk"><a class="header" href="#tree-walk">Tree walk</a></h2>
<p>Given a tree, how can we traverse nodes? In this subsection, we will introduce three tree traversal algorithms. Note the <em>in-</em>, <em>pre-</em> and <em>post-</em> here are used to denote the position of the root while traversing.</p>
<ul>
<li><strong>Inorder tree walk</strong>. It visits the key of the root between the values in the left subtree and those in its right subtree. To put it in another way, it visits &quot;inorder of left subtree&quot;, and then &quot;root&quot;, and finally &quot;inorder of right subtree&quot;. As for the BST above, it will traverse the keys in an ascending order (1 -&gt; 3 -&gt; 4 -&gt; 6 -&gt; 8 -&gt; 10 -&gt; 12 -&gt; 14 -&gt; 18).</li>
</ul>
<p>The following is to print all keys in a BST using <em>inorder tree walk</em>:</p>
<img src="tree/image/alg-bst-inorder.png" width="80%">
<ul>
<li><strong>preorder tree walk</strong>. It visits the root before the nodes in either subtree. To put it in another way, it visits &quot;root&quot;, and then &quot;preorder of left subtree&quot;, and finally &quot;preorder of right subtree&quot;. As for the BST above, it will print 8 -&gt; 3 -&gt; 1 -&gt; 6 -&gt; 4 -&gt; 10 -&gt; 14 -&gt; 12 -&gt; 18.</li>
<li><strong>postorder tree walk</strong>. It visits the root after the nodes in its subtrees. To put it in another way, it visits &quot;postorder of left subtree&quot;, and then &quot;postorder of right subtree&quot;, and finally &quot;root&quot;. As for the BST above, it will print 1 -&gt; 4 -&gt; 6 -&gt; 3 -&gt; 12 -&gt; 18 -&gt; 14 -&gt; 10 -&gt; 8.</li>
</ul>
<p>Curious readers can explore how to design tree traversal algorithms without recursions. </p>
<h2 id="performance-analysis"><a class="header" href="#performance-analysis">Performance Analysis</a></h2>
<blockquote>
<p>In a BST, all operations take time proportional to the height of the tree, in the worst case.</p>
</blockquote>
<p>As for <em>N</em> random keys, the height<sup class="footnote-reference"><a href="#cost">1</a></sup> of a BST is about \(\lg{N}\). The following Java code is used to compute the height of node <code>x</code> in a BST:</p>
<pre><code class="language-java">private int height(Node&lt;Key&gt; x) {
    if (x == null) return -1;
    else return 1 + Math.max(height(x.left), height(x.right));
}

public int height() {
    return height(root);
}
</code></pre>
<p>Here is a simple experiments to show the relationship between the height and the size of a BST. The size ranges from \(10^1\) to \(10^7\):</p>
<img src="tree/image/bst-height.png" width="70%">
<p>However, in the worst case, a BST can be degraded into an ordered linked list if one inserts ordered keys sequentially. In this case, the height will be <em>N</em>.</p>
<p>As for the search/insert operation, we can summarize the time complexities of three common data structures we have learned:</p>
<div class="table-wrapper"><table><thead><tr><th>Algorithm (DAT)</th><th>Worst case cost <br> <em>after N inserts</em></th><th>Average case cost <br> <em>after N random inserts</em></th></tr></thead><tbody>
<tr><td>sequential search (unordered linked list)</td><td><strong>search</strong>: \(O(N)\) <br> <strong>insert</strong>: \(O(N)\)</td><td><strong>search</strong>: \(O(N)\) <br> <strong>insert</strong>: \(O(N)\)</td></tr>
<tr><td>binary search (ordered array)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(N)\)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(N)\)</td></tr>
<tr><td>binary tree search (BST)</td><td><strong>search</strong>: \(O(N)\) <br> <strong>insert</strong>: \(O(N)\)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(lg{N})\)</td></tr>
</tbody></table>
</div>
<p>Therefore, this motivates us to seek better algorithms and data structures, which we consider next. The basic idea is also straightforward: <em>keep the height of a tree always being \(O(\lg{N})\)</em>.</p>
<hr />
<p><sup class="footnote-reference"><a href="#cost">1</a></sup> The theoretical cost is \(1.39\lg{N}\).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="balanced-search-trees"><a class="header" href="#balanced-search-trees">Balanced Search Trees</a></h1>
<p>The BST introduced in the previous sections work well for a wide variety of applications, but they have poor worst-case performance. We will further introduce a type of binary search tree where costs are <em>guaranteed</em> to be logarithmic, no matter what sequence of keys is used to construct them.</p>
<h2 id="the-concept-of-balanced"><a class="header" href="#the-concept-of-balanced">The concept of <em>balanced</em></a></h2>
<p>A binary search tree is <em>perfectly height-balanced</em> if the left and right subtrees of any node are the same height. But maintaining perfect balance for dynamic insertions is too expensive and it is only possible if there are exactly \(2^h-1\) nodes. </p>
<p>Therefore, in practice, if the height of a binary search tree is \(O(lg{N})\), then it is called <strong>self-balancing</strong>. Some specific balanced binary search trees have their own extra restrictions. For example, AVL tree requires that <em>the difference between heights of left subtree and the right subtree is not more than 1.</em> In this section, we mainly focus on the <strong>red-black tree</strong>, a well-known self-balancing binary search tree.</p>
<h2 id="red-black-trees"><a class="header" href="#red-black-trees">Red-black trees</a></h2>
<p>A <em>red-black tree</em> is a binary search tree with one extra bit of storage per node: its <strong>color</strong>, which can be either <em>RED</em> or <em>BLACK</em>. The height of a red-black tree with <em>N</em> keys is at most \(2lg{N+1}\), which is \(O(lg{N})\). The proof is given at the end of this section. So it is approximately <em>balanced</em>.</p>
<p>On the top of the regular node of a BST, we will start to introduce the parent reference <code>p</code> of a node in a red-black tree for the ease of implementation<sup class="footnote-reference"><a href="#p">1</a></sup>. We regard the <code>null</code>s as pointers to leaves, and the normal, key-bearing nodes as internal nodes of the tree.</p>
<p>A red-black tree is a binary search tree that satisfies the following <strong>red-black properties</strong>:</p>
<ol>
<li>Every node is either red or black.</li>
<li>The root is black.</li>
<li>Every leaf (<code>null</code>) is black.</li>
<li>If a node is red, then both its children are black.</li>
<li>For each node, all simple paths from the node to descendant leaves contain the same number of black nodes. </li>
</ol>
<img src="tree/image/rbt.png" width="80%">
<p>We call the number of black nodes on any simple path from, but not including, a node <em>x</em> down to a leaf the <strong>black-height</strong> of the node, denoted bh(<em>x</em>). By property 5, the notion of black-height is well-defined, since all descending simple paths from the node have the same number of black nodes. The black-height of a red-black tree is the black-height of its root. Take the red-black tree for instance, the <em>black-height</em> is 2.</p>
<h3 id="a-few-notes-on-leaves"><a class="header" href="#a-few-notes-on-leaves">A few notes on leaves</a></h3>
<p>The leaf (<code>null</code>) here serves as a <em>sentinel</em> (recall the design of the doubly linked list). The sentinel makes it possible to treat a <code>null</code> child of a node <em>x</em> as an ordinary node whose parent is <em>x</em>, and this design leads to simpler code (especially for the deleting algorithm).</p>
<p>Given a node <code>x</code>, we cannot always get its <em>color</em>, <em>left</em>, <em>right</em> or <em>parent</em> by the dot syntax safely due to the <em>NullPointerException</em>. What is more, the color of a leaf (i.e., <code>null</code>) should be <em>BLACK</em> in our settings. So we can design a set of helper methods, such as:</p>
<pre><code class="language-java">private boolean colorOf(Node&lt;Key&gt; x) {
    return x == null ? BLACK : x.color;
}

private Node&lt;Key&gt; parentOf(Node&lt;Key&gt; x) {
    return x == null ? null : x.p;
}
</code></pre>
<p>Some books (e.g., <em>Introduction to Algorithms</em>) design a better solution to <code>null</code> problem for the sake of space efficiency:</p>
<pre><code class="language-java">Node&lt;Key&gt; NIL = new Node(null, BLACK, null, null, null);
</code></pre>
<p>Then, we can use only one <code>NIL</code> object in a red black tree throughout the code. For example, the <code>root</code> itself is initialized to <code>NIL</code> object instead of <code>null</code>. In addition, it is always safe to access(assign) <em>color</em>, <em>left</em>, <em>right</em>, and <em>parent</em> for(to) all nodes. We will use this technique for the deleting algorithm.</p>
<p>When it comes to illustration, we often omit all leaves as well as the parent of <code>root</code> by giving a clean figure:</p>
<img src="tree/image/rbt2.png" width="80%">
<h3 id="a-few-notes-on-color"><a class="header" href="#a-few-notes-on-color">A few notes on color</a></h3>
<p>In Java, the color of the node can be represented by either boolean or <code>enum</code> values.</p>
<pre><code class="language-java">enum Color {
    RED, 
    BLACK
}
</code></pre>
<p>However, Python does not provide built-in supports for <code>enum</code>. For the consistency of implementations, the data type of color is set to boolean:</p>
<pre><code class="language-java">private static final boolean RED   = false;
private static final boolean BLACK = true;
</code></pre>
<h3 id="a-red-black-tree-is-balanced"><a class="header" href="#a-red-black-tree-is-balanced">A red-black tree is balanced</a></h3>
<p>The following lemma shows why red-black trees make good search trees.</p>
<blockquote>
<p>A red-black tree with <em>N</em> internal nodes has height at most \(2lg{N+1}\).</p>
</blockquote>
<p>First, we can prove by induction that the subtree rooted at <em>x</em> contains at least \(2^{bh(x)}-1\) internal nodes. Let <em>h</em> be the height of the tree. According to property 4, at least half the nodes on any simple path from the root to a leaf, not including the root, must be black. Consequently, the black-height of the root must be at least <em>h/2</em>, and thus,</p>
<p>\[N \geq 2^{h/2} -1 \]</p>
<p>Moving the 1 to the left-hand side and taking logarithms on both sides yields</p>
<p>\[h \leq 2\lg{N+1}\]</p>
<p>The lemma above shows that common operations (search, insertion, finding the minimum, finding the maximum, floor, ceiling, rank, select, delete the minimum, delete the maximum, delete) <strong>take logarithmic time \(O(lg{N})\) in the worst case</strong>.</p>
<h2 id="rotations"><a class="header" href="#rotations">Rotations</a></h2>
<p>All searching related algorithms in a red-black tree are the same with those for a regular BST. But as for insertion and deleting, the modified tree may violate the red-black properties. To restore these properties, we need to re-balance the tree. The key point of re-balancing is <strong>rotations</strong> by updating the pointers.</p>
<p>Rotation is a local operation in a search tree that preserves the <strong>binary-search-tree property</strong>. It has two kinds of rotations: left rotations and right rotations.</p>
<img src="tree/image/rotate.png" width="70%">
<p>Let me emphasize the fact again that a rotation operation preserves the binary-search tree property: the keys in \(\alpha\) precede <em>x.key</em>, which precedes the keys in \(\beta\), which precede <em>y.key</em>, which precedes the keys in \(\gamma\).</p>
<h3 id="left-rotations"><a class="header" href="#left-rotations">Left rotations</a></h3>
<img src="tree/image/alg-rotate-left.png" width="80%">
<h3 id="right-rotations"><a class="header" href="#right-rotations">Right rotations</a></h3>
<img src="tree/image/alg-rotate-right.png" width="80%">
<p>Both rotations operations run in \(O(1)\) time.</p>
<hr />
<p><sup class="footnote-reference"><a href="#p">1</a></sup> The parent reference is optional, but it will facilitate our implementation when the up-swimming is required.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="red-black-trees-1"><a class="header" href="#red-black-trees-1">Red Black Trees (1)</a></h1>
<p>From now on, I will refer to a red black tree as a RBT. The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/tree/src/main/java/org/swufe/RBT2.java">RBT2.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/python/tree/rbt.py">rbt.py</a>.</p>
<h2 id="put-1"><a class="header" href="#put-1"><code>put()</code></a></h2>
<p>Adding a new key to a RBT is generally the same with the algorithms for a regular BST. But a fix-up step <code>insert-fixup()</code> is required because modifying would violate the <em>red-black tree properties</em>.</p>
<img src="tree/image/alg-rb-put.png" width="80%">
<p>For a newly created node, its color is <em>RED</em> by default.</p>
<pre><code class="language-java">public Node(Key key) {
    this.key = key;
    color = RED;
    left = null;
    right = null;
    p = null;
}
</code></pre>
<p>To understand how <code>insert-fixup()</code> works, we shall first determine which violations of the red-black properties might arise upon inserting node <code>z</code> and coloring it red.</p>
<h2 id="insert-fixup"><a class="header" href="#insert-fixup"><code>insert-fixup()</code></a></h2>
<p>What violations of the red-black properties might occur?</p>
<ul>
<li><strong>Case a</strong>: If <code>z</code> is the <code>root</code>, then it violates Property 2. The solution to this is naive: just re-color it to <em>BLACK</em>.</li>
<li><strong>Case b</strong>: If <code>z</code> is not the <code>root</code>, and its parent is also colored in <em>RED</em>, then it violates Property 4. The solution to this is a bit complicated.</li>
</ul>
<p>In describing the structure of a RBT, we’ll often need to refer to the sibling of a node’s parent. We use the term <strong>uncle</strong> for such a node. The following figures show <code>insert-up()</code> operates on a sample RBT, with cases depending in part on the colors of a node, its parent, and its uncle.</p>
<img src="tree/image/rbt-insert-fixup1.png" width="70%">
<p>Case 1 violates Property 4 after a node <code>z</code> is inserted. After re-coloring, it becomes:</p>
<img src="tree/image/rbt-insert-fixup2.png" width="70%">
<p>Case 2 also violates Property 4. After a left rotation, it becomes:</p>
<img src="tree/image/rbt-insert-fixup3.png" width="70%">
<p>Case 3 also violates Property 4. After a right rotation, it becomes a legal RBT:</p>
<img src="tree/image/rbt-insert-fixup.png" width="70%">
<p>The three cases above show the operations when <code>z</code>'s parent is a left child. And if <code>z</code>'s parent is a right child, there are another three cases with &quot;right&quot; and &quot;left&quot; exchanged.</p>
<img src="tree/image/alg-rb-insert-fixup.png" width="80%">
<p>We can use the helper methods to access the <em>parent</em>, <em>left</em>, <em>right</em> and <em>color</em> of a node <code>x</code>. For example, <code>z.p.p.left</code> can be written as <code>leftOf(parentOf(parentOf(z)))</code>. However, it is safe to use <code>z.p.p.left</code> directly. Because if <code>z.p.color</code> is <em>RED</em>, then <code>z</code>'s grandfather (i.e., <code>z.p.p</code>) always exists.</p>
<p>By the way, it does not make sense to assign a color to <code>null</code>, so we can use the following helper method to set the color for a given node:</p>
<pre><code class="language-java">private void setColor(Node&lt;Key&gt; x, boolean c) {
    if (x != null) {
        x.color = c;
    }
}
</code></pre>
<h2 id="maintenance"><a class="header" href="#maintenance">Maintenance</a></h2>
<p>There are six cases within the <strong>while</strong> loop, but we'll examine only the tree cases in lines 2-23, when <em>z</em>'s parent <em>z.p</em> is a left child of <em>z</em>'s grandparent <em>z.p.p</em>. The proof for lines 21-41 is symmetric.</p>
<p>Case 1 differs from cases 2 and 3 by the color of <em>z</em>'s uncle <em>y</em>. If <em>y</em> is red, then case 1 executes. Otherwise, control passes to cases 2 and 3. In all three cases, <em>z</em>'s grandparent <em>z.p.p</em> is black, since its parent <em>z.p</em> is red, and Property 4 violated only between <em>z</em> and <em>z.p</em>.</p>
<h3 id="case-1-zs-uncle-y-is-red"><a class="header" href="#case-1-zs-uncle-y-is-red">Case 1: <code>z</code>'s uncle <code>y</code> is red</a></h3>
<img src="tree/image/rbt-insert-case1.png">
<p>The figure above shows the situation for case 1, which occurs when <em>z</em>, <em>z.p</em> and <em>y</em> are red. In fact, the same action occurs regardless of whether <em>z</em> is a right child or <em>z</em> is a left child.</p>
<p><strong>Because <em>z</em>'s grandparent <em>z.p.p</em> is black, its blackness can transfer down one level to both <em>z.p</em> and <em>y</em>,</strong> thereby maintaining Property 5. Then, the pointer <em>z</em> moves up two levels in the tree.</p>
<h3 id="case-2-zs-uncle-y-is-black-and-z-is-a-right-child"><a class="header" href="#case-2-zs-uncle-y-is-black-and-z-is-a-right-child">Case 2: <code>z</code>'s uncle <code>y</code> is black and <code>z</code> is a right child</a></h3>
<h3 id="case-3-zs-uncle-y-is-black-and-z-is-a-left-child"><a class="header" href="#case-3-zs-uncle-y-is-black-and-z-is-a-left-child">Case 3: <code>z</code>'s uncle <code>y</code> is black and <code>z</code> is a left child</a></h3>
<img src="tree/image/rbt-insert-case23.png">
<p>As we can see, a <em>left rotation</em> immediately transforms case 2 into case 3. Case 3 performs some color changes and a right rotation. At this point, there are no longer two red nodes in a row.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="red-black-trees-2"><a class="header" href="#red-black-trees-2">Red Black Trees (2)</a></h1>
<p>In this section, we will focus on the deletion. Deleting a node from a RBT takes \(O(\lg{N})\) time, and it is more complicated than inserting a node.</p>
<h2 id="delete-a-node-1"><a class="header" href="#delete-a-node-1">Delete a node (1)</a></h2>
<h3 id="a-helper-method"><a class="header" href="#a-helper-method">A helper method</a></h3>
<p>As part of the process of deleting a node, subtrees need to move around. The following subroutine <code>transplant()</code> does the following work:</p>
<ul>
<li>replaces the subtree rooted at node <code>u</code> with the subtree rooted at node <code>v</code></li>
<li>node <code>u</code>'s parent becomes node <code>v</code>'s parent</li>
<li><code>u</code>'s parent ends up having <code>v</code> as its child</li>
</ul>
<img src="tree/image/alg-rb-transplant.png" width="80%">
<p>First, let's design an algorithm to delete a node as if there were no color in nodes.</p>
<img src="tree/image/alg-delete-node.png" width="80%">
<p>Deleting a node given a <code>key</code> can be described as</p>
<ul>
<li>First, find a node <code>z</code> given a <code>key</code></li>
<li>Then, delete node <code>z</code></li>
</ul>
<pre><code class="language-java">public void remove(int key) {
    Node z = get(key);
    if (z != null) {
        delete(z);
    }
}
</code></pre>
<h2 id="delete-a-node-2"><a class="header" href="#delete-a-node-2">Delete a node (2)</a></h2>
<p>Recap the two cases of deleting a node <code>z</code> in a BST:</p>
<ul>
<li><strong>Case 1</strong>. <code>z</code> has at most one child. To delete <code>z</code>, we use its child (it can be <code>null</code>) to take the position of <code>z</code>.</li>
<li><strong>Case 2</strong>. <code>z</code> has two children. Then <code>y</code> is the successor of <code>z.right</code>. If <code>y</code> is not <code>z.right</code>, execute step (a) and (b) sequentially; otherwise, execute only step (b).
<ul>
<li>(a) <code>y.right</code> (it can be <code>null</code>) takes the position of <code>y</code>, and then update <code>y.right</code> to <code>z.right</code>.</li>
<li>(b) <code>y</code> takes the position of <code>z</code>, and then update <code>y.left</code> to <code>z.left</code>.</li>
</ul>
</li>
</ul>
<p>In fact, case 2 can be transformed into case 1 by updating the <code>z.key</code> to <code>y.key</code>. In light of this, we can design a more readable algorithm:</p>
<img src="tree/image/alg-delete-node2.png" width="80%">
<p>By taking the leverage of the ternary conditional operator in Java, the code can be even shorter in practice for case 1:</p>
<pre><code class="language-java">Node&lt;Key&gt; x = (z.left != null) ? z.left : z.right;
transplant(z, x);
</code></pre>
<p>In Python, it can be written as:</p>
<pre><code class="language-python">x = z.left if z.left is not None else z.right
transplant(z, x)
</code></pre>
<h2 id="delete-a-node-3"><a class="header" href="#delete-a-node-3">Delete a node (3)</a></h2>
<p>To delete a node <code>z</code> in a RBT, we need to consider the color of it:</p>
<ul>
<li>If <code>z</code> is <em>RED</em>, then it will not violate any <em>red-black tree property</em>.</li>
<li>If <code>z</code> is <em>BLACK</em>, then it violates Property 5 (*change in black height).</li>
</ul>
<p>We are going to say that Property 5 has not been violated and the node <code>x</code> which is now occupying <code>z</code>'s original position has an <em>extra black</em> in it. In this way, the property of black height is not violated but Property 1 is violated, because <code>x</code> now is either</p>
<ul>
<li>Double black, transformed from <em>BLACK</em>.</li>
<li>Red and black, transformed from <em>RED</em>.</li>
</ul>
<p>For example, deleting <code>z</code> in the following result in a <em>red and black</em> node:</p>
<img src="tree/image/rb-x-red.png">
<p>With this thinking, we can say that either Property 1, 2 or 4 can be violated. If <code>x</code> is <em>red and black</em> or is <code>root</code>, we can simply color it black.</p>
<blockquote>
<h3 id="what-if-x-is-null"><a class="header" href="#what-if-x-is-null">What if <code>x</code> is null?</a></h3>
<p>Now let's consider a special case when <code>x</code> is null (i.e., <code>z</code> does not have any child). As we can see, the introduction of the sentinel (<code>NIL</code>) will lead to simpler code, because we can regard it as a regular node whose color is always black. For example, we are able to up-swim to the parent from a <code>NIL</code>, and \(v.p \gets u.p\) is always valid in the <code>transplant</code>.</p>
</blockquote>
<p>Therefore, suppose <code>z</code> has at most one child, we use its child <code>x</code> to replace its position:</p>
<ul>
<li><strong>Case a</strong>: if <code>z</code> is red, then just delete it.</li>
<li><strong>Case b</strong>: if <code>z</code> is black with a red child <code>x</code>, then color <code>x</code> to black.</li>
<li><strong>Case c</strong>: if <code>z</code> is black, and <code>x</code> is also black, then things get complicated, and we need to fix it up. In this case, <code>x</code> is a <em>double black</em> node.</li>
</ul>
<p>To understand case c, readers can try to maintain the BST by deleting 1:</p>
<img src="tree/image/rb-delete-example.png">
<p>In what follows, we will analyze four sub-cases for <em>case c</em> when <code>x</code> is a left child, and another four cases when <code>x</code> is a right child is symmetric.</p>
<img src="tree/image/alg-rb-delete-fixup.png" width="80%">
<h3 id="case-1-xs-sibling-w-is-red"><a class="header" href="#case-1-xs-sibling-w-is-red">Case 1: <code>x</code>'s sibling <code>w</code> is red</a></h3>
<img src="tree/image/rb-delete-fix1.png">
<p>Case 1 is transformed into case 2, 3, or 4 by exchanging the colors of nodes <em>B</em> and <em>D</em> and performing a left rotation.</p>
<h3 id="case-2-xs-sibling-w-is-black-and-both-of-ws-children-are-black"><a class="header" href="#case-2-xs-sibling-w-is-black-and-both-of-ws-children-are-black">Case 2: <code>x</code>'s sibling <code>w</code> is black, and both of <code>w</code>'s children are black</a></h3>
<img src="tree/image/rb-delete-fix2.png">
<p>To balance the black height, this cases removes one black from both <em>x</em> and <em>w</em>, leaving <em>x</em> with only one black and leaving <em>w</em> red. To compensate for <em>x</em> and <em>w</em> each losing one black, <code>x.p</code> can take on an extra black. Line 16 does so by moving up <code>x</code> to its parent.</p>
<p><strong>Note that <em>B</em> is colored in brown, meaning it can be either black or red</strong>. If case 2 enters from case 1, then the new node <em>x</em> (i.e., <em>B</em>) is red-and-black. Then the <strong>while</strong> loop terminates.</p>
<h3 id="case-3-xs-sibling-w-is-black-ws-left-child-is-red-and-ws-right-child-is-black"><a class="header" href="#case-3-xs-sibling-w-is-black-ws-left-child-is-red-and-ws-right-child-is-black">Case 3: <code>x</code>’s sibling <code>w</code> is black, <code>w</code>’s left child is red, and <code>w</code>’s right child is black</a></h3>
<img src="tree/image/rb-delete-fix3.png">
<p>This case switches the colors of <em>w</em> and its left child <em>w.left</em>, and then performs a right rotation on <em>w</em>. Then it falls through into case 4.</p>
<h3 id="case-4-xs-sibling-w-is-black-and-ws-right-child-is-red"><a class="header" href="#case-4-xs-sibling-w-is-black-and-ws-right-child-is-red">Case 4: <code>x</code>'s sibling <code>w</code> is black, and <code>w</code>'s right child is red.</a></h3>
<img src="tree/image/rb-delete-fix4.png">
<p>Some color changes and a left rotation on <em>x.p</em> allow the extra black on <em>x</em> to vanish. Note that <em>D</em>'s color is set to the one of <em>B</em>. Line 31 sets <em>x</em> to <code>root</code>, and the <strong>while</strong> loop will terminate.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="case-study-1"><a class="header" href="#case-study-1">Case Study</a></h1>
<p>As for the search/insert operation, we can summarize the time complexities of four common data structures we have learned:</p>
<div class="table-wrapper"><table><thead><tr><th>Algorithm (DAT)</th><th>Worst case cost <br> <em>after N inserts</em></th><th>Average case cost <br> <em>after N random inserts</em></th></tr></thead><tbody>
<tr><td>sequential search (unordered linked list)</td><td><strong>search</strong>: \(O(N)\) <br> <strong>insert</strong>: \(O(N)\)</td><td><strong>search</strong>: \(O(N)\) <br> <strong>insert</strong>: \(O(N)\)</td></tr>
<tr><td>binary search (ordered array)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(N)\)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(N)\)</td></tr>
<tr><td>binary tree search (BST)</td><td><strong>search</strong>: \(O(N)\) <br> <strong>insert</strong>: \(O(N)\)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(lg{N})\)</td></tr>
<tr><td>red-black BST</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(lg{N})\)</td><td><strong>search</strong>: \(O(lg{N})\) <br> <strong>insert</strong>: \(O(lg{N})\)</td></tr>
</tbody></table>
</div>
<h2 id="time-efficiency"><a class="header" href="#time-efficiency">Time efficiency</a></h2>
<p>As we can see, the RBT is very efficient in terms of common operations, so it can be used fundamental building blocks in data structures underlying numerous applications:</p>
<ul>
<li>Many language standard collections, such as <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/HashMap.html">HashMap</a> in Java and most implementations of STL in C++, are based on the red-black trees.</li>
<li>Linux kernel uses the red-black tree in the memory management and task scheduling.</li>
</ul>
<p>In what follows, we designed an experiment to compare <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ArrayList.html">ArrayList</a> and a red black tree in terms of their search efficiency.</p>
<img src="tree/image/rb-time.png" width="80%">
<p>The results show the great superiority of the red-black tree.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-3"><a class="header" href="#exercise-3">Exercise</a></h1>
<ol>
<li>Please implement a BST which contains both <em>keys</em> and <em>values</em>. In other words, it works like a <em>map</em>, and it supports:</li>
</ol>
<ul>
<li><code>put(key, value)</code>: If <code>key</code> is found, update its associated value to <code>value</code>; otherwise, insert a new node.</li>
<li><code>get(key)</code>: Return value associated with <code>key</code>; return <code>null</code> if key is not present.</li>
<li><code>delete(key)</code>: Delete the node whose key is <code>key</code>; do nothing if key is not present.</li>
</ul>
<hr />
<ol start="2">
<li>When updating (i.e., <code>put()</code> or <code>delete()</code>) a BST, it is required that the <em>binary-search-tree property</em> holds true. Please design an algorithm to check whether a given BST is valid.</li>
</ol>
<hr />
<ol start="3">
<li>
<p>In our implementation of <code>remove()</code> of a BST, <code>x</code> can be replaced with the leftmost (i.e, <em>min</em>) node <code>y</code> in the tree rooted at <code>x.right</code>. Alternatively, <code>x</code> can also be replaced with the the rightmost (i.e., <em>max</em>) node <code>z</code> in the tree rooted at <code>x.left</code>. Essentially, <code>z</code> is the predecessor of <code>x</code>. Please design an algorithm using this idea.</p>
<pre><code>       10                              8
     /     \         delete(10)      /    \
   7       15       ---------&gt;     7       15 
 /  \    /   \                    /       /  \ 
5    8  11   18                 5        11   18
</code></pre>
</li>
</ol>
<hr />
<ol start="4">
<li>Please implement <code>removeMax(x, key)</code> which returns a new root for a BST in an iterative way.</li>
</ol>
<hr />
<ol start="5">
<li>Ordered-based operations.</li>
</ol>
<ul>
<li>Please implement all order-based operations for a BST introduced in <a href="tree/./bst2.html">Binary Search Tree (2)</a>.</li>
<li>Can you implement them in an iterative way?</li>
</ul>
<hr />
<ol start="6">
<li>Please argue that inserting a new key into a RBT will never violate Property 1, 3 and 4.</li>
</ol>
<hr />
<ol start="7">
<li>Try to implement a RBT with a global <code>NIL</code> object.</li>
</ol>
<hr />
<ol start="8">
<li>Please plot the height of a RBT with random <em>N</em> keys.</li>
</ol>
<hr />
<ol start="9">
<li>A node <code>x</code> is inserted into a RBT with <code>put()</code> and then is immediately deleted with <code>remove()</code>. Is the resulting tree always the same as the initial red-black tree? Justify your answer.</li>
</ol>
<hr />
<ol start="10">
<li>If we didn't introduce <code>NIL</code> object, then how to handle the case when <code>x</code> is <code>null</code> for the deletion on a RBT?</li>
</ol>
<hr />
<ol start="11">
<li>Draw the RBT that results when you insert items with the keys (10, 2, 30, 40, 26, 32, 11, 18) in that order into an initially empty tree.</li>
</ol>
<hr />
<ol start="12">
<li>Please design an algorithm to check whether a given RBT is valid.</li>
</ol>
<hr />
<ol start="13">
<li>A <a href="https://en.wikipedia.org/wiki/K-d_tree">k-d tree</a> (short for k-dimensional tree) is a space-partitioning data structure for organizing points in a k-dimensional space.</li>
</ol>
<p>Please complete the code based on <a href="https://github.com/ChenZhongPu/data-structure-swufe/tree/master/code/python/tree/kd_tree.py">kd_tree.py</a> or <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/tree/src/main/java/org/swufe/KDTree.java">KDTree.java</a>. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="priority-queues"><a class="header" href="#priority-queues">Priority Queues</a></h1>
<p>A queue is a collection of objects that are inserted and removed according to the <em>first-in, first-out</em> (FIFO) policy. However, in practice, we would like to assign a <strong>priority</strong> to the item so that the one with the highest priority will be processed first. For example, you are likely to have a computer (or a cellphone) that is capable of running several applications at the same time. This effect is typically achieved by assigning a priority to events associated with applications, then always choosing to process next the highest-priority event. For example, most cellphones are likely to process an incoming call with higher priority than a game application.</p>
<p>An appropriate ADT in such an environment is called a <strong>priority queue</strong><sup class="footnote-reference"><a href="#pq">1</a></sup>, and it supports two operations:</p>
<ul>
<li><em>remove the maximum</em></li>
<li><em>insert</em></li>
</ul>
<p>Using priority queues is similar to using queues (remove the <em>oldest</em>) and stacks (remove the <em>newest</em>), but implementing them efficiently is more challenging.</p>
<hr />
<p><sup class="footnote-reference"><a href="#pq">1</a></sup> By default, it is <em>maximum priority queue</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pq-implementation-1"><a class="header" href="#pq-implementation-1">PQ Implementation (1)</a></h1>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<p>Priority queues are characterized by the <em>remove the maximum</em> and <em>insert</em> operations. A typical <code>MaxPQ</code> supports the following APIs:</p>
<ul>
<li><code>insert(v)</code>: insert a key into the priority queue</li>
<li><code>max()</code>: return the largest key</li>
<li><code>delMax()</code>: return and remove the largest key</li>
<li><code>isEmpty()</code>: is the priority queue empty?</li>
<li><code>size()</code>: number of keys in the priority queue</li>
</ul>
<p>Any <code>MaxPQ</code> implementation is easily converted into a <code>MinPQ</code> implementation and vice versa.</p>
<h2 id="elementary-implementations"><a class="header" href="#elementary-implementations">Elementary implementations</a></h2>
<p>The simplest priority-queue implementation is based on the code for stacks.</p>
<ul>
<li><em>insert</em>: The same for <code>push()</code> in the stack.</li>
<li><em>remove the maximum</em>: exchange the maximum item with the item at the end, and then delete that one, as we did with <code>pop()</code> for stacks.</li>
</ul>
<p>Another approach is to add code for <em>insert</em> to keep the keys in the array in order. Thus, the largest element is always at the end.</p>
<div class="table-wrapper"><table><thead><tr><th>data structure</th><th>insert</th><th>remove maximum</th></tr></thead><tbody>
<tr><td>ordered array</td><td>\(O(N)\)</td><td>\(O(1)\)</td></tr>
<tr><td>unordered array</td><td>\(O(1)\)</td><td>\(O(N)\)</td></tr>
</tbody></table>
</div>
<p>In addition, if we start with the linked list the linked list representation, the performance analysis is the similar.</p>
<p>As we can see, an ordered sequence is the prototypical <em>eager</em> approach, where we do as much work we can up front to make the latter operations efficient; unordered sequence is the <em>lazy</em> approach, where we defer doing work until sequences. But, both methods are unable to support all operations that take <em>constant</em> time.</p>
<p>How can we achieve a balance so that all operations are efficient? In the following section, we will learn another important data structure called <strong>heap</strong> that makes it possible.</p>
<h2 id="heap-based-implementation"><a class="header" href="#heap-based-implementation">Heap based implementation</a></h2>
<h3 id="heap"><a class="header" href="#heap">Heap</a></h3>
<blockquote>
<p>A binary tree is <em>heap-ordered</em> if the key in each node is larger than or equal to the keys in that node's two children (if any).</p>
</blockquote>
<p>From this definition, we can know that <strong>the largest key in a heap-ordered binary tree is found at the root</strong>. Different from a BST, duplicated keys are allowed in a heap-ordered binary tree.</p>
<h4 id="binary-heap-representation"><a class="header" href="#binary-heap-representation">Binary heap representation</a></h4>
<p>We can use a linked representation for heap-ordered binary trees, as we did for a BST. But, it is particularly convenient to use a <em>complete</em> binary tree to represent it.</p>
<img src="pq/image/max-heap.png" width="80%">
<p>Complete binary tree provides the opportunity to use a compact array representation that does not involve explicit links. To be specific, we represent complete binary trees sequentially within an array by putting the nodes in <em>level order</em>, with the root at position 1, its children at positions 2 and 3, their children in positions 4, 5, 6 and 7, and so on.</p>
<div class="table-wrapper"><table><thead><tr><th>i</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th></tr></thead><tbody>
<tr><td>a[i]</td><td></td><td>40</td><td>39</td><td>34</td><td>30</td><td>20</td><td>8</td><td>14</td><td>6</td><td>10</td><td>15</td><td>12</td></tr>
</tbody></table>
</div><img src="pq/image/max-heap2.png" width="80%">
<blockquote>
<p>A binary heap is a collection of keys arranged in a complete heap-ordered binary tree, represented in level order in an array (not using the first entry).</p>
</blockquote>
<p>Using this representation, the relationship between <em>parent-children</em> in a binary heap can be inferred by the position (i.e, index) in an array. For brevity, we will use <em>heap</em> when referring to a binary heap.</p>
<ul>
<li>The parent of the node in position <em>k</em> is position \(\lfloor k/2 \rfloor\).</li>
<li>The two children of the node in position <em>k</em> are in positions <em>2k</em> and <em>2k + 1</em>.</li>
</ul>
<p>It is easy to prove that the height of a complete binary tree of size N is \(\lfloor \lg{N} \rfloor\). Due to this property, we can design algorithms in guaranteed logarithmic time.</p>
<div class="table-wrapper"><table><thead><tr><th>data structure</th><th>insert</th><th>remove maximum</th></tr></thead><tbody>
<tr><td>binary heap</td><td>\(O(\lg{N})\)</td><td>\(O(\lg{N})\)</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="pq-implementation-2"><a class="header" href="#pq-implementation-2">PQ Implementation (2)</a></h1>
<p>We represent a heap of size <em>N</em> in private array <code>pq[]</code> of length <em>N + 1</em>, with <code>pq[0]</code> unused. </p>
<p>To make it easy to describe the algorithm and hide the differences in different languages, we further design two helper methods:</p>
<ul>
<li><code>less(i, j)</code>: to test if <code>qp[i]</code> is less than <code>qp[j]</code></li>
<li><code>swap(i, j)</code>: to swap (exchange) <code>qp[i]</code> and <code>qp[j]</code></li>
</ul>
<p>To compare two values, we can use <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Comparable.html">Comparable</a>'s <code>compareTo()</code> method in Java, and the built-in <code>&lt;</code> operator in Python. To swap two values,</p>
<pre><code class="language-java">private void swap(int i, int j) {
    Key t = pq[i];
    qp[i] = qp[j];
    qp[j] = t;
}
</code></pre>
<pre><code class="language-python">def _swap(self, i, j):
    self._pq[i], self._qp[j] = self._pq[j], self._qp[i] 
</code></pre>
<p>Like the modifications on a BST, heap operations could violate the <em>heap property</em>, and we need to fix it. We refer to this process as <em>reheapifying</em>, or <em>restoring</em>. </p>
<p>There are two cases:</p>
<ul>
<li>For some node with a high priority, we have to travel <em>up</em> the heap.</li>
<li>For some node with a low priority, we have to travel <em>down</em> the heap.</li>
</ul>
<h2 id="bottom-up-reheapify-swim"><a class="header" href="#bottom-up-reheapify-swim">Bottom-up reheapify (swim)</a></h2>
<p>If the heap order is violated because a node's key becomes larger than its parent's key, then we can fix the violation by exchanging the node with its parent by swimming up.</p>
<img src="pq/image/swim.png" width="70%">
<p>To justify the method’s name, we think of the new node, having too large a key, as having to <em>swim</em> to a higher level in the heap.</p>
<img src="pq/image/alg-swim.png" width="80%">
<h2 id="top-down-reheapify-sink"><a class="header" href="#top-down-reheapify-sink">Top-down reheapify (sink)</a></h2>
<p>If the heap order is violated because a node's key becomes <em>smaller</em> than one of both of that node's children's keys, then we can make progress toward fixing the violation by exchanging the node with the larger of its two children. This switch may cause a violation at the child; we fix that violation in the same way by moving down the heap.</p>
<img src="pq/image/sink.png" width="70%">
<p>To justify the method’s name, we think of the new node, having too small a key, as having to <em>sink</em> to a lower level in the heap.</p>
<img src="pq/image/alg-sink.png" width="80%">
<h2 id="insert"><a class="header" href="#insert"><code>insert()</code></a></h2>
<p>We add the new key at the end of the array, increment the size of the heap, and then swim up through the heap with that key to restore the heap property.</p>
<pre><code class="language-java">public void insert(Key v) {
    pq[++N] = v;
    swim(N);
}
</code></pre>
<img src="pq/image/insert.png" width="70%">
<h2 id="delmax"><a class="header" href="#delmax"><code>delMax()</code></a></h2>
<p>The exchange the last key with the root (whose key is the largest), decrement the size of the heap, and then sink down through the heap with that key to restore the heap property.</p>
<pre><code class="language-java">public Key delMax() {
    Key max = pq[1];
    swap(1, N--);
    pq[N+1] = null;
    sink(1);
    return max;
}
</code></pre>
<img src="pq/image/remove.png" width="70%">
<h2 id="a-few-notes-on-implementations"><a class="header" href="#a-few-notes-on-implementations">A few notes on implementations</a></h2>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/pq/src/main/java/org/swufe/datastructures/MaxPQ.java">MaxPQ.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/python/pq/max_pq.py">max_pq.py</a>.</p>
<h3 id="python-3"><a class="header" href="#python-3">Python</a></h3>
<p>Since the first position (i.e., index 0) is unused, we can append <code>None</code> as a dummy at index 0.</p>
<pre><code class="language-python">def __init__(self):
    self._pq = []
    self._pq.append(None)
</code></pre>
<p>And the size of the heap is <code>len(self._pq) - 1</code>.</p>
<h3 id="java-3"><a class="header" href="#java-3">Java</a></h3>
<p>If we use <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ArrayList.html">ArrayList</a> which has the resizing capability, the code is similar to the Python version. Instead, I choose the built-in array type and implement the resizing method by ourselves, as we did for stacks.</p>
<p>By the way, to swap two elements in an <code>ArrayList</code>, we can use:</p>
<pre><code class="language-java">private void swap(int i, int j) {
    Collections.swap(pq, i, j);
}
</code></pre>
<h2 id="how-to-construct-a-heap-from-elements"><a class="header" href="#how-to-construct-a-heap-from-elements">How to construct a heap from elements</a></h2>
<p>Given a list of <em>N</em> elements, how to construct a heap from them? A naive way is to call the <code>insert()</code> method <em>N</em> times. Essentially, it is to call <em>N</em> times <code>swim()</code>, which takes \(O(N\lg{N})\) time totally.</p>
<pre><code class="language-java">@SuppressWarnings(&quot;unchecked&quot;)
public MaxPQ(Key[] data) {
    n = data.length;
    pq = (Key[]) new Comparable[n + 1];
    System.arraycopy(data, 0, pq, 1, n);
    for (int k = 1; k &lt;= n; k--) {
        swim(k);
    }
}
</code></pre>
<p>A clever method that is much more efficient is to use <code>sink()</code> to make sub-heaps as we go, which takes \(O(N)\) time in total.</p>
<pre><code class="language-java">@SuppressWarnings(&quot;unchecked&quot;)
public MaxPQ(Key[] data) {
    n = data.length;
    pq = (Key[]) new Comparable[n + 1];
    System.arraycopy(data, 0, pq, 1, n);
    for (int k = n / 2; k &gt;= 1; k--) {
        sink(k);
    }
}
</code></pre>
<p>In what follows, let's prove that sink-based heap construction uses at most <em>2N</em> compares and at most <em>N</em> exchanges. </p>
<p>It suffices to prove that sink-based heap construction uses fewer than <em>N</em> exchanges because the number of compares is at most twice the number of exchanges. For simplicity, assume that the binary heap is perfect (i.e., a binary tree in which every level is completely filled) and has height <em>h</em>. </p>
<p>A key at height <em>k</em> can be exchanged with at <em>k</em> keys beneath it when it is sunk down. Since there are \(2^{h-k}\) nodes at height <em>k</em>, the total number of exchanges is at most</p>
<p>\[h + 2(h - 1) + 4(h - 2) + 8(h - 3) + \dots + 2^{h}(0) =
2^{h+1} - h - 2 = n - (h + 1) \leq n.
\]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="case-study-2"><a class="header" href="#case-study-2">Case Study</a></h1>
<p>In this section, we will study the <em>comparison</em> in depth and then implement a more flexible <code>MaxPQ</code>. Note that the basic skills can also be applied in all ordered collections, including the BST in the previous chapter. Finally, I will introduce the standard binary heap libraries.</p>
<h2 id="comparison-in-depth"><a class="header" href="#comparison-in-depth">Comparison in depth</a></h2>
<h3 id="java-4"><a class="header" href="#java-4">Java</a></h3>
<p>Given an array <code>int[] a = {1, 9, 4, 6, 3}</code>, how to sort it?</p>
<pre><code class="language-java">Arrays.sort(a);
// a becomes {1, 3, 4, 6, 9}
</code></pre>
<p>It works because <code>int</code> has a built-in ascending order<sup class="footnote-reference"><a href="#reverse1">1</a></sup>. Similarly, given a list, you can use <code>Collections.sort(a)</code>. But how can you compare two books?</p>
<pre><code class="language-java">public class Book {
    private String name;
    private double price;
    private String author;
    ...
}
</code></pre>
<p>One possible way is to let <code>Book</code> implement <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Comparable.html">Comparable</a>, and override its <code>toCompare()</code> method. For example, the following code will sort books by their prices in ascending order:</p>
<pre><code class="language-java">public class Book implements Comparable&lt;Book&gt; {
    @Override
    public int compareTo(Book o) {
        return Double.compare(price, o.price);
    }
}
</code></pre>
<p>Then you can sort books:</p>
<pre><code class="language-java">List&lt;Book&gt; books = new ArrayList&lt;&gt;();
books.add(new Book(&quot;Gone with the wind&quot;, 89));
books.add(new Book(&quot;Data structures&quot;, 120));
books.add(new Book(&quot;The old man and the sea&quot;, 36));
Collections.sort(books);
</code></pre>
<p>However, <strong>sometimes you are unable to change the class you want to compare, and you may even want different comparing rules in different settings</strong>. In this case, you can use <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Comparator.html">Comparator</a> by providing an on-the-fly comparing criterion in its <code>compare()</code> method:</p>
<pre><code class="language-java">class BookNameComparator implements Comparator&lt;Book&gt; {
    @Override
    public int compare(Book o1, Book o2) {
        return o1.getName().compareTo(o2.getName());
    }
}
</code></pre>
<p>Then, you can use the following code:</p>
<pre><code class="language-java">// you can use either line, but the second one is recommended
Collections.sort(books, new BookNameComparator());
books.sort(new BookNameComparator());
</code></pre>
<p>In Java 8 and above, you also can use lambda expression to shorten the code without providing an explicit comparator class:</p>
<pre><code class="language-java">// you can use either line, but the second one is recommended 
books.sort((a, b) -&gt; a.getAuthor().compareTo(b.getAuthor()));
books.sort(Comparator.comparing(Book::getAuthor));
</code></pre>
<h3 id="python-4"><a class="header" href="#python-4">Python</a></h3>
<p>Python provides two kinds of basic methods to sort items. In what follows, I only take <code>sort()</code> method as the example, and most rules are also applicable for <code>sorted()</code>. </p>
<ul>
<li><code>sort()</code>: in-place sorting, as we have seen in Java</li>
<li><code>sorted()</code>: return a sorted collection, and leave the origin collection unchanged</li>
</ul>
<pre><code class="language-python">a = [1, 9, 4, 6, 3]
b = sorted(a)
# b is [1, 3, 4, 6, 9]
# a is unchanged
a.sort()
# now a becomes [1, 3, 4, 6, 9] 
</code></pre>
<p>In fact, the syntax of <code>sort()</code> is <code>list.sort(key=..., reverse=...)</code>. So we further specify two parameters:</p>
<ul>
<li><em>key</em>: function that serves as a key for the sort comparison</li>
<li><em>reverse</em>: if <code>True</code>, the sorted list is reversed (or sorted in descending order)</li>
</ul>
<pre><code class="language-python">a = [1, 9, 4, 6, 3]
a.sort(reverse=True)
# a becomes [9, 6, 4, 3, 1] 
</code></pre>
<p>The role of <code>key</code> is similar to that of <code>Comparator</code> in Java. Suppose there is a <code>Book</code> class:</p>
<pre><code class="language-python">class Book:
    def __init__(self, name, price, author):
        self.name = name
        self.price = price
        self.author = author
</code></pre>
<p>To pass a lambda expression to key:</p>
<pre><code class="language-python">books.sort(key=lambda book: book.price)
</code></pre>
<p>You can also pass a built-in or self-defined method:</p>
<pre><code class="language-python">def book_title(b):
    return b.name

books.sort(key=book_title)
</code></pre>
<p>Alternatively, you can also provide a method accepting two parameters, and returning -1, 1, 0 as the results. The mechanism is the same with <code>Comparator</code>: </p>
<pre><code class="language-python">from functools import cmp_to_key

def book_title_len(b1: Book, b2: Book):
    &quot;&quot;&quot;the longer first&quot;&quot;&quot;
    if len(b1.name) &lt; len(b2.name):
        return 1
    elif len(b1.name) &gt; len(b2.name):
        return -1
    else:
        return 0

books.sort(key=cmp_to_key(book_title_len))
</code></pre>
<p>By default, the <code>sort()</code> method relies on <code>&lt;</code> operator, and it can be overridden by the <code>__lt__()</code> method:</p>
<pre><code class="language-python">def __lt__(self, other):
    return self.price &lt; other.price
</code></pre>
<p>Then you can use <code>books.sort()</code> directly.</p>
<h4 id="a-few-notes-on-tuples"><a class="header" href="#a-few-notes-on-tuples">A few notes on tuples</a></h4>
<p>In many cases, items are organized as tuples. For example,</p>
<pre><code class="language-python">books = [('Zoo', 30), ('Gone with the wind', 42), ('The A.B.C. Murders', 20)]
</code></pre>
<p>To sort these tuples in a list, a common method is to use <code>from operator import itemgetter</code>:</p>
<pre><code class="language-python"># sort by its price (the second filed)
books.sort(key=itemgetter(1))

# sort by its name (the first filed)
books.sort(key=itemgetter(0))
</code></pre>
<h2 id="a-flexible-maxpq"><a class="header" href="#a-flexible-maxpq">A flexible MaxPQ</a></h2>
<h3 id="java-5"><a class="header" href="#java-5">Java</a></h3>
<p>The <code>MaxPQ</code> requires that the keys are ordered, but we should not always expect the class implements <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Comparable.html">Comparable</a> in Java. Instead, users can pass an extra parameter as the comparator.</p>
<ul>
<li>If this comparator is null, then we still try to use the <code>Comparable</code> interface as the last resort.</li>
<li>Otherwise, we would use this self-defined comparator.</li>
</ul>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/pq/src/main/java/org/swufe/datastructures/MaxPQ2.java">MaxPQ2.java</a>.</p>
<h3 id="python-5"><a class="header" href="#python-5">Python</a></h3>
<p>Because Python is a dynamic language, the statement &quot;<em>sometimes you are unable to change the class you want to compare</em>&quot; does not hold true. For example, we can specify <code>__lt__()</code> in the runtime:</p>
<pre><code class="language-python">class User:
    def __init__(self, name, age):
        self.name = name
        self.age = age

def user_cmp(self, other):
    return self.age &lt; other.age

User.__lt__ = user_cmp
</code></pre>
<p>But this approach is not Pythonic. Alternatively, you can pass a function as a key for the sort comparison, as we did for <code>sort()</code> method. Another feasible choice is to pass a <code>less()</code> function that returns a boolean value directly. Such function can be seen as a user-defined comparator.</p>
<h2 id="standard-libraries"><a class="header" href="#standard-libraries">Standard libraries</a></h2>
<blockquote>
<p>Again, like queues, we do not have to implement our own priority queues in most cases, and you should first check if the standard libraries can meet your requirements.</p>
</blockquote>
<h3 id="java-6"><a class="header" href="#java-6">Java</a></h3>
<p>Among Java's collections family, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/PriorityQueue.html">PriorityQueue</a> ,implementing interface <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Queue.html">Queue</a>, works like <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/pq/src/main/java/org/swufe/datastructures/MaxPQ2.java">MaxPQ2.java</a>. The elements of the priority queue are ordered according to their <em>natural ordering</em> (i.e., <code>Comparable</code>), or by a <code>Comparator</code>. <strong>Note that it is a minimum heap</strong>.</p>
<ul>
<li><em>insert</em>: <code>add()</code> or <code>offer()</code></li>
<li><em>return the minimum</em>: <code>peek()</code></li>
<li><em>remove the minimum</em>: <code>remove()</code> or <code>poll</code></li>
</ul>
<pre><code class="language-java">Queue&lt;Integer&gt; pq = new PriorityQueue&lt;&gt;();
pq.add(1);
pq.add(9);
pq.add(4);
pq.add(0);
pq.add(6);
pq.add(3);
System.out.println(pq.peek()); // 0
System.out.println(pq.remove()); // 0
System.out.println(pq.peek()); // 1
</code></pre>
<h3 id="python-6"><a class="header" href="#python-6">Python</a></h3>
<p>Module <a href="https://docs.python.org/3/library/heapq.html">heapq</a> provides an implementation of the heap queue algorithm, also known as the priority queue algorithm. Note that <code>heap[0]</code> is the smallest item, so <strong>it is also a minimum heap</strong>. </p>
<pre><code class="language-python">pq = []
heapq.heappush(pq, 1)
heapq.heappush(pq, 9)
heapq.heappush(pq, 4)
heapq.heappush(pq, 0)
heapq.heappush(pq, 6)
heapq.heappush(pq, 3)
print(heapq.heappop(pq))  # 0
print(pq[0])  # 1: works like `peek()`
print(heapq.heappop(pq))  # 1
</code></pre>
<p>By the way, the tutorial also provides an approach to solve the problem that the data elements are not comparable:</p>
<pre><code class="language-python">from dataclasses import dataclass, field
from typing import Any

@dataclass(order=True)
class PrioritizedItem:
    priority: int
    item: Any=field(compare=False)
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#reverse1">1</a></sup> If you would like a reverse order, you can use <code>Arrays.sort(a, Collections.reverseOrder())</code>. As for a list, you can use <code>Collections.sort(a, Collections.reverseOrder())</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="index-priority-queue"><a class="header" href="#index-priority-queue">Index Priority Queue</a></h1>
<p>In fact, when designing a priority queue, we shall assume that <strong>the keys are immutable</strong>. In other words, the client code does not change the keys; otherwise, it might invalidate the heap-order invariant. For example, <code>b2</code> will be the first (<em>root</em>) element:</p>
<pre><code class="language-java">// assume books are compared by their prices
MaxPQ&lt;Book&gt; qp = new MaxPQ&lt;Book&gt;();
Book b1 = new Book(&quot;Gone with the wind&quot;, 89, &quot;Margaret Mitchell&quot;);
Book b2 = new Book(&quot;Data structures&quot;, 120, &quot;Unknown&quot;);
Book b3 = new Book(&quot;The old man and the sea&quot;, 36, &quot;Ernest Hemingway&quot;);
pq.insert(b1);
pq.insert(b2);
pq.insert(b3);
</code></pre>
<p>But what if the sellers offer a 50% discount on <code>b2</code>? You may expect <code>b1</code> will become the first (<em>root</em>) element. However, the <em>reheapifying</em> process will not happen automatically. One common solution to this is an <strong>index priority queue</strong>.</p>
<p>An <em>index priority queue</em> assigns an <em>index</em> as the <em>position</em> to the element, and thus we can retrieve the element through the index, and we can even change the priority during runtime. In what follows, we will implement an <code>IndexedMinPQ</code>, and the maximum-oriented version is similar. For brevity, the error handling code is omitted.</p>
<h2 id="indexminpq"><a class="header" href="#indexminpq">IndexMinPQ</a></h2>
<p>We mainly use the array as the underlying data structure:</p>
<ul>
<li><code>Key[] keys</code>: <code>keys[i]</code> is the priority of <code>i</code></li>
<li><code>int[] pq</code>: binary heap using 1-based indexing</li>
<li><code>int[] qp</code>: reverse of <code>pq</code>, so <code>qp[pq[i]] = pq[qp[i]] = i</code></li>
<li><code>n</code>: the size of the heap</li>
</ul>
<p>Given the heap <code>pq</code>, the elements will be compared by <code>keys[pq[i]]</code>, instead of <code>pq[i]</code>. As a result, the minimal key is <code>keys[pq[1]]</code>. To insert a <em>key</em> with an associated index <em>i</em>:</p>
<pre><code class="language-java">public void insert(int i, Key key) {
    n++;
    qp[i] = n;
    pq[n] = i;
    keys[i] = key;
    swim(n);
}
</code></pre>
<p>It means that the <em>n</em>-th location of the heap (<code>pq</code>) stores the <em>key</em>'s associated index <em>i</em>. Note that the map from <em>i</em> to <em>n</em> can be returned via the reverse array <code>qp</code>. After swimming, both <code>pq</code> and <code>qp</code> might change. Let's recap the connections again:</p>
<ul>
<li><code>keys</code>: a <em>key</em> has an associated index <em>i</em></li>
<li><code>pq</code>: the heap whose position <em>j</em> stores index <em>i</em>, and the comparator is based on <code>keys[i]</code></li>
<li><code>qp</code>: the reverse array of <code>pq</code></li>
</ul>
<p>Readers can try to implement the following methods, and the complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/pq/src/main/java/org/swufe/datastructures/IndeMinPQ.java">IndeMinPQ.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/python/pq/index_min_pq.py">index_min_pq.py</a>.</p>
<pre><code class="language-java">public int delMin() {
    // remove the minimum key and return its index
}

public void changeKey(int i, Key key) {
    // change the key associated with index `i` to `key`
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-4"><a class="header" href="#exercise-4">Exercise</a></h1>
<ol>
<li>Please implement <code>MaxPQ</code> based on an unordered array and ordered array, respectively.</li>
</ol>
<hr />
<ol start="2">
<li>Do exercise 1 using a linked list.</li>
</ol>
<hr />
<ol start="3">
<li>Please prove that the height of a complete binary tree of size N is \(\lfloor \lg{N} \rfloor\).</li>
</ol>
<hr />
<ol start="4">
<li>Please implement the minimum binary heap (<code>MinPQ</code>).</li>
</ol>
<hr />
<ol start="5">
<li>Please design an algorithm to test whether a maximum binary heap is valid.</li>
</ol>
<hr />
<ol start="6">
<li>Given the <code>Book</code> class, please compare books by the price first, and then by the length of titles if the prices are identical.</li>
</ol>
<hr />
<ol start="7">
<li>Please implement the <code>MaxPQ</code> with a user-defined comparator in Python.</li>
</ol>
<hr />
<ol start="8">
<li>Please implement a binary heap using explicit links. Hint: you shall use <em>left</em>, <em>right</em>, and <em>parent</em> as we did in a RBT.</li>
</ol>
<hr />
<ol start="9">
<li>How to use <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/PriorityQueue.html">PriorityQueue</a> or <a href="https://docs.python.org/3/library/heapq.html">heapq</a> as a minimum heap?</li>
</ol>
<hr />
<ol start="10">
<li>Please design an algorithm to sort a list based on the heap.</li>
</ol>
<hr />
<ol start="11">
<li>Please give the time analysis for <em>swim</em>-based heap construction.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-tables"><a class="header" href="#hash-tables">Hash Tables</a></h1>
<p>In <a href="hash/../fundamentals/fundamentals.html">Fundamentals</a>, we have learned how to use <code>HashMap</code> in Java, and <em>dictionaries</em> in Python. Essentially, they are all implemented with <strong>hash tables</strong>. </p>
<blockquote>
<p>Hashing is an extremely effective and practical technique: the basic dictionary operations require only \(O(1)\) time on the average. </p>
</blockquote>
<p>In this chapter, we mainly focus on three dictionary operations:</p>
<ul>
<li><em>search</em></li>
<li><em>insert</em></li>
<li><em>delete</em></li>
</ul>
<p>Like a BST, we mainly focus on <em>keys</em>, so the ADT is a <strong>set</strong>. If we also consider the <em>values</em>, then it is a <strong>symbol table</strong> (a.k.a., map).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="direct-address-tables"><a class="header" href="#direct-address-tables">Direct-address Tables</a></h1>
<p>Direct addressing is a simple technique that works well when the universe <em>U</em> of keys is reasonably small. Suppose each element has distinct key drawn from the universe \(U = \{0, 1, \dots, m - 1\}\), where <em>m</em> is not too large.</p>
<p>To represent the dynamic set, you can use an array, or <strong>direct-address table</strong>, denoted by <em>T[0:m-1]</em>, in which each position, or <strong>slot</strong> (a.k.a., <strong>bucket</strong>), corresponds to a key in the universe. Slot <em>k</em> points to an element in the key <em>k</em>. If the set contains no element with key <em>k</em>, then <em>T[k]</em> is <code>null</code>.</p>
<img src="hash/image/direct.png" width="80%">
<p>The set \(K = \{2, 3, 5, 8\}\) of actual keys determines the slots in the table that contain pointers to elements. The other slots, in blue, contain <code>null</code>. For some applications, the direct-address table itself can hold the elements.</p>
<p>The three dictionary operations based on a direct-address table are trivial to implement as long as you are able to use an array. The key point is to remember: <em>the index of the object is its key</em>.</p>
<pre><code class="language-python">def direct_address_search(self, k):
    return self._t[k]

def direct_address_insert(self, x):
    self._t[x.key] = x

def direct_address_delete(self, x):
    self._t[x.key] = None
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-tables-1"><a class="header" href="#hash-tables-1">Hash Tables</a></h1>
<p>The downside of direct addressing is apparent: if the universe <em>U</em> is large or infinite, storing a table <em>T</em> of size <em>|U|</em> may be impractical, or even impossible, given the memory available on a typical computer. Furthermore, the set <em>K</em> of keys <em>actually stored</em> may be so small relative to <em>U</em> that most of the space allocated for <em>T</em> would be wasted.</p>
<p>With direct addressing, an element with key <em>k</em> is stored in slot <em>k</em>, but with hashing, we use a <strong>hash function</strong> <em>h</em> to compute the slot number from the key <em>k</em>, so that the element goes into slot <em>h(k)</em>. The hash function <em>h</em> maps the universe <em>U</em> of keys into slots of a <strong>hash table</strong> <em>T[0:m-1]</em>:</p>
<p>\[h: U \rightarrow \{0, 1, \dots, m - 1\}\]</p>
<p>where the size <em>m</em> of the hash table is typically much less than <em>|U|</em>. We say that</p>
<ul>
<li>an element with key <em>k</em> <strong>hashes</strong> to slot <em>h(h)</em></li>
<li><em>h(k)</em> is the <strong>hash value</strong> of key <em>k</em></li>
</ul>
<img src="hash/image/table.png" width="70%">
<p>There is one hitch, namely that <strong>two keys may hash to the same slot</strong>. For example, keys \(k_2\) and \(k_5\) map to the same slot. We call this situation a <strong>collision</strong>. </p>
<p>Therefore, when it comes to hashing, we need to care about two components:</p>
<ul>
<li><em>hash function</em>: convert keys into array indices</li>
<li><em>collision resolution</em>: handle the case when two or more keys are mapped to the same index.</li>
</ul>
<p>In this section, we focus on the second component.</p>
<h2 id="collision-resolution-separate-chaining"><a class="header" href="#collision-resolution-separate-chaining">Collision resolution: separate chaining</a></h2>
<h3 id="a-simple-hash-function"><a class="header" href="#a-simple-hash-function">A simple hash function</a></h3>
<p>As for a positive integer, a straightforward, but not particularly good, way is to adopt the <em>modular</em> operation:</p>
<p>\[h(k) = k \ mod \ m\]</p>
<p>For example, suppose <em>m = 10</em>, then <em>h(1) = h(111) = 1</em>, <em>h(8) = 8</em>. </p>
<h3 id="hashing-with-separate-chaining"><a class="header" href="#hashing-with-separate-chaining">Hashing with separate chaining</a></h3>
<p>The input set of <em>n</em> elements is divided randomly into <em>m</em> subsets, each of approximate size <em>n/m</em>. A hash function determines which subset an element belongs to. Each subset is managed independently as a list.</p>
<img src="hash/image/chain.png">
<p>Let's take the simple modular hash function as the example, and suppose that the key is a positive integer. The figure above shows the idea behind <strong>chaining</strong>: each nonempty slot points to a linked list, and all the elements that hash to the same slot go into that slot's linked list. Thus, the hash table <em>T</em> can be represented as an array of (singly or doubly) linked lists with size of <em>m</em>. </p>
<blockquote>
<p>In what follows, we assume that a linked list is adopted<sup class="footnote-reference"><a href="#list">1</a></sup>. But in fact, data structures that store the separate chains are not limited to a linked list, and user can also choose:</p>
<ul>
<li>a resizing array</li>
<li>a self-balancing BST (e.g., red-black tree)</li>
</ul>
</blockquote>
<h3 id="analysis"><a class="header" href="#analysis">Analysis</a></h3>
<p>How well does hashing with chaining perform? In particular, how long does it take to search for an element with a given key? Given a hash table <em>T</em> with <em>m</em> slots that stores <em>n</em> elements, we define <strong>load factor</strong> \(\alpha\) for <em>T</em> as <em>n/m</em>, that is, the average number of elements stored in a chain.</p>
<ul>
<li><em>The worst case</em>: all <em>n</em> keys hash to the same slot, creating a list of length <em>n</em>. The worst-case time for searching is \(O(n)\) plus the time to compute the hash function. We clearly don't use hash tables in this case.</li>
<li><em>The average case</em>: It depends on how well the hash function <em>h</em> distributes the keys, and we will discuss it in detail later. For now, we assume that any given element is equally likely to hash into any of the <em>m</em> slots. Setting aside the \(O(1)\) time required to compute the hash function. In this case, a search takes \(O(1 + \alpha)\) time on average.</li>
</ul>
<p>By the default, Java's implementation choose \(\alpha = 0.75\).</p>
<h2 id="implementation-and-evaluation"><a class="header" href="#implementation-and-evaluation">Implementation and evaluation</a></h2>
<p>First, we design an implementation for symbol table based on a linked list. Then the separate chaining hash maintains:</p>
<ul>
<li>an array of linked lists</li>
<li><code>m</code>: the size of the slots</li>
<li><code>n</code>: the number of the key-value pairs</li>
</ul>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/hash/src/main/java/org/swufe/datastructures/SeparateChainingHash.java">SeparateChainingHash.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/python/hash/separate_chaining_hash.py">separate_chaining_hash.py</a>.</p>
<h3 id="a-few-notes-on-python"><a class="header" href="#a-few-notes-on-python">A few notes on Python</a></h3>
<p>To return all keys of a linked list as an iterable object, we can use <code>yield</code>:</p>
<pre><code class="language-python">def keys(self):
    x = self._first
    while x is not None:
        yield x.key
        x = x.next
</code></pre>
<h3 id="evaluation"><a class="header" href="#evaluation">Evaluation</a></h3>
<p>To evaluate the performance, I designed an experiment to compare an elementary symbol table based on a linked list and that based on the separate chaining hashing.</p>
<img src="hash/image/hash-time.png" width="80%">
<p>As we can see, it shows the great superiority of the hashing method.</p>
<hr />
<p><sup class="footnote-reference"><a href="#list">1</a></sup> Generally, we set parameters so as to make the number of keys hashing to each value small, and linked list tables are generally better for small tables.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-functions"><a class="header" href="#hash-functions">Hash Functions</a></h1>
<p>We seek a hash function that both is easy to compute and uniformly distributes the keys. </p>
<h2 id="independent-uniform-hashing"><a class="header" href="#independent-uniform-hashing">Independent uniform hashing</a></h2>
<blockquote>
<p>The hash function that we use uniformly and independently distribute keys among the integer values between <code>0</code> and <code>m - 1</code>.</p>
</blockquote>
<p>We call such an idea hash function an <strong>independent uniform hash function</strong>. Independent uniform hashing is an ideal abstraction, but it is not something that can reasonably be implemented in practice. So, we would like a <em>good</em> hash function to approximately satisfy the assumption of independent uniform hashing. Unfortunately, you typically have no way to check this condition, unless you happen to know the probability distribution from which the keys are drawn.</p>
<p>In this book, we only introduce <strong>static hashing</strong>, which uses a single, fixed hash function. For more information, such as <em>random hashing</em>, readers can refer to <em>Introduction to Algorithms</em>.</p>
<p>Clearly, we need a different hash function for each key type that we use. For example, if the key is a number, we can use the <em>modular</em> method in the previous section; if the key is a string, we need to convert the string into a number; if the key has multiple parts, we need to combine the parts somehow.</p>
<p>Let's recap with the goal of a <em>hash function</em> again: map a key <em>k</em> to an integer in the range \([0, m-1]\). Therefore, it is common to view the evaluation of a hash function, <em>h(k)</em>, as consisting of two portions:</p>
<ul>
<li>a <strong>hash code</strong> that maps a key <em>k</em> to an integer</li>
<li>a <strong>compression function</strong> that maps the hash code to an integer within a range of indices \([0, m-1]\) for a bucket array</li>
</ul>
<h2 id="hash-code"><a class="header" href="#hash-code">Hash code</a></h2>
<h3 id="integer"><a class="header" href="#integer">Integer</a></h3>
<p>Java relies on 32-bit hash codes<sup class="footnote-reference"><a href="#32">1</a></sup>, so for base types <code>byte</code>, <code>short</code>, <code>int</code>, and <code>char</code>, we can achieve a good hash code simply by casting a value to <code>int</code>. So the hash code of <code>123</code> is simply <code>123</code>.</p>
<p>As for <code>float</code>, we can <strong>treat its bit representation as an integer</strong>. In Java, this is done by <code>Float.floatToIntBits(x)</code> given a float <code>x</code>. In Python, this can be done by the following code:</p>
<pre><code class="language-python">import struct

def float_to_int_bits(f):
    s = struct.pack('&gt;f', f)
    return struct.unpack('&gt;l', s)[0]
</code></pre>
<p>If the key is <code>double</code>, who is 64-bit, a common method is to take the exclusive-or of the high-order (32-bit) and low-order (32-bit). This is how Java does:</p>
<pre><code class="language-java">public static int hashCode(double value) {
    long bits = doubleToLongBits(value);
    return (int)(bits ^ (bits &gt;&gt;&gt; 32));
}
</code></pre>
<h3 id="string"><a class="header" href="#string">String</a></h3>
<p>As for character strings or other variable-length objects that can be viewed as tuples of the form \((x_0, x_1, x_2, \dots, x_{n-1})\), where the order of the \(x_i\) is significant. To compute the hash code, we choose a non-zero constant \(a \neq 1\):</p>
<p>\[x_{0}a^{n-1} + x_{1}a^{n-2} + \dots + x_{n-2}a + x_{n-1}\]</p>
<p>This method is also known as <strong>polynomial hash code</strong>. The following is how Java does when the string is in Latin encode<sup class="footnote-reference"><a href="#mask">2</a></sup>:</p>
<pre><code class="language-java">public static int hashCode(byte[] value) {
    int h = 0;
    for (byte v : value) {
        h = 31 * h + v;
    }
    return h;
}
</code></pre>
<h3 id="compound-keys"><a class="header" href="#compound-keys">Compound keys</a></h3>
<p>If the key type has multiple fields, we can typically mix them together in the way just described for <code>String</code> values.</p>
<pre><code class="language-java">class PhoneNumber {
    private short areaCode;
    private short prefix;
    private short lineNum;
    ...
}
</code></pre>
<p>Then its hash code can be computed as:</p>
<p>\[(31 \times areaCode + prefix) \times 31 + lineNum\]</p>
<h2 id="compression-function"><a class="header" href="#compression-function">Compression function</a></h2>
<p>Since our goal is an array index, not a 32-bit integer, we need to perform a compression function on the hash code. If keys are short non-negative integers, the compression function itself is the hash function. In what follows, we introduce three common compression functions for hashing.</p>
<h3 id="the-division-method"><a class="header" href="#the-division-method">The division method</a></h3>
<p>The <strong>division method</strong> for creating functions maps a key (hash code) <em>k</em> into one of <em>m</em> slots by taking the remainder of <em>k</em> divided by <em>m</em>. That is, the compression function is:</p>
<p>\[h(k) = k \ mod \ m\]</p>
<p>Note that <em>m</em> should be a prime. Otherwise, it may be the case that not all the bits of the key play a role, which amounts to missing an opportunity to disperse the values evenly. For example, if the keys are base-10 numbers and <em>m</em> is \(10^k\), then only the <em>k</em> least significant digits are used.</p>
<h3 id="the-multiplication-method"><a class="header" href="#the-multiplication-method">The multiplication method</a></h3>
<p>The general <strong>multiplication method</strong> for creating compression function operates in two steps:</p>
<ol>
<li>Multiply the key (hash code) <em>k</em> by a constant <em>A</em> in the range \(0 &lt; A &lt; 1\), and extract the fractional part of <em>kA</em></li>
<li>Multiply this value by <em>m</em> and take the floor of the result</li>
</ol>
<p>That is, the compression function is</p>
<p>\[h(k) = \lfloor m(kA \ mod \ 1)\rfloor\]</p>
<p>The general multiplication method has the advantage that the value of
<em>m</em> is not critical and you can choose it independently of how you choose the multiplicative constant <em>A</em>. In practice, the multiplication method is best in the special case where the number <em>m</em> of hash-table slots is an exact power of 2, </p>
<h3 id="the-mad-method"><a class="header" href="#the-mad-method">The MAD method</a></h3>
<p>A more sophisticated compression function, which helps eliminate repeated patterns in a set of integer keys, is the <strong>Multiply-Add-and-Divide</strong> (or &quot;MAD&quot;) method. This method maps an integer <em>k</em> to</p>
<p>\[((ak + b)\ mod \ p)\ mod \ m\]</p>
<p>where <em>p</em> is a prime number larger than <em>m</em>, and <em>a</em> and <em>b</em> are integers chosen at random from the interval <em>[0, p − 1]</em>, with <em>a &gt; 0</em>. </p>
<hr />
<p><sup class="footnote-reference"><a href="#32">1</a></sup> The size of Python's hash codes depend on the machine architecture. See more at <a href="https://docs.python.org/3/reference/datamodel.html#object.__hash__">hash()</a>.</p>
<p><sup class="footnote-reference"><a href="#mask">2</a></sup> We omitted the <em>mask code</em> here for simplicity. The real code inside <strong>for</strong> is <code>h = 31 * h + (v &amp; 0xff)</code>. The use of a small prime integer such as 31 ensures that the bits of all the characters play a role. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-in-java"><a class="header" href="#hash-in-java">Hash in Java</a></h1>
<p>You can override the <code>hashCode()</code> method for your class. By default, this is typically implemented by converting the internal address of the object into an integer, but this implementation technique is not required by the Java. There are two basic rules when implementing <code>hashCode()</code>:</p>
<ul>
<li>You must override <code>hashCode</code> in every class that overrides <code>equals</code>.</li>
<li>Equal objects must have equal hash codes.</li>
</ul>
<p>Collections such as <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/HashMap.html">HashMap</a> and <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/HashSet.html">HashSet</a> rely on the hash code of an object. The following is the worst possible implementation:</p>
<pre><code class="language-java">public class Book {
    private String title;
    private double price;
    ...
    @Override // never do this
    public int hashCode() {
       return 42;
    }
}
</code></pre>
<p>In this case, every object hashes to the same bucket, and hash tables degenerate to linked lists.</p>
<h2 id="hash-code-1"><a class="header" href="#hash-code-1">Hash code</a></h2>
<p>Java has already provided built-in feasible implementations for common data types, and it is recommended using the corresponding static methods. For example, <code>Float.hashCode(3.14f)</code>. </p>
<p>Furthermore, if all fields in your class have their well-defined hash code implementations, then you can simply use the <code>hash()</code> method from <code>Objects</code>, which generates a hash code for a sequence of input values. </p>
<pre><code class="language-java">@Override
public int hashCode() {
    return Objects.hash(title, price);
}
</code></pre>
<p>To design an array index, we shall also mark off the sign bit to turn the 32-bit number into a 31-bit non-negative integer. Take the modular hashing for instance:</p>
<pre><code class="language-java">private int hash(Object x) {
    return (x.hashCode() &amp; 0x7fffffff) % m;
}
</code></pre>
<h3 id="the-implementation-in-jdk"><a class="header" href="#the-implementation-in-jdk">The implementation in JDK</a></h3>
<pre><code class="language-java">private int hash(Object x) {
    int h = x.hashCode();
    h ^= (h &gt;&gt;&gt; 16);
    return h &amp; (m - 1);
}
</code></pre>
<p>The above is how <code>HashMap</code> computes the hash in JDK. Suppose <em>m</em> is the power of 2, then modular operation can be replaced by a bit shift operation (<code>h &amp; (m - 1) == h % m</code>).</p>
<h2 id="a-good-hash-function"><a class="header" href="#a-good-hash-function">A good hash function</a></h2>
<p>In summary, we have three primary requirements in implementing a good hash function for a given data type:</p>
<ul>
<li>It should be <strong>consistent</strong>: equal keys must produce the same hash value</li>
<li>It should be <strong>efficient</strong> to compute</li>
<li>It should <strong>uniformly distribute the keys</strong></li>
</ul>
<p>Satisfying these requirements simultaneously is a job for experts. Java Programmers can assume <code>hashCode()</code> does the job.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash-in-python"><a class="header" href="#hash-in-python">Hash in Python</a></h1>
<p>Python provides in built-in function <code>hash()</code> to generate a hash code. As for your own class, you should implement the <code>__hash__()</code> method. An easy, correct way to implement it is to use a key tuple. </p>
<pre><code class="language-python">class Book:
    def __init__(self, name, price):
        self._name = name
        self._price = price

    def __hash__(self):
        return hash((self._name, self._price))
</code></pre>
<p>Like Java, an important rule to obey is that if a class defines equivalence through <code>__eq__</code>, then any implementation of <code>__hash__</code> must be consistent, in that if <code>x == y</code>, then <code>hash(x) == hash(y)</code>. Note that since Python uses a variable number of bits to store integers, it does not make sense to use bit shift operations on the result.</p>
<h2 id="a-good-hash-function-1"><a class="header" href="#a-good-hash-function-1">A good hash function</a></h2>
<p>In summary, we have three primary requirements in implementing a good hash function for a given data type:</p>
<ul>
<li>It should be <strong>consistent</strong>: equal keys must produce the same hash value</li>
<li>It should be <strong>efficient</strong> to compute</li>
<li>It should <strong>uniformly distribute the keys</strong></li>
</ul>
<p>Satisfying these requirements simultaneously is a job for experts. Python Programmers can assume <code>hash()</code> does the job.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="open-addressing-hashing"><a class="header" href="#open-addressing-hashing">Open-addressing Hashing</a></h1>
<p>Another approach to implementing hashing is to store <em>n</em> elements in a hash table of size <em>m &gt; n</em>, relying on empty entries in the table to help with collision resolution. Such method are called <strong>open-addressing</strong> hashing methods. Unlike chaining, it does not make use of storage outside the hash table itself. One consequence is that the load factor \(\alpha\) can never exceed 1.</p>
<p>Collisions are handled as follows: when a new element is to be inserted into the table, it is placed in its &quot;first-choice&quot; location if possible. If that location is already occupied, the new element is placed in its &quot;second-choice&quot; location. The process continues until an empty slot is found in which to place the new element.</p>
<h2 id="linear-probing"><a class="header" href="#linear-probing">Linear probing</a></h2>
<p>The simplest open-addressing method is called <strong>linear probing</strong>. It is characterized by identifying three possible outcomes:</p>
<ul>
<li>Key equal to search key: search hit</li>
<li>Empty position (<code>null</code> key): search miss</li>
<li>Key not equal to search key: try next entry</li>
</ul>
<p>Given a <em>h(k)</em>, we can define the hash function for linear probing as</p>
<p>\[h(k, i) = (h(k) + i) \ mod \ m\]</p>
<p>for \(i = 0, 1, \dots, m - 1\).</p>
<img src="hash/image/probe.png" width="70%">
<h3 id="general-design"><a class="header" href="#general-design">General design</a></h3>
<p>Since a set can be regarded as a map whose values are always <code>null</code>, we start to use both keys and values in this more practical design. As for a linear probing hash map, it maintains:</p>
<ul>
<li>an array of <code>keys</code></li>
<li>an array of <code>values</code> (<em>satellite data</em>)</li>
<li>number of key-value pairs in the table: <code>n</code></li>
<li>size of linear-probing table: <code>m</code></li>
</ul>
<p>The complete code can be found at <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/java/hash/src/main/java/org/swufe/datastructures/LinearProbeHash.java">LinearProbeHash.java</a> and <a href="https://github.com/ChenZhongPu/data-structure-swufe/blob/master/code/python/hash/linear_probe_hash.py">linear_probe_hash.py</a>.</p>
<h3 id="put-2"><a class="header" href="#put-2"><code>put()</code></a></h3>
<img src="hash/image/alg-probe-put.png" width="80%">
<p>This is a classical <strong>do-while</strong> loop. In real implementations, we can always guarantee that <em>m &gt; n</em> by <code>resize()</code>. As a result, &quot;hash table overflow&quot; will never happen.</p>
<p>In Java, you can also translate it into a regular <code>for</code> loop:</p>
<pre><code class="language-java">public void put(Key k, Value v) {
    int i;
    for (i = hash(k); keys[i] != null; i = (i + 1) % m) {
        if (keys[i].equals(k)) {
            values[i] = v;
            return;
        }
    }
    keys[i] = k;
    values[i] = v;
    n++;
}
</code></pre>
<h3 id="get-1"><a class="header" href="#get-1"><code>get()</code></a></h3>
<img src="hash/image/alg-probe-get.png" width="80%">
<p>Readers can try to implement it using <em>while</em> or <em>do-while</em> structure. The following alternative using <em>for</em> is more readable because <code>null</code> always exists:</p>
<pre><code class="language-java">public Value get(Key k) {
    for (int i = hash(k); keys[i] != null; i = (i + 1) % m) {
        if (keys[i].equals(k)) {
            return values[i];
        }
    }
    return null;
}
</code></pre>
<h3 id="delete"><a class="header" href="#delete"><code>delete()</code></a></h3>
<p>How do we delete a key-value pair from a linear-probing table? If you think about the situation for a moment, you will see that setting the key's table position to <code>null</code> will not work, because that might prematurely terminate the search for a key that was inserted into the table later. For example, to delete 28, if we simply set position 9 to <code>null</code>, then <code>get()</code> cannot find either 18 or 9.</p>
<img src="hash/image/delete.png" width="70%">
<p>The solution is to rehash all keys after the deleted position until we encounter a <code>null</code>.</p>
<img src="hash/image/alg-probe-delete.png" width="80%">
<p>By the way, Lines 1-10 also provides another method to find a key.</p>
<h3 id="resize"><a class="header" href="#resize"><code>resize()</code></a></h3>
<p>If the size of key-value pairs is greater/less than some threshold, we can call the <code>resize()</code>, where it is necessary to rehash all keys, for <em>m</em> is changed.</p>
<h3 id="analysis-of-linear-probing"><a class="header" href="#analysis-of-linear-probing">Analysis of linear probing</a></h3>
<p>Precise analysis of linear probing is a very challenging task. Knuth developed a landmark formulas in 1962:</p>
<blockquote>
<p>In a linear probing hash table with \(m\) lists and \(n = \alpha m\) keys (\(\alpha &lt; 1\)), the average number of probes required is
\[\frac{1}{2}\left( 1 + \frac{1}{1 - \alpha}\right) \ and\ \frac{1}{2}\left( 1 + \frac{1}{(1 - \alpha)^2}\right) \]
for search hits and search misses (inserts), respectively.</p>
</blockquote>
<p>In particular, when \(\alpha\) is about 1/2, the average number of probes for a search hit is about 3/2 and for a search miss is about 5/2. Therefore, as long as we can make sure the hash table is half-full, the performance is generally good.</p>
<h2 id="a-few-notes-on-pythons-implementation"><a class="header" href="#a-few-notes-on-pythons-implementation">A few notes on Python's implementation</a></h2>
<p>It is fine to implement <code>get()</code> and <code>put()</code>, as we did in Java, but it would be more Pythonic to implement methods:</p>
<pre><code class="language-python">def __setitem__(self, key, value):
    pass

def __getitem__(self, key):
    pass

def __delitem__(self, key):
    pass
</code></pre>
<p>The same techniques can also be applied for a BST, when the satellite data (i.e., values) are also stored. In this way, we can use the following code:</p>
<pre><code class="language-python">table = LinearProbeHash()
table[1] = '1'
table[2] = 'two'
print(table[1])
del table[1]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="case-study-3"><a class="header" href="#case-study-3">Case Study</a></h1>
<p>Hash functions are highly related with computer security (e.g., cryptography). For example, when you want to download some file from the Internet, you will probably notice a magic string (e.g., <code>sha512</code>) which can be used to verify the integrity of the file. </p>
<p>In fact, such string is computed by a hash function based on the bits of a file. If the results are matched, we can say the file is not changed by anyone due to the consistency of a hash function.</p>
<ul>
<li>Java's <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/security/MessageDigest.html">MessageDigest</a> provides many cryptographic hash functions to find hash value of a text.</li>
<li>Python's <a href="https://docs.python.org/3/library/hashlib.html">hashlib</a> implements a common interface to many different secure hash and message digest algorithms.</li>
</ul>
<p>But detailed discussion on cryptography is out of the scope of this book. </p>
<h2 id="hash-vs-rbt"><a class="header" href="#hash-vs-rbt">Hash vs. RBT</a></h2>
<p>Is hashing faster than searching in red-black BSTs?</p>
<p>It depends on the type of the key, which determines the cost of computing <em>hash code</em> versus the cost of <em>comparison</em>. For typical key types, these costs are similar, so hashing will be significantly faster, since it uses only a constant number of operations.</p>
<p>But it is important to remember that this question is moot if you need ordered operations, which are not efficiently supported in hash tables.</p>
<h2 id="cockoo-hashing"><a class="header" href="#cockoo-hashing">Cockoo Hashing</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Cuckoo_hashing">Cuckoo hashing</a> is a form of open addressing with worst-case constant lookup time. The basic idea of cuckoo hashing is to resolve collisions by using two hash functions instead of only one. This provides two possible locations in the hash table for each key. For simplicity, here we only consider <em>keys</em>.</p>
<h3 id="lookup"><a class="header" href="#lookup"><code>lookup()</code></a></h3>
<p>Cuckoo hashing uses two hash tables \(T_1\) and \(T_2\), and assuming \(m\) be the length of each table. The lookup operation is as follows:</p>
<img src="hash/image/alg-cuckoo-get.png" width="80%">
<h3 id="insert-1"><a class="header" href="#insert-1"><code>insert()</code></a></h3>
<p>The most interesting part of Cuckoo hashing is its insertion.</p>
<ul>
<li>If the slot \(h_1(k)\) of table \(T_1\) is not occupied, the new key \(k\) is inserted at that cell.</li>
<li>Otherwise, the preoccupied key \(k'\) gets removed, and \(k\) is inserted at \(T_1[h_1(x)]\). The removed key \(k'\) is inserted into \(T_2\) by following the same procedure.</li>
</ul>
<p>To avoid the possible infinite iteration, a <code>Max-Loop</code> is specified. If the loop exceeds the fixed threshold, then we conduct a <code>rehash()</code> operation by newer hash functions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sorting"><a class="header" href="#sorting">Sorting</a></h1>
<p>Sorting is the processing of rearranging a sequence of objects so as to put them in some logical order. For example, your credit card bill presents transactions in order by <em>date</em>. All computer systems have implementations of sorting algorithms, for use by the system and by users.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graphs"><a class="header" href="#graphs">Graphs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="appendix"><a class="header" href="#appendix">Appendix</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="idea-for-java"><a class="header" href="#idea-for-java">IDEA for Java</a></h1>
<p>In this book, we use JDK 11, and the IntelliJ IDEA Community<sup class="footnote-reference"><a href="#version">1</a></sup> is enough for our course.</p>
<h2 id="create-an-empty-project-without-building-system"><a class="header" href="#create-an-empty-project-without-building-system">Create an empty project without building system</a></h2>
<p>For the simplicity, we don't need to rely on third party libraries in most cases when learning data structures, so you can choose <em>IntelliJ</em> for <code>Build system</code>:</p>
<img src="appendix/img/idea.png">
<h2 id="create-an-empty-project-with-gradle"><a class="header" href="#create-an-empty-project-with-gradle">Create an empty project with <code>gradle</code></a></h2>
<p>In order to integrate <a href="https://junit.org/junit5/">JUnit 5</a> with an ease in our project, <code>gradle</code> is preferred as the <em>Build System</em> in this book.</p>
<img src="appendix/img/gradle.png">
<p>And you can customize the <em>GroupID</em> if you like. In <code>build.gradle</code>, we can find that the <em>dependencies</em> with respect to units test have been specified:</p>
<pre><code class="language-groovy">dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.1'
}
</code></pre>
<hr />
<p><sup class="footnote-reference"><a href="#version">1</a></sup> The Ultimate version (<em>paid</em>) offers more features than the Community one (<em>free</em>).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pycharm-for-python"><a class="header" href="#pycharm-for-python">PyCharm for Python</a></h1>
<p>In this book, we use Python 3.7 and above, and you can download <a href="https://www.jetbrains.com/zh-cn/pycharm/download/">IntelliJ PyCharm Community</a> to facilitate the developing.</p>
<h2 id="create-an-empty-project"><a class="header" href="#create-an-empty-project">Create an empty project</a></h2>
<img src="appendix/img/pycharm.png">
<p>As for <code>Python Interpreter</code>, you can choose either <code>New environment using</code><sup class="footnote-reference"><a href="#virtual">1</a></sup> or <code>Previously configured interpreter</code>.</p>
<h2 id="a-few-notes-for-installing-python"><a class="header" href="#a-few-notes-for-installing-python">A few notes for installing Python</a></h2>
<p>As for MacOS, Python 3 is a built-in software, so in general, you do not have to install it again. Of course, if you would like to do something with machine learning and deep learning in the future, <a href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a> or <a href="https://www.anaconda.com/products/distribution#Downloads">Annoconda</a> is preferred.</p>
<p>As for Windows, you can install Python 3 from sources in the following:</p>
<ul>
<li><a href="https://www.python.org/downloads/">Python 3 Official</a>: recommended for beginners</li>
<li><a href="https://www.anaconda.com/products/distribution#Downloads">Annoconda</a>: recommended for intermediates</li>
<li><a href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a>: recommended for experts</li>
</ul>
<p>During the installation, <strong>it is fine to always click <em>Next</em> and use the default settings if you don't know what they mean</strong>.</p>
<hr />
<p><sup class="footnote-reference"><a href="#virtual">1</a></sup> Python virtual environment is a very useful tool to isolate your developing settings.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
